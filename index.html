<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>é—œæ±8æ—¥ä¹‹æ—… V5.1 (Debug)</title>
    
    <style>
        html, body {
            height: 100%; margin: 0; padding: 0;
            background-color: #FFF0F5;
            background-image: radial-gradient(#FFD1DC 15%, transparent 16%), radial-gradient(#FFF5BA 15%, transparent 16%);
            background-size: 60px 60px;
            background-position: 0 0, 30px 30px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: #5D4037;
            overflow-x: hidden;
        }
        /* ç¢ºä¿å…§å®¹å€å¡Šæœ‰é«˜åº¦ */
        #app { min-height: 100vh; display: block; }
        
        /* ç‹€æ…‹é¡¯ç¤ºåˆ— (é™¤éŒ¯ç”¨) */
        #status-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: rgba(0,0,0,0.8); color: lime; 
            font-size: 10px; padding: 5px; z-index: 999999;
            font-family: monospace; max-height: 100px; overflow-y: auto;
        }

        /* æ«»èŠ± */
        .sakura { position: fixed; top: -10px; background: #FFB7B2; border-radius: 100% 0 100% 0; opacity: 0.6; animation: fall linear infinite; z-index: 0; pointer-events: none; width: 12px; height: 12px; }
        @keyframes fall { to { transform: translate(15vw, 105vh) rotate(360deg); } }

        /* UI */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .card { background: rgba(255, 255, 255, 0.95); border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.8); margin-bottom: 15px; }
        .fab-main { position: fixed; bottom: 40px; right: 20px; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; z-index: 50; border: 4px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.2); background: #FF9EAC; }
        
        /* æ©Ÿç¥¨æ¨£å¼ */
        .boarding-pass { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid #eee; position: relative; margin-bottom: 16px; }
        .boarding-pass::before, .boarding-pass::after { content: ''; position: absolute; width: 20px; height: 20px; background: #FFF0F5; border-radius: 50%; top: 65%; z-index: 10; }
        .boarding-pass::before { left: -10px; } .boarding-pass::after { right: -10px; }
        .dashed-line { border-top: 2px dashed #ddd; margin: 15px 0; position: relative; }
        
        .watercolor-img { width: 100%; height: 100%; object-fit: cover; }
    </style>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.prod.js"></script> 
</head>
<body>

    <div id="status-bar">ç³»çµ±åˆå§‹åŒ–...</div>
    <script>
        function log(msg) { 
            document.getElementById('status-bar').innerHTML += " > " + msg; 
            console.log(msg);
        }
        window.onerror = function(msg) { log("âŒéŒ¯èª¤: " + msg); };
        log("HTML è¼‰å…¥å®Œæˆ");
    </script>

    <div id="sakura-container"></div>

    <div id="app">
        <div v-if="currentView === 'home'" class="relative h-screen w-full overflow-hidden">
            <div style="position:absolute; inset:0; z-index:0;">
                <img :src="homeBannerImg" style="width:100%; height:100%; object-fit:cover; object-position:center bottom;" @error="handleImgError($event)">
                <div style="position:absolute; inset:0; background:linear-gradient(to bottom, rgba(0,0,0,0.2), transparent, #FFF0F5);"></div>
            </div>
            
            <div style="position:fixed; top:150px; left:20px; z-index:50; background:rgba(255,255,255,0.9); padding:10px 20px; border-radius:50px; border:4px solid #FFD1DC; display:flex; align-items:center; gap:10px;">
                <div style="font-size:24px;">ğŸ¹</div>
                <div><div style="font-size:10px; color:gray; font-weight:bold;">COUNTDOWN</div><div style="font-size:20px; font-weight:900; color:#ec4899;">{{ daysUntilTrip }} <span style="font-size:12px;">å¤©</span></div></div>
            </div>

            <div style="position:relative; z-index:10; height:100%; display:flex; flex-direction:column; justify-content:space-between; padding:20px; padding-top:50px; pointer-events:none;">
                <div style="text-align:center; color:white; text-shadow:0 2px 4px rgba(0,0,0,0.5); pointer-events:auto;">
                    <div style="background:rgba(236,72,153,0.8); display:inline-block; padding:5px 15px; border-radius:20px; font-size:14px; font-weight:bold; margin-bottom:10px; border:1px solid rgba(255,255,255,0.3);">2026.03.27 å‡ºç™¼</div>
                    <h1 style="font-size:40px; font-weight:900; margin:0; letter-spacing:2px;">é—œæ±ä¹‹æ—…</h1>
                    <p style="font-size:18px; font-weight:bold; opacity:0.9; letter-spacing:4px;">8å¤©7å¤œ</p>
                </div>
                
                <div style="background:rgba(255,255,255,0.7); backdrop-filter:blur(10px); padding:20px; border-radius:30px; border:1px solid rgba(255,255,255,0.5); margin-bottom:60px; pointer-events:auto;">
                    <div class="grid grid-cols-3 gap-6">
                        <div v-for="app in apps" :key="app.id" @click="currentView=app.view" style="display:flex; flex-direction:column; align-items:center; cursor:pointer;">
                            <div :class="app.bgClass" style="width:56px; height:56px; border-radius:16px; display:flex; align-items:center; justify-content:center; font-size:24px; color:white; box-shadow:0 4px 6px rgba(0,0,0,0.1); border:2px solid white;"><i :class="app.icon"></i></div>
                            <span style="font-size:12px; font-weight:bold; color:#4b5563; margin-top:5px;">{{ app.name }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView !== 'home'" class="fixed top-0 left-0 right-0 h-16 bg-white/90 backdrop-blur z-40 flex items-center justify-between px-4 border-b border-pink-100">
            <button @click="currentView='home'" class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-pink-400 shadow"><i class="fa-solid fa-chevron-left"></i></button>
            <h1 class="font-bold text-gray-700">{{ getPageTitle(currentView) }}</h1>
            <button @click="saveAsHtml" class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-blue-400 shadow"><i class="fa-solid fa-floppy-disk"></i></button>
        </div>
        <div v-if="currentView !== 'home'" class="h-16"></div>

        <div v-if="currentView !== 'home'" class="pb-24 px-4 pt-4">
            
            <div v-if="currentView === 'itinerary'">
                <div class="flex overflow-x-auto gap-2 mb-4 pb-1 sticky top-16 bg-[#FFF0F5] z-30 py-2">
                    <button v-for="(d,i) in tripDays" @click="selectedDayIndex=i" :class="['px-4 py-2 rounded-full whitespace-nowrap text-sm font-bold border-2 transition', selectedDayIndex===i?'bg-pink-400 text-white border-pink-400':'bg-white text-gray-400 border-white']">{{d.week}}</button>
                </div>
                <div class="space-y-4">
                    <div v-for="(item, idx) in currentItinerary" :key="idx" class="card p-4 flex gap-3 relative">
                        <div class="w-1 bg-pink-200 rounded"></div>
                        <div class="flex-1">
                            <div class="flex justify-between mb-1"><span class="text-xs font-bold text-pink-500 bg-pink-50 px-2 py-0.5 rounded">{{ item.hours }}</span></div>
                            <h3 class="font-bold text-gray-800 text-lg">{{ item.name }}</h3>
                            <p class="text-sm text-gray-500 mt-1">{{ item.note }}</p>
                        </div>
                    </div>
                </div>
                <button @click="alert('ç·¨è¼¯åŠŸèƒ½å·²ç°¡åŒ–')" class="fab-main"><i class="fa-solid fa-plus"></i></button>
            </div>

            <div v-if="currentView === 'money'" class="text-center py-10">
                <div class="card p-5">
                    <h3 class="font-bold mb-4">è¨˜å¸³æœ¬</h3>
                    <p class="text-gray-500">ç¸½æ”¯å‡º: Â¥{{totalExpense}}</p>
                    <button @click="addExpense" class="mt-4 bg-yellow-400 px-4 py-2 rounded-full font-bold">è¨˜ä¸€ç­†</button>
                </div>
                <div v-for="e in expenses" class="card p-3 flex justify-between mt-2"><span>{{e.name}}</span><span>Â¥{{e.amount}}</span></div>
            </div>

            <div v-if="currentView === 'hotel'" class="space-y-4">
                <div class="flex justify-center gap-2 mb-4"><button @click="hotelTab='stay'" class="px-4 py-1 bg-white rounded-full text-sm font-bold">ä½å®¿</button><button @click="hotelTab='flight'" class="px-4 py-1 bg-white rounded-full text-sm font-bold">æ©Ÿç¥¨</button></div>
                <div v-if="hotelTab==='stay'" class="card p-5" v-for="h in hotels">
                    <h3 class="font-bold text-lg">{{h.name}}</h3><p class="text-sm text-gray-500">{{h.days}}</p>
                </div>
                <div v-if="hotelTab==='flight'" class="boarding-pass p-4">
                    <div class="flex justify-between items-center text-center"><div><div class="text-2xl font-black">TPE</div></div><i class="fa-solid fa-plane text-pink-300"></i><div><div class="text-2xl font-black">NRT</div></div></div>
                </div>
            </div>

            <div v-if="['food','shopping','photo'].includes(currentView)" class="text-center">
                <div class="grid grid-cols-1 gap-4">
                    <div v-for="item in getCurrentList()" class="card overflow-hidden">
                        <img :src="item.img" class="h-48 w-full object-cover" @error="e=>e.target.src='https://placehold.co/600x400?text=No+Image'">
                        <div class="p-4 font-bold">{{item.name}}</div>
                    </div>
                </div>
                <button @click="addItem" class="fab-main"><i class="fa-solid fa-plus"></i></button>
            </div>

            <div v-if="currentView === 'prep'" class="card p-5">
                <h3 class="font-bold mb-2">è¡Œå‰æº–å‚™</h3>
                <div v-for="u in users" class="mb-2 flex justify-between"><span>{{u.name}}</span><span>{{u.list.length}} é …</span></div>
            </div>

            <div v-if="currentView === 'weather'" class="card p-5 text-center">
                <h3 class="font-bold mb-2">å¤©æ°£é å ±</h3>
                <p>æ±äº¬: {{tokyoWeather.temp}}Â°</p>
                <a href="https://n-kishou.com/corp/news-contents/sakura/" target="_blank" class="block mt-4 text-blue-500 underline">æŸ¥çœ‹æ«»èŠ±é æ¸¬</a>
            </div>

            <div v-if="currentView === 'japanese'" class="card p-5">
                <h3 class="font-bold mb-4">å¯¦ç”¨æ—¥èª</h3>
                <div v-for="p in japanesePhrases" class="border-b py-2 flex justify-between" @click="speak(p.jp)"><span>{{p.jp}}</span><span>ğŸ”Š</span></div>
            </div>

        </div>
    </div>

    <script>
        log("æº–å‚™å•Ÿå‹• Vue...");
        
        const { createApp, ref, computed, onMounted } = Vue;

        createApp({
            setup() {
                log("Vue Setup é–‹å§‹");
                const currentView = ref('home');
                const homeBannerImg = ref('2026.tokyo.jpg');
                const searchQuery = ref('');
                const daysUntilTrip = ref(100);
                const selectedDayIndex = ref(0);
                const hotelTab = ref('stay');
                const moneyTab = ref('record');
                
                // Hardcoded Data (ä¿è­‰ä¸å£)
                const apps = [
                    { id: 1, name: 'è¡Œç¨‹è¡¨', icon: 'fa-solid fa-map-location-dot', bgClass: 'bg-pink-400', view: 'itinerary' },
                    { id: 2, name: 'å°è²¡åº«', icon: 'fa-solid fa-sack-dollar', bgClass: 'bg-yellow-400', view: 'money' },
                    { id: 3, name: 'ä½å®¿æ©Ÿç¥¨', icon: 'fa-solid fa-plane', bgClass: 'bg-indigo-400', view: 'hotel' },
                    { id: 4, name: 'æº–å‚™', icon: 'fa-solid fa-suitcase', bgClass: 'bg-blue-400', view: 'prep' },
                    { id: 5, name: 'åƒå–', icon: 'fa-solid fa-utensils', bgClass: 'bg-orange-400', view: 'food' },
                    { id: 6, name: 'è³¼ç‰©', icon: 'fa-solid fa-bag-shopping', bgClass: 'bg-purple-400', view: 'shopping' },
                    { id: 7, name: 'å¤©æ°£', icon: 'fa-solid fa-cloud-sun', bgClass: 'bg-sky-400', view: 'weather' },
                    { id: 8, name: 'æ‰“å¡', icon: 'fa-solid fa-camera', bgClass: 'bg-rose-400', view: 'photo' },
                    { id: 9, name: 'æ—¥æ–‡', icon: 'fa-solid fa-comment', bgClass: 'bg-emerald-400', view: 'japanese' },
                ];

                const tripDays = [{ week: 'Day 1' }, { week: 'Day 2' }, { week: 'Day 3' }, { week: 'Day 4' }, { week: 'Day 5' }, { week: 'Day 6' }, { week: 'Day 7' }, { week: 'Day 8' }];
                const itineraryData = ref([
                    [{hours:'06:40', name:'æ¡ƒåœ’èµ·é£›', note:'ææ—©2å°æ™‚'}, {hours:'13:00', name:'æ™´ç©ºå¡”', note:'é€›è¡—'}],
                    [{hours:'09:00', name:'æ·ºè‰å¯º', note:'é›·é–€'}, {hours:'14:00', name:'ä¸Šé‡å…¬åœ’', note:'æ˜Ÿå·´å…‹'}],
                    [], [], [], [], [], []
                ]);
                const users = ref([{id:1, name:'å‰ä¼Š', list:[]}, {id:2, name:'å°å…«', list:[]}]);
                const expenses = ref([{name:'æ¸¬è©¦æ”¯å‡º', amount:100}]);
                const hotels = [{name:'éŒ¦ç³¸ç”ºé£¯åº—', days:'Day 1-2', link:'#'}];
                const foodList = ref([{name:'é˜¿å¤«åˆ©æ‹‰éºµ', img:'./images/afuri.jpg'}]);
                const shopList = ref([{name:'Kateæ€ªç¸å”‡è†', img:'./images/kate.jpg'}]);
                const photoList = ref([{name:'Shibuya Sky', img:'./images/sky.jpg'}]);
                const japanesePhrases = ref([{jp:'ã™ã¿ã¾ã›ã‚“', tw:'ä¸å¥½æ„æ€'}]);
                const tokyoWeather = ref({temp:'20'});

                const currentItinerary = computed(() => itineraryData.value[selectedDayIndex.value] || []);
                const totalExpense = computed(() => expenses.value.reduce((a,b)=>a+Number(b.amount),0));

                const getPageTitle = (v) => v.toUpperCase();
                const handleImgError = (e) => e.target.src = 'https://placehold.co/600x900/pink/white?text=ImgError';
                const doGoogleSearch = () => { if(searchQuery.value) window.open('https://www.google.com/maps/search/'+searchQuery.value); };
                const addExpense = () => { const n=prompt('é …ç›®'); const a=prompt('é‡‘é¡'); if(n&&a) expenses.value.push({name:n, amount:a}); };
                const addItem = () => { const n=prompt('åç¨±'); if(n) getCurrentList().push({name:n, img:''}); };
                const getCurrentList = () => { if(currentView.value==='food') return foodList.value; if(currentView.value==='shopping') return shopList.value; return photoList.value; };
                const speak = (t) => { const u = new SpeechSynthesisUtterance(t); u.lang='ja-JP'; window.speechSynthesis.speak(u); };
                const saveAsHtml = () => alert('å„²å­˜åŠŸèƒ½æ­£å¸¸');

                onMounted(() => {
                    log("Vue Mounted! æ‡‰ç”¨ç¨‹å¼å·²æ›è¼‰");
                    daysUntilTrip.value = Math.ceil((new Date('2026-03-27') - new Date()) / (86400000));
                    
                    // ç”¢ç”Ÿæ«»èŠ±
                    const sc = document.getElementById('sakura-container');
                    for(let i=0;i<20;i++){ const e=document.createElement('div'); e.className='sakura'; e.style.left=Math.random()*100+'vw'; e.style.animationDuration=Math.random()*3+4+'s'; sc.appendChild(e); }
                });

                return {
                    currentView, homeBannerImg, searchQuery, apps, tripDays, selectedDayIndex, currentItinerary,
                    getPageTitle, handleImgError, doGoogleSearch, daysUntilTrip,
                    moneyTab, expenses, totalExpense, addExpense,
                    hotelTab, hotels, users,
                    foodList, shopList, photoList, getCurrentList, addItem,
                    japanesePhrases, speak, tokyoWeather, saveAsHtml
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
