<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é—œæ±8æ—¥å¥³å­æ—… | å‰ä¼Šå¡å“‡é¢¨</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'chiika-pink': '#FFD1DC',
                        'chiika-blue': '#A2D2FF',
                        'chiika-yellow': '#FFF5BA',
                        'chiika-text': '#5D5D5D',
                    },
                    fontFamily: {
                        sans: ['Zen Maru Gothic', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #A2D2FF; 
            font-family: 'Zen Maru Gothic', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .banner-container {
            height: 250px;
            /* ä¿®æ”¹è™•ï¼šé€™è£¡æ”¹ç‚ºè®€å–æ‚¨ä¸Šå‚³çš„ banner.jpg */
            background-image: url('./banner.jpg'); 
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .app-content {
            background-color: #FFF5F7;
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            margin-top: -30px; 
            position: relative;
            z-index: 10;
            min-height: calc(100vh - 220px);
            padding-bottom: 120px;
        }
        .floating-tabs {
            position: fixed;
            bottom: 20px; 
            left: 50%;
            transform: translateX(-50%);
            z-index: 40;
            display: flex;
            gap: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            backdrop-filter: blur(5px);
            width: max-content;
        }
        .tab-btn {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            color: #9CA3AF;
            transition: all 0.2s;
            position: relative;
        }
        .tab-btn.active {
            background: #FFD1DC;
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 4px 10px rgba(255, 209, 220, 0.6);
        }
        .tab-label {
            position: absolute;
            bottom: -20px;
            font-size: 10px;
            width: max-content;
            color: #888;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }
        .tab-btn.active .tab-label { opacity: 1; color: #FF8FAB; font-weight: bold; }
        .card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 10px rgba(255, 183, 178, 0.2);
            transition: transform 0.1s;
        }
        .card:active { transform: scale(0.99); }
        .notepad-item {
            border-bottom: 1px dashed #cbd5e1;
            padding: 12px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .notepad-checkbox {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid #FFD1DC;
            border-radius: 6px;
            position: relative;
            cursor: pointer;
        }
        .notepad-checkbox:checked { background-color: #FFD1DC; }
        .notepad-checkbox:checked::after {
            content: 'âœ”';
            color: white;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
        }
        .strikethrough { text-decoration: line-through; color: #cbd5e1; }
        
        /* è¼‰å…¥ä¸­é®ç½© */
        [v-cloak] { display: none; }
        .loading-placeholder {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-weight: bold; color: #fff; font-size: 1.2rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>

<div id="app">
    <div class="loading-placeholder" v-if="!isMounted">
        <i class="fa-solid fa-spinner fa-spin mr-2"></i> æ­£åœ¨æº–å‚™è¡Œç¨‹...
    </div>

    <div v-if="isMounted" v-cloak>
        <div class="banner-container relative">
            <div class="absolute bottom-10 left-6 text-white drop-shadow-md">
                <h1 class="text-3xl font-bold" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">é—œæ±8æ—¥å¥³å­æ—… ğŸŒ¸</h1>
                <p class="text-sm opacity-90 mt-1" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.3);">å¯Œå£«å±±è‡ªé§• x å‰ä¼Šå¡å“‡</p>
            </div>
        </div>

        <div class="app-content px-4 py-6">

            <div v-if="currentTab === 'itinerary'">
                <div class="flex overflow-x-auto hide-scrollbar gap-3 mb-6 pb-2">
                    <div v-for="(day, index) in tripDays" :key="index" 
                        @click="selectedDayIndex = index"
                        :class="['flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center cursor-pointer transition-all', 
                                selectedDayIndex === index ? 'bg-chiika-pink text-white shadow-md transform scale-105' : 'bg-white text-gray-400']">
                        <span class="text-xs font-bold">{{ day.week }}</span>
                        <span class="text-2xl font-bold">{{ day.dateNum }}</span>
                    </div>
                </div>

                <div class="rounded-2xl p-4 mb-6 flex items-center justify-between shadow-sm text-white relative overflow-hidden" 
                    style="background: linear-gradient(to right, #ffecd2 0%, #fcb69f 100%);">
                    <div class="absolute -top-4 -right-4 w-20 h-20 bg-white opacity-20 rounded-full"></div>
                    <div class="flex items-center gap-3 z-10">
                        <i class="fa-solid fa-cloud-sun text-3xl text-yellow-100"></i>
                        <div>
                            <div class="text-lg font-bold">å¯Œå£«å±±</div>
                            <div class="text-xs opacity-90">æ™´æ™‚å¤šé›²</div>
                        </div>
                    </div>
                    <div class="text-right z-10">
                        <div class="text-3xl font-bold">12Â°C</div>
                        <div class="text-xs opacity-80">é«”æ„Ÿ 10Â°C</div>
                    </div>
                </div>

                <div class="space-y-0">
                    <div v-if="currentDayItinerary.length === 0" class="text-center text-gray-400 py-10">
                        <i class="fa-solid fa-bed text-4xl mb-2 opacity-50"></i>
                        <p>ä»Šå¤©æ²’æœ‰è¡Œç¨‹å‘¦ zzz</p>
                    </div>

                    <div v-for="(item, idx) in currentDayItinerary" :key="item.id" class="relative">
                        <div v-if="idx > 0" class="ml-5 border-l-2 border-dashed border-gray-300 h-10 flex items-center pl-6 text-xs text-gray-400">
                            <i :class="getTransportIcon(item.transportType)" class="mr-2"></i>
                            <span>ç´„ {{ item.travelTime }} åˆ†é˜</span>
                        </div>
                        <div v-else-if="selectedDayIndex > 0 && item.category !== 'Flight'" class="ml-5 border-l-2 border-dashed border-gray-300 h-8 flex items-center pl-6 text-xs text-gray-400 pb-2">
                            <i class="fa-solid fa-bed mr-2"></i> å¾æ˜¨æ™šä½å®¿å‡ºç™¼
                        </div>

                        <div @click="openMap(item.name)" 
                            :class="['card p-4 flex gap-4 cursor-pointer relative group transition hover:shadow-md', item.category === 'Flight' ? 'bg-gradient-to-r from-blue-50 to-purple-50' : 'bg-white']">
                            <div class="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center flex-shrink-0 text-chiika-blue text-xl">
                                <i :class="getCategoryIcon(item.category)"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-bold text-lg leading-tight text-gray-700">{{ item.name }}</h3>
                                    <button @click.stop="deleteItem(idx)" class="text-gray-300 hover:text-red-400 p-2 -mr-2 -mt-2">
                                        <i class="fa-solid fa-trash-can text-sm"></i>
                                    </button>
                                </div>
                                <div v-if="item.hours" class="text-xs mt-1 text-gray-500">
                                    <i class="fa-regular fa-clock mr-1"></i> {{ item.hours }}
                                </div>
                                <div v-if="item.ticket" class="text-xs mt-1 text-pink-500 font-bold">
                                    <i class="fa-solid fa-ticket mr-1"></i> {{ item.ticket }}
                                </div>
                                <p class="text-xs mt-2 text-gray-500 leading-relaxed">{{ item.note }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <button @click="showAddModal = true" class="fixed bottom-24 right-6 w-14 h-14 bg-chiika-blue text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-30 hover:bg-blue-300 transition-colors transform active:scale-95">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>


            <div v-if="currentTab === 'prep'">
                <h2 class="text-xl font-bold text-chiika-text mb-4 pl-2 border-l-4 border-pink-300">è¡Œå‰æº–å‚™æ¸…å–®</h2>
                <a href="https://vjw-lp.digital.go.jp/zh-hant/" target="_blank" 
                class="block w-full bg-gradient-to-r from-pink-400 to-red-400 text-white p-4 rounded-xl shadow-lg mb-6 flex items-center justify-between hover:opacity-90 transition transform active:scale-95">
                    <div class="flex items-center gap-3">
                        <div class="bg-white text-pink-500 w-10 h-10 rounded-full flex items-center justify-center">
                            <i class="fa-solid fa-qrcode text-xl"></i>
                        </div>
                        <div>
                            <div class="font-bold text-lg">Visit Japan Web</div>
                            <div class="text-xs opacity-90">å…¥å¢ƒæ—¥æœ¬å¿…å¡«ï¼ŒæŒ‰æ­¤å‰å¾€</div>
                        </div>
                    </div>
                    <i class="fa-solid fa-chevron-right opacity-70"></i>
                </a>
                <div class="bg-white rounded-2xl shadow-sm p-6 relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-4 bg-chiika-yellow opacity-50"></div>
                    <div v-for="(item, idx) in prepList" :key="idx" class="notepad-item">
                        <input type="checkbox" v-model="item.checked" class="notepad-checkbox flex-shrink-0">
                        <span :class="['flex-1 text-sm font-medium transition', item.checked ? 'strikethrough' : 'text-gray-700']">{{ item.text }}</span>
                        <button @click="removePrepItem(idx)" class="text-gray-300 hover:text-red-400 p-2"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                    <div class="mt-4 flex gap-2">
                        <input v-model="newPrepInput" @keyup.enter="addPrepItem" placeholder="æ–°å¢æº–å‚™é …ç›®..." class="flex-1 bg-gray-50 border-b-2 border-gray-200 p-2 text-sm outline-none focus:border-chiika-pink transition">
                        <button @click="addPrepItem" class="text-chiika-pink font-bold text-sm px-2">æ–°å¢</button>
                    </div>
                </div>
            </div>


            <div v-if="currentTab === 'shopping'">
                <h2 class="text-xl font-bold text-chiika-text mb-4 pl-2 border-l-4 border-blue-300">è³¼ç‰©é¡˜æœ›æ¸…å–®</h2>
                <div class="grid grid-cols-2 gap-3">
                    <div v-for="(item, idx) in shoppingList" :key="idx" class="card p-3 flex flex-col items-center relative group">
                        <button @click="shoppingList.splice(idx, 1)" class="absolute top-2 right-2 w-6 h-6 bg-white rounded-full text-red-400 shadow flex items-center justify-center z-10">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                        <div class="w-full h-32 bg-gray-100 rounded-lg mb-2 overflow-hidden flex items-center justify-center">
                            <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                            <i v-else class="fa-regular fa-image text-gray-300 text-3xl"></i>
                        </div>
                        <div class="font-bold text-sm text-center w-full truncate text-gray-700">{{ item.name }}</div>
                    </div>
                    <div @click="showShopModal = true" class="card p-3 flex flex-col items-center justify-center min-h-[160px] cursor-pointer border-2 border-dashed border-gray-300 hover:border-pink-300 bg-transparent shadow-none transition">
                        <i class="fa-solid fa-plus text-3xl text-gray-300"></i>
                        <div class="text-xs text-gray-400 mt-2">æ–°å¢å•†å“</div>
                    </div>
                </div>
            </div>


            <div v-if="currentTab === 'expenses'">
                <div class="flex bg-white rounded-full p-1 mb-6 shadow-sm">
                    <button @click="expenseMode = 'personal'" :class="['flex-1 py-2 rounded-full text-sm font-bold transition', expenseMode === 'personal' ? 'bg-chiika-yellow text-gray-700 shadow-sm' : 'text-gray-400 hover:bg-gray-50']">å€‹äººè¨˜å¸³</button>
                    <button @click="expenseMode = 'split'" :class="['flex-1 py-2 rounded-full text-sm font-bold transition', expenseMode === 'split' ? 'bg-chiika-pink text-white shadow-sm' : 'text-gray-400 hover:bg-gray-50']">åˆ†å¸³è¡¨</button>
                </div>

                <div v-if="expenseMode === 'personal'">
                    <div class="bg-chiika-yellow text-gray-700 p-6 rounded-2xl mb-4 text-center shadow-lg relative overflow-hidden">
                        <i class="fa-solid fa-coins absolute -bottom-4 -right-4 text-6xl text-yellow-200 opacity-50"></i>
                        <div class="text-sm opacity-80">å€‹äººç¸½èŠ±è²» (JPY)</div>
                        <div class="text-4xl font-bold mt-1">Â¥ {{ totalExpenses.toLocaleString() }}</div>
                    </div>
                    <div class="space-y-3">
                        <div v-for="(exp, idx) in expenses" :key="idx" class="card p-3 flex justify-between items-center relative group">
                            <button @click="expenses.splice(idx, 1)" class="absolute -left-2 -top-2 w-6 h-6 bg-red-400 text-white rounded-full text-xs hidden group-hover:flex items-center justify-center shadow-md"><i class="fa-solid fa-xmark"></i></button>
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center text-gray-500"><i :class="getCategoryIcon(exp.category)"></i></div>
                                <div>
                                    <div class="font-bold text-sm text-gray-700">{{ exp.name }}</div>
                                    <div class="text-xs text-gray-400">{{ exp.date }} Â· {{ exp.payment }}</div>
                                </div>
                            </div>
                            <div class="font-bold text-gray-700">Â¥{{ parseInt(exp.amount).toLocaleString() }}</div>
                        </div>
                    </div>
                    <button @click="showExpenseModal = true" class="fixed bottom-24 right-6 w-14 h-14 bg-yellow-400 text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-30 transition transform active:scale-95"><i class="fa-solid fa-plus"></i></button>
                </div>

                <div v-if="expenseMode === 'split'">
                    <div class="mb-4">
                        <div class="text-xs text-gray-500 mb-2 font-bold ml-1">åˆ†å¸³æˆå“¡</div>
                        <div class="flex flex-wrap gap-2">
                            <div v-for="(member, idx) in splitMembers" :key="idx" class="bg-white px-3 py-1 rounded-full text-sm shadow-sm flex items-center gap-2 border border-pink-100">
                                <span class="text-gray-600">{{ member }}</span>
                                <button @click="removeMember(idx)" class="text-gray-300 hover:text-red-400 text-xs"><i class="fa-solid fa-xmark"></i></button>
                            </div>
                            <button @click="addMember" class="px-3 py-1 rounded-full text-sm bg-gray-200 text-gray-500 hover:bg-gray-300 transition">+ åŠ äºº</button>
                        </div>
                    </div>
                    <h3 class="font-bold text-chiika-text mb-3 pl-2 border-l-4 border-pink-300">å…¬æ¬¾æ”¯å‡ºè¨˜éŒ„</h3>
                    <div class="space-y-3">
                        <div v-for="(bill, idx) in splitBills" :key="idx" class="card p-4 border border-pink-50">
                            <div class="flex justify-between items-start mb-2">
                                <div class="font-bold text-lg text-gray-700">{{ bill.item }}</div>
                                <div class="font-bold text-pink-500">Â¥{{ parseInt(bill.amount).toLocaleString() }}</div>
                            </div>
                            <div class="flex justify-between items-center text-xs text-gray-500 bg-gray-50 p-2 rounded-lg">
                                <div class="flex items-center gap-1">
                                    <span class="bg-blue-100 text-blue-600 px-2 py-0.5 rounded font-bold">å…ˆå¢Š</span>
                                    <span class="font-bold text-gray-700">{{ bill.payer }}</span>
                                </div>
                                <button @click="splitBills.splice(idx, 1)" class="text-red-300 hover:text-red-500"><i class="fa-solid fa-trash-can"></i></button>
                            </div>
                        </div>
                        <div v-if="splitBills.length === 0" class="text-center text-gray-400 text-sm py-8 bg-white rounded-2xl border-2 border-dashed border-gray-200">
                            ç›®å‰æ²’æœ‰åˆ†å¸³è¨˜éŒ„<br>é»æ“Šå³ä¸‹è§’æ–°å¢
                        </div>
                    </div>
                    <button @click="showSplitModal = true" class="fixed bottom-24 right-6 w-14 h-14 bg-chiika-pink text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-30 transition transform active:scale-95"><i class="fa-solid fa-hand-holding-dollar"></i></button>
                </div>
            </div>


            <div v-if="currentTab === 'info'">
                <h2 class="text-xl font-bold text-chiika-text mb-4 pl-2 border-l-4 border-gray-300">æ—…è¡Œè³‡è¨Š</h2>
                <div class="card p-5 mb-4">
                    <h3 class="font-bold text-chiika-text mb-3 flex items-center gap-2"><i class="fa-solid fa-calculator text-gray-400"></i>åŒ¯ç‡è©¦ç®—</h3>
                    <div class="flex gap-2 items-center">
                        <input type="number" v-model="currencyInput" placeholder="è¼¸å…¥æ—¥å¹£..." class="w-full bg-gray-50 rounded-lg p-3 border border-gray-200 outline-none focus:border-chiika-blue transition">
                        <i class="fa-solid fa-arrow-right text-gray-400"></i>
                        <div class="w-full bg-gray-100 rounded-lg p-3 text-gray-700 font-bold">NT$ {{ (currencyInput * 0.215).toFixed(0) }}</div>
                    </div>
                </div>
                <div class="card p-4 mb-4">
                    <h3 class="font-bold text-chiika-text mb-3 border-b pb-2">ä½å®¿è³‡è¨Š</h3>
                    <ul class="space-y-4 text-sm">
                        <li class="flex gap-3">
                            <div class="w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center text-pink-400 flex-shrink-0"><i class="fa-solid fa-hotel"></i></div>
                            <div>
                                <div class="font-bold text-gray-700">éŒ¦ç³»ç”º Sumida City</div>
                                <div class="text-xs text-gray-500">ç¬¬ 1-2 æ™š Â· æ±äº¬</div>
                                <a @click="openMap('éŒ¦ç³»ç”º Sumida City')" class="text-blue-400 text-xs underline mt-1 inline-block cursor-pointer">å°èˆª</a>
                            </div>
                        </li>
                        <li class="flex gap-3">
                            <div class="w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center text-pink-400 flex-shrink-0"><i class="fa-solid fa-hotel"></i></div>
                            <div>
                                <div class="font-bold text-gray-700">Megu Fuji 2021</div>
                                <div class="text-xs text-gray-500">ç¬¬ 3-4 æ™š Â· å¯Œå£«å±±</div>
                                <a @click="openMap('Megu Fuji 2021')" class="text-blue-400 text-xs underline mt-1 inline-block cursor-pointer">å°èˆª</a>
                            </div>
                        </li>
                        <li class="flex gap-3">
                            <div class="w-8 h-8 rounded-full bg-pink-100 flex items-center justify-center text-pink-400 flex-shrink-0"><i class="fa-solid fa-hotel"></i></div>
                            <div>
                                <div class="font-bold text-gray-700">DOMO é£¯åº—</div>
                                <div class="text-xs text-gray-500">ç¬¬ 5-7 æ™š Â· æ±äº¬</div>
                                <a @click="openMap('DOMO é£¯åº— æ±äº¬')" class="text-blue-400 text-xs underline mt-1 inline-block cursor-pointer">å°èˆª</a>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="card p-4 bg-red-50 border border-red-100">
                    <h3 class="font-bold text-red-500 mb-2"><i class="fa-solid fa-truck-medical mr-2"></i>ç·Šæ€¥è¯çµ¡</h3>
                    <div class="flex justify-between text-sm text-gray-600">
                        <span>è­¦å¯Ÿ: 110</span>
                        <span>æ•‘è­·è»Š/ç«è­¦: 119</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="floating-tabs">
            <button @click="currentTab = 'itinerary'" :class="['tab-btn', currentTab === 'itinerary' ? 'active' : '']">
                <i class="fa-solid fa-map-location-dot"></i><span class="tab-label">è¡Œç¨‹</span>
            </button>
            <button @click="currentTab = 'prep'" :class="['tab-btn', currentTab === 'prep' ? 'active' : '']">
                <i class="fa-solid fa-suitcase-rolling"></i><span class="tab-label">è¡Œå‰</span>
            </button>
            <button @click="currentTab = 'shopping'" :class="['tab-btn', currentTab === 'shopping' ? 'active' : '']">
                <i class="fa-solid fa-basket-shopping"></i><span class="tab-label">è³¼ç‰©</span>
            </button>
            <button @click="currentTab = 'expenses'" :class="['tab-btn', currentTab === 'expenses' ? 'active' : '']">
                <i class="fa-solid fa-sack-dollar"></i><span class="tab-label">èŠ±è²»</span>
            </button>
            <button @click="currentTab = 'info'" :class="['tab-btn', currentTab === 'info' ? 'active' : '']">
                <i class="fa-solid fa-circle-info"></i><span class="tab-label">è³‡è¨Š</span>
            </button>
        </div>

        <div v-if="showAddModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-sm rounded-2xl p-5 shadow-2xl">
                <h3 class="font-bold text-xl mb-4 text-center text-gray-700">æ–°å¢è¡Œç¨‹</h3>
                <div class="space-y-3">
                    <input v-model="newItem.name" placeholder="åç¨±" class="w-full p-2 border rounded-lg bg-gray-50 focus:border-chiika-blue outline-none">
                    <select v-model="newItem.category" class="w-full p-2 border rounded-lg bg-gray-50 outline-none">
                        <option value="Sightseeing">æ™¯é»</option>
                        <option value="Food">ç¾é£Ÿ</option>
                        <option value="Shopping">è³¼ç‰©</option>
                        <option value="Other">å…¶ä»–</option>
                    </select>
                    <div class="flex gap-2 pt-2">
                        <button @click="showAddModal = false" class="flex-1 py-2 bg-gray-200 rounded-lg text-gray-600">å–æ¶ˆ</button>
                        <button @click="addItem" class="flex-1 py-2 bg-chiika-blue text-white rounded-lg shadow-md">æ–°å¢</button>
                    </div>
                </div>
            </div>
        </div>
        <div v-if="showShopModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-sm rounded-2xl p-5 shadow-2xl">
                <h3 class="font-bold text-xl mb-4 text-center text-gray-700">åŠ å…¥è³¼ç‰©è»Š</h3>
                <input v-model="newShopItem.name" placeholder="å•†å“åç¨±" class="w-full p-2 border rounded-lg mb-3 bg-gray-50 focus:border-pink-300 outline-none">
                <label class="block w-full p-4 border-2 border-dashed border-gray-300 rounded-lg text-center text-gray-400 cursor-pointer hover:bg-gray-50 hover:border-pink-300 transition">
                    <i class="fa-solid fa-camera mb-1 text-2xl"></i><br>ä¸Šå‚³åœ–ç‰‡
                    <input type="file" @change="handleImageUpload" class="hidden">
                </label>
                <div v-if="newShopItem.image" class="mt-2 text-center text-xs text-green-500 font-bold">å·²é¸æ“‡åœ–ç‰‡</div>
                <div class="flex gap-2 mt-4">
                    <button @click="showShopModal = false" class="flex-1 py-2 bg-gray-200 rounded-lg text-gray-600">å–æ¶ˆ</button>
                    <button @click="addShopItem" class="flex-1 py-2 bg-pink-400 text-white rounded-lg shadow-md">ç¢ºå®š</button>
                </div>
            </div>
        </div>
        <div v-if="showExpenseModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-sm rounded-2xl p-5 shadow-2xl">
                <h3 class="font-bold text-xl mb-4 text-center text-gray-700">å€‹äººè¨˜å¸³</h3>
                <div class="space-y-3">
                    <input v-model="newExpense.name" placeholder="é …ç›®åç¨±" class="w-full p-2 border rounded-lg bg-gray-50 outline-none">
                    <input type="number" v-model="newExpense.amount" placeholder="é‡‘é¡ (JPY)" class="w-full p-2 border rounded-lg bg-gray-50 outline-none">
                    <select v-model="newExpense.category" class="w-full p-2 border rounded-lg bg-gray-50 outline-none">
                        <option value="Food">é£²é£Ÿ</option>
                        <option value="Transport">äº¤é€š</option>
                        <option value="Shopping">è³¼ç‰©</option>
                        <option value="Other">å…¶ä»–</option>
                    </select>
                    <div class="flex gap-2 pt-2">
                        <button @click="showExpenseModal = false" class="flex-1 py-2 bg-gray-200 rounded-lg text-gray-600">å–æ¶ˆ</button>
                        <button @click="addExpense" class="flex-1 py-2 bg-yellow-400 text-white rounded-lg shadow-md">å„²å­˜</button>
                    </div>
                </div>
            </div>
        </div>
        <div v-if="showSplitModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-sm rounded-2xl p-5 border-4 border-chiika-pink shadow-2xl">
                <h3 class="font-bold text-xl mb-4 text-center text-gray-700">æ–°å¢å…¬æ¬¾æ”¯å‡º</h3>
                <div class="space-y-3">
                    <div class="text-xs text-gray-400 font-bold ml-1">èª°å…ˆå¢ŠéŒ¢ï¼Ÿ</div>
                    <div class="flex gap-2 overflow-x-auto pb-2 hide-scrollbar">
                        <button v-for="m in splitMembers" :key="m" @click="newSplit.payer = m"
                            :class="['px-3 py-1 rounded-full text-sm border whitespace-nowrap transition', newSplit.payer === m ? 'bg-chiika-pink text-white border-chiika-pink shadow-sm' : 'border-gray-300 text-gray-500']">
                            {{ m }}
                        </button>
                    </div>
                    <input v-model="newSplit.item" placeholder="é …ç›® (ä¾‹: ç§Ÿè»Šè²»)" class="w-full p-2 border rounded-lg bg-gray-50 outline-none">
                    <input type="number" v-model="newSplit.amount" placeholder="ç¸½é‡‘é¡ (JPY)" class="w-full p-2 border rounded-lg bg-gray-50 outline-none">
                    <div class="flex gap-2 pt-2">
                        <button @click="showSplitModal = false" class="flex-1 py-2 bg-gray-200 rounded-lg text-gray-600">å–æ¶ˆ</button>
                        <button @click="addSplitBill" class="flex-1 py-2 bg-chiika-pink text-white rounded-lg shadow-md">æ–°å¢è¨˜éŒ„</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted } = Vue;

    createApp({
        setup() {
            const isMounted = ref(false); // æ§åˆ¶è¼‰å…¥ç‹€æ…‹
            const currentTab = ref('itinerary');
            const selectedDayIndex = ref(0);
            const currencyInput = ref('');
            
            // UI State
            const showAddModal = ref(false);
            const showShopModal = ref(false);
            const showExpenseModal = ref(false);
            const showSplitModal = ref(false);
            const expenseMode = ref('personal');

            const tripDays = [
                { date: '2026-03-27', week: 'Fri', dateNum: '27' },
                { date: '2026-03-28', week: 'Sat', dateNum: '28' },
                { date: '2026-03-29', week: 'Sun', dateNum: '29' },
                { date: '2026-03-30', week: 'Mon', dateNum: '30' },
                { date: '2026-03-31', week: 'Tue', dateNum: '31' },
                { date: '2026-04-01', week: 'Wed', dateNum: '01' },
                { date: '2026-04-02', week: 'Thu', dateNum: '02' },
                { date: '2026-04-03', week: 'Fri', dateNum: '03' }
            ];

            const itineraryData = ref([
                [ 
                    { id: 1, category: 'Flight', name: 'é…·èˆª TR898 èµ·é£›', hours: '06:40', note: 'æ¡ƒåœ’ç¬¬ä¸€èˆªå»ˆ', travelTime: 0, transportType: 'flight' },
                    { id: 2, category: 'Flight', name: 'æŠµé”æ±äº¬æˆç”°', hours: '10:40', note: 'æˆç”°ç¬¬ä¸€èˆªå»ˆ', travelTime: 240, transportType: 'flight' },
                    { id: 3, category: 'Sightseeing', name: 'æ™´ç©ºå¡”', hours: '10:00-21:00', ticket: 'Â¥2100', note: 'å¿…æ‹åœ°æ¨™', travelTime: 60, transportType: 'train' },
                    { id: 4, category: 'Food', name: 'æ™šé¤ï¼šéŒ¦ç³¸ç”ºå‘¨é­', hours: '', note: 'å±…é…’å±‹æˆ–æ‹‰éºµ', travelTime: 15, transportType: 'walk' }
                ],
                [ 
                    { id: 5, category: 'Sightseeing', name: 'æ·ºè‰å¯º', hours: '06:00-17:00', note: 'é›·é–€æ‹ç…§', travelTime: 20, transportType: 'train' },
                    { id: 6, category: 'Food', name: 'æ·ºè‰å‘¨é­åˆé¤', hours: '', note: 'ç‚¸ç‰›æ’æˆ–å¤©å©¦ç¾…', travelTime: 5, transportType: 'walk' },
                    { id: 7, category: 'Sightseeing', name: 'å°ç¶²ç¥ç¤¾', hours: '', note: 'æ´—éŒ¢å¼è²¡å¤©', travelTime: 20, transportType: 'train' },
                    { id: 8, category: 'Sightseeing', name: 'ä¸Šé‡æ©è³œå…¬åœ’', hours: '', note: 'è³æ«»èŠ±', travelTime: 15, transportType: 'train' },
                    { id: 9, category: 'Shopping', name: 'ç§‹è‘‰åŸ / æ±äº¬ä¸€ç•ªè¡—', hours: '', note: 'æ‰­è›‹ã€å‹•æ¼«å‘¨é‚Š', travelTime: 10, transportType: 'train' }
                ],
                [
                    { id: 10, category: 'Transport', name: 'å‰å¾€å¯Œå£«å±±ç§Ÿè»Š', hours: '09:00', note: 'Toyota Rent a Car', travelTime: 120, transportType: 'car' },
                    { id: 11, category: 'Sightseeing', name: 'æ²³å£æ¹–è‡ªç„¶ç”Ÿæ´»é¤¨', hours: '', note: 'å¤§çŸ³å…¬åœ’çœ‹å¯Œå£«å±±', travelTime: 30, transportType: 'car' },
                    { id: 12, category: 'Sightseeing', name: 'æ–°å€‰å¯Œå£«æ·ºé–“ç¥ç¤¾', hours: '', note: 'éœ€çˆ¬æ¨“æ¢¯ï¼Œè‘—åäº”é‡å¡”æ™¯', travelTime: 20, transportType: 'car' },
                    { id: 13, category: 'Sightseeing', name: 'é‡‘é³¥å±… & æœ¬ç”ºå•†åº—è¡—', hours: '', note: 'æ˜­å’Œå¾©å¤è¡—é“', travelTime: 15, transportType: 'car' },
                    { id: 14, category: 'Food', name: 'è‡ªè¡Œçƒ¹é£ª / å•†åº—è¡—', hours: '', note: 'è¶…å¸‚è²·å’Œç‰›', travelTime: 10, transportType: 'car' }
                ],
                [
                    { id: 15, category: 'Sightseeing', name: 'å¹³é‡ä¹‹æ¿±çœ‹æ—¥å‡º', hours: '05:30', note: 'çµ•ç¾é€†å¯Œå£«', travelTime: 20, transportType: 'car' },
                    { id: 16, category: 'Sightseeing', name: 'é•·æ± è¦ªæ°´å…¬åœ’', hours: '', note: 'è‡ªè¡Œè»Šç’°æ¹–', travelTime: 15, transportType: 'bike' },
                    { id: 17, category: 'Food', name: 'å±±ä¸­æ¹–åˆé¤', hours: '', note: 'Houtou éºµ', travelTime: 10, transportType: 'bike' },
                    { id: 18, category: 'Sightseeing', name: 'KABA æ°´é™¸å·´å£«', hours: '', note: 'è¡é€²æ¹–è£¡', travelTime: 15, transportType: 'bike' },
                    { id: 19, category: 'Food', name: 'Ogino è¶…å¸‚æ¡è²·', hours: '', note: 'ä»Šæ™šç«é‹æ´¾å°', travelTime: 20, transportType: 'car' }
                ],
                [
                    { id: 20, category: 'Sightseeing', name: 'æ²³å£æ¹–çºœè»Š', hours: '09:00', note: 'å¤©ä¸Šå±±å…¬åœ’é¦éŸ†', travelTime: 20, transportType: 'car' },
                    { id: 21, category: 'Food', name: 'Fujisan Shokupan', hours: '', note: 'å¯Œå£«å±±åå¸', travelTime: 10, transportType: 'car' },
                    { id: 22, category: 'Transport', name: 'å¯Œå£«å›éŠ -> æ–°å®¿', hours: '14:00', note: 'ç›´é”ç‰¹æ€¥', travelTime: 110, transportType: 'train' },
                    { id: 23, category: 'Shopping', name: 'æ± è¢‹å¤ªé™½åŸ', hours: '', note: 'æ°´æ—é¤¨ã€å¯¶å¯å¤¢ä¸­å¿ƒ', travelTime: 15, transportType: 'train' }
                ],
                [
                    { id: 24, category: 'Sightseeing', name: 'éŒå€‰æ±Ÿä¹‹é›»ä¸€æ—¥éŠ', hours: '', note: 'è—¤æ¾¤å‡ºç™¼', travelTime: 50, transportType: 'train' },
                    { id: 25, category: 'Sightseeing', name: 'æ±Ÿä¹‹å³¶ & éŒå€‰é«˜æ ¡å‰', hours: '', note: 'çŒç±ƒé«˜æ‰‹å¹³äº¤é“', travelTime: 20, transportType: 'train' },
                    { id: 26, category: 'Food', name: 'ä¸ƒé‡Œæ¿±åˆé¤', hours: '', note: 'æµ·æ™¯é¬†é¤… Bills', travelTime: 10, transportType: 'walk' },
                    { id: 27, category: 'Sightseeing', name: 'é¶´å²¡å…«å¹¡å®®', hours: '', note: 'å•†åº—è¡—', travelTime: 20, transportType: 'train' }
                ],
                [
                    { id: 28, category: 'Sightseeing', name: 'æ±äº¬éµå¡” / éº»å¸ƒå°Hills', hours: '', note: 'æœ€æ–°åœ°æ¨™', travelTime: 30, transportType: 'train' },
                    { id: 29, category: 'Food', name: 'å…­æœ¬æœ¨åˆé¤', hours: '', note: '', travelTime: 15, transportType: 'walk' },
                    { id: 30, category: 'Sightseeing', name: 'SHIBUYA SKY', hours: '16:00', ticket: 'Â¥2200', note: 'éœ€é ç´„å¤•é™½å ´', travelTime: 20, transportType: 'train' },
                    { id: 31, category: 'Shopping', name: 'æ¾€è°·é€›è¡—', hours: '', note: 'Parco, Loft', travelTime: 10, transportType: 'walk' }
                ],
                [
                    { id: 32, category: 'Sightseeing', name: 'è‡ªç”±è¡Œç¨‹', hours: '', note: 'è£œè²¨æ™‚é–“', travelTime: 0, transportType: 'walk' },
                    { id: 33, category: 'Flight', name: 'é•·æ¦® BR195 èµ·é£›', hours: '20:40', note: 'æˆç”°ç¬¬ä¸€èˆªå»ˆ', travelTime: 60, transportType: 'train' },
                    { id: 34, category: 'Flight', name: 'æŠµé”æ¡ƒåœ’', hours: '23:20', note: 'å›å®¶å›‰', travelTime: 220, transportType: 'flight' }
                ]
            ]);

            const shoppingList = ref([{ name: 'å‰ä¼Šå¡å“‡ç©å¶', image: '' }, { name: 'è—¥å¦åº—é¢è†œ', image: '' }]);
            const prepList = ref([
                { text: 'è­·ç…§ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)', checked: false },
                { text: 'Visit Japan Web æˆªåœ–', checked: false },
                { text: 'æ—¥å¹£ç¾é‡‘', checked: false },
                { text: 'ä¿¡ç”¨å¡ (æµ·å¤–å›é¥‹é«˜)', checked: false },
                { text: 'ç¶²å¡ / æ¼«éŠé–‹é€š', checked: false },
                { text: 'é§•ç…§ + æ—¥æ–‡è­¯æœ¬ (è‡ªé§•ç”¨)', checked: false }
            ]);
            const expenses = ref([{ category: 'Transport', name: 'è¥¿ç“œå¡å„²å€¼', date: '03/27', amount: 5000, payment: 'ç¾é‡‘' }]);
            
            const splitMembers = ref(['æˆ‘', 'å°å…«', 'å…”å…”']);
            const splitBills = ref([]);
            
            // Models
            const newPrepInput = ref('');
            const newItem = ref({ name: '', category: 'Sightseeing', hours: '', ticket: '', note: '', travelTime: 15, transportType: 'walk' });
            const newShopItem = ref({ name: '', image: null });
            const newExpense = ref({ category: 'Food', name: '', amount: '', payment: 'ç¾é‡‘', date: '' });
            const newSplit = ref({ item: '', amount: '', payer: 'æˆ‘' });

            const currentDayItinerary = computed(() => itineraryData.value[selectedDayIndex.value] || []);
            const totalExpenses = computed(() => expenses.value.reduce((sum, item) => sum + Number(item.amount), 0));

            const getCategoryIcon = (cat) => {
                const map = { 'Sightseeing': 'fa-camera', 'Food': 'fa-utensils', 'Shopping': 'fa-bag-shopping', 'Flight': 'fa-plane', 'Transport': 'fa-train-subway', 'Hotel': 'fa-hotel', 'Other': 'fa-star' };
                return map[cat] || 'fa-star';
            };
            const getTransportIcon = (type) => {
                const map = { 'walk': 'fa-person-walking', 'car': 'fa-car', 'train': 'fa-train-subway', 'bike': 'fa-bicycle', 'flight': 'fa-plane' };
                return map[type] || 'fa-person-walking';
            };

            // ä¿®æ­£ç‰ˆï¼šä½¿ç”¨æ­£ç¢ºçš„ URL æ ¼å¼ (Google Maps Search API)
            const openMap = (keyword) => {
                const url = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(keyword);
                window.open(url, '_blank');
            };

            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => newShopItem.value.image = e.target.result;
                    reader.readAsDataURL(file);
                }
            };
            const addShopItem = () => {
                if(!newShopItem.value.name) return;
                shoppingList.value.push({ ...newShopItem.value });
                showShopModal.value = false;
                newShopItem.value = { name: '', image: null };
            };
            const addItem = () => {
                if(!newItem.value.name) return;
                const list = itineraryData.value[selectedDayIndex.value];
                list.push({ ...newItem.value, id: Date.now() });
                showAddModal.value = false;
                newItem.value = { name: '', category: 'Sightseeing', hours: '', ticket: '', note: '', travelTime: 15, transportType: 'walk' };
            };
            const deleteItem = (idx) => {
                if(confirm('åˆªé™¤æ­¤è¡Œç¨‹ï¼Ÿ')) itineraryData.value[selectedDayIndex.value].splice(idx, 1);
            };
            const addPrepItem = () => {
                if(!newPrepInput.value) return;
                prepList.value.push({ text: newPrepInput.value, checked: false });
                newPrepInput.value = '';
            };
            const removePrepItem = (idx) => prepList.value.splice(idx, 1);
            const addExpense = () => {
                if(!newExpense.value.amount) return;
                const today = new Date();
                const dateStr = `${(today.getMonth()+1).toString().padStart(2, '0')}/${today.getDate().toString().padStart(2, '0')}`;
                expenses.value.push({ ...newExpense.value, date: dateStr });
                showExpenseModal.value = false;
                newExpense.value = { category: 'Food', name: '', amount: '', payment: 'ç¾é‡‘', date: '' };
            };
            const addMember = () => {
                const name = prompt('è«‹è¼¸å…¥æˆå“¡åç¨±ï¼š');
                if(name) splitMembers.value.push(name);
            };
            const removeMember = (idx) => {
                if(confirm(`ç§»é™¤æˆå“¡ ${splitMembers.value[idx]}ï¼Ÿ`)) splitMembers.value.splice(idx, 1);
            };
            const addSplitBill = () => {
                if(!newSplit.value.amount || !newSplit.value.item) return;
                splitBills.value.push({ ...newSplit.value });
                showSplitModal.value = false;
                newSplit.value = { item: '', amount: '', payer: splitMembers.value[0] || 'æˆ‘' };
            };

            onMounted(() => {
                // ç¢ºä¿ DOM æ¸²æŸ“å¾Œå†é¡¯ç¤ºå…§å®¹
                isMounted.value = true;
            });

            return {
                isMounted,
                currentTab, selectedDayIndex, tripDays, currentDayItinerary, 
                getCategoryIcon, getTransportIcon, openMap, currencyInput,
                showAddModal, newItem, addItem, deleteItem,
                shoppingList, showShopModal, newShopItem, handleImageUpload, addShopItem,
                expenses, totalExpenses, showExpenseModal, newExpense, addExpense, expenseMode,
                prepList, newPrepInput, addPrepItem, removePrepItem,
                splitMembers, splitBills, showSplitModal, newSplit, addMember, removeMember, addSplitBill
            };
        }
    }).mount('#app');
</script>

</body>
</html>