<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 關東8日女子旅 | 雲端同步版</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

    <style>
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #fff5f7;
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* 櫻花飄落 */
        .sakura-bg {
            background-image: url('https://placehold.co/100x100/FFC0CB/ffffff?text=❀&font=roboto');
            background-size: 50px 50px;
            opacity: 0.1;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            animation: moveBackground 30s linear infinite;
        }
        @keyframes moveBackground {
            from { background-position: 0 0; }
            to { background-position: 100% 100%; }
        }

        /* 擬真水彩 */
        .watercolor-img {
            filter: contrast(1.1) brightness(1.05) saturate(1.2);
            border-radius: 12px;
            border: 4px solid #fff;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* 頁面切換 */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }

        /* 吉伊卡哇懸浮 */
        .chiikawa-float { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
    </style>
</head>
<body class="text-gray-700">

<div id="app">
    <div class="sakura-bg"></div>

    <header class="fixed top-0 left-0 w-full bg-pink-100/95 backdrop-blur shadow-sm z-50 h-14 flex items-center justify-between px-4">
        <div class="flex items-center gap-2">
            <button v-if="currentPage !== 'home'" @click="goHome" class="text-pink-600 font-bold hover:bg-pink-200 p-2 rounded-full transition">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <h1 class="text-lg font-bold text-pink-600 truncate">{{ pageTitle }}</h1>
        </div>
        
        <div class="flex gap-2">
            <button @click="generateShareLink" class="text-xs bg-pink-500 text-white px-3 py-1.5 rounded-full shadow hover:bg-pink-600 transition flex items-center gap-1">
                <i class="fa-solid fa-link"></i> 同步/存檔
            </button>
        </div>
    </header>

    <div class="h-16"></div>

    <transition name="fade" mode="out-in">
        
        <div v-if="currentPage === 'home'" key="home" class="px-4 pb-24">
            <div class="bg-white rounded-2xl p-6 shadow-lg mb-6 text-center border-2 border-pink-200 relative overflow-hidden">
                <img src="https://placehold.co/600x200/FFEFF4/FF69B4?text=Tokyo+Trip+2026&font=playfair" class="w-full h-32 object-cover rounded-xl mb-4 watercolor-img">
                <h2 class="text-2xl font-bold text-pink-600">關東8日女子旅</h2>
                <p class="text-xs text-gray-500 mt-1">東京・鎌倉・富士山自駕</p>
                <div class="absolute -bottom-2 right-2 chiikawa-float">
                    <div class="bg-white/90 border border-pink-300 rounded-lg p-2 shadow text-center">
                        <div class="text-[10px] text-pink-500">倒數</div>
                        <div class="text-lg font-black text-pink-600">{{ countdownDays }} <span class="text-xs">天</span></div>
                    </div>
                </div>
            </div>

            <div v-if="showSyncTip" class="bg-blue-50 text-blue-700 text-xs p-3 rounded-lg mb-4 border border-blue-200 flex justify-between items-center">
                <span><i class="fa-solid fa-circle-info"></i> 資料已從連結載入成功！</span>
                <button @click="showSyncTip = false"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button @click="navigate('itinerary')" class="btn-menu border-pink-200 text-pink-500">
                    <i class="fa-solid fa-map-location-dot text-3xl mb-2"></i>行程表
                </button>
                <button @click="navigate('accounting')" class="btn-menu border-yellow-200 text-yellow-500">
                    <i class="fa-solid fa-calculator text-3xl mb-2"></i>分帳趣
                </button>
                <button @click="navigate('shopping')" class="btn-menu border-purple-200 text-purple-500">
                    <i class="fa-solid fa-bag-shopping text-3xl mb-2"></i>必買榜
                </button>
                <button @click="navigate('preparation')" class="btn-menu border-green-200 text-green-500">
                    <i class="fa-solid fa-suitcase-rolling text-3xl mb-2"></i>行前 & 票
                </button>
                <button @click="navigate('weather')" class="btn-menu border-blue-200 text-blue-400">
                    <i class="fa-solid fa-cloud-sun-rain text-3xl mb-2"></i>氣象穿搭
                </button>
                <button @click="navigate('emergency')" class="btn-menu border-red-200 text-red-500 bg-red-50">
                    <i class="fa-solid fa-kit-medical text-3xl mb-2"></i>急救站
                </button>
            </div>
        </div>

        <div v-else-if="currentPage === 'itinerary'" key="itinerary" class="px-4 pb-24">
            <div class="flex justify-between items-center mb-4">
                <div class="text-sm text-gray-500">點擊筆可編輯內容</div>
                <button @click="toggleEdit" :class="editMode ? 'bg-pink-500 text-white' : 'bg-pink-100 text-pink-600'" class="px-4 py-1 rounded-full text-sm font-bold transition shadow">
                    <i class="fa-solid fa-pen"></i> {{ editMode ? '完成編輯' : '編輯模式' }}
                </button>
            </div>

            <div v-for="(day, index) in itinerary" :key="index" class="mb-6 bg-white p-4 rounded-xl shadow-sm border-l-4 border-pink-400 relative">
                <div class="absolute -right-2 -top-2 text-4xl text-pink-50 opacity-40 font-black">{{ index + 1 }}</div>
                <h3 class="font-bold text-lg mb-3 flex items-center gap-2">
                    <span class="bg-pink-500 text-white text-xs px-2 py-1 rounded">Day {{ index + 1 }}</span>
                    {{ day.area }}
                </h3>
                
                <div class="space-y-4 relative z-10">
                    <div v-for="(item, i) in day.events" :key="i" class="flex gap-3 text-sm border-b border-gray-100 pb-2 last:border-0">
                        <div v-if="!editMode" class="w-12 font-mono text-gray-400 font-bold pt-0.5">{{ item.time }}</div>
                        <div v-else class="w-16">
                            <input v-model="item.time" class="w-full border rounded px-1 bg-gray-50 text-xs">
                        </div>

                        <div class="flex-1">
                            <template v-if="!editMode">
                                <div class="font-bold text-gray-700 text-base">{{ item.title }}</div>
                                <div v-if="item.note" class="text-gray-500 text-xs mt-1 bg-gray-50 inline-block px-2 py-0.5 rounded">
                                    <i class="fa-regular fa-note-sticky text-pink-300"></i> {{ item.note }}
                                </div>
                            </template>
                            <template v-else>
                                <input v-model="item.title" class="w-full border rounded px-2 py-1 mb-1 bg-gray-50 font-bold">
                                <textarea v-model="item.note" class="w-full border rounded px-2 py-1 text-xs bg-gray-50" rows="1" placeholder="備註"></textarea>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-else-if="currentPage === 'accounting'" key="accounting" class="px-4 pb-24">
            <div class="bg-white p-3 rounded-xl shadow-sm mb-4 flex justify-between items-center">
                <span class="font-bold text-gray-600">幣別切換</span>
                <div class="flex bg-gray-100 rounded-lg p-1">
                    <button @click="currency = 'JPY'" :class="currency==='JPY'?'bg-white shadow text-pink-600':'text-gray-400'" class="px-3 py-1 rounded text-xs font-bold transition">JPY</button>
                    <button @click="currency = 'TWD'" :class="currency==='TWD'?'bg-white shadow text-pink-600':'text-gray-400'" class="px-3 py-1 rounded text-xs font-bold transition">TWD</button>
                </div>
            </div>

            <div class="bg-pink-50 p-4 rounded-xl border border-pink-200 mb-6 shadow-inner">
                <h3 class="font-bold text-pink-600 mb-3 text-sm">記上一筆</h3>
                <div class="flex gap-2 mb-2">
                    <input v-model="newExp.item" placeholder="項目" class="flex-1 p-2 rounded border-none shadow-sm text-sm">
                    <input v-model.number="newExp.amount" type="number" placeholder="日幣金額" class="w-24 p-2 rounded border-none shadow-sm text-sm">
                </div>
                <div class="flex gap-2 items-center">
                    <span class="text-xs text-gray-500">誰先付:</span>
                    <button v-for="p in ['我','旅伴']" @click="newExp.payer = p" :class="newExp.payer === p ? 'bg-pink-500 text-white' : 'bg-white text-gray-500'" class="px-3 py-1 rounded-full text-xs shadow-sm transition">{{ p }}</button>
                    <button @click="addExp" class="ml-auto bg-gray-800 text-white px-4 py-1 rounded-lg text-xs font-bold shadow hover:bg-black">新增</button>
                </div>
            </div>

            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-xl shadow border border-yellow-100 mb-6 text-center">
                <h3 class="text-xs font-bold text-yellow-700 mb-1">目前結算 (自動對分)</h3>
                <div v-if="balance.val === 0" class="text-green-600 font-bold">目前兩清！</div>
                <div v-else>
                    <span class="font-bold text-gray-800">{{ balance.from }}</span> 需給 <span class="font-bold text-gray-800">{{ balance.to }}</span>
                    <div class="text-2xl font-black text-pink-600 my-1">{{ fmt(balance.val) }}</div>
                </div>
            </div>

            <div class="space-y-2">
                <div v-for="(e, i) in expenses" :key="i" class="bg-white p-3 rounded-lg shadow-sm flex justify-between items-center">
                    <div>
                        <div class="font-bold text-gray-700 text-sm">{{ e.item }}</div>
                        <div class="text-[10px] text-gray-400">{{ e.payer }} 先付</div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-mono font-bold text-pink-600">{{ fmt(e.amount) }}</span>
                        <button @click="delExp(i)" class="text-gray-300 hover:text-red-500"><i class="fa-solid fa-trash"></i></button>
                    </div>
                </div>
            </div>
        </div>

        <div v-else-if="currentPage === 'shopping'" class="px-4">
             <h3 class="font-bold text-pink-600 mb-4">必買清單 (示意)</h3>
             <div class="grid grid-cols-2 gap-4">
                <div v-for="i in 4" class="bg-white p-2 rounded-xl shadow watercolor-img">
                    <img src="https://placehold.co/150x150/FFEFF4/FF69B4?text=Product" class="w-full rounded mb-2">
                    <div class="text-xs font-bold text-gray-600">熱門商品 {{i}}</div>
                </div>
             </div>
        </div>
        
        <div v-else-if="currentPage === 'preparation'" class="px-4">
            <h3 class="font-bold text-green-600 mb-4">票券自動檢查</h3>
            <button @click="checkTickets" class="w-full bg-green-500 text-white p-3 rounded-xl shadow mb-4">一鍵生成建議票券</button>
            <div v-for="t in tickets" class="bg-white border-l-4 border-green-500 p-3 rounded shadow mb-2">
                <div class="font-bold text-green-700">{{ t.name }}</div>
                <div class="text-xs text-gray-500">{{ t.desc }}</div>
            </div>
        </div>

        <div v-else-if="currentPage === 'weather'" class="px-4">
            <h3 class="font-bold text-blue-500 mb-4">氣象與穿搭</h3>
            <div class="bg-white p-4 rounded-xl shadow text-center">
                <i class="fa-solid fa-cloud-sun text-4xl text-yellow-400 mb-2"></i>
                <div class="font-bold">3/28 東京</div>
                <div class="text-sm text-gray-500">12°C - 18°C</div>
                <div class="mt-2 text-xs bg-pink-100 text-pink-600 inline-block px-2 py-1 rounded">建議：薄風衣 + 針織衫</div>
            </div>
        </div>
        
        <div v-else-if="currentPage === 'emergency'" class="px-4">
             <button class="w-full bg-white border-2 border-red-200 p-4 rounded-xl shadow mb-4 flex items-center gap-4">
                <i class="fa-solid fa-camera text-2xl text-red-500"></i>
                <div class="text-left font-bold">開啟翻譯相機</div>
            </button>
        </div>

    </transition>
</div>

<style>
    .btn-menu {
        @apply p-4 bg-white rounded-xl shadow-md border-b-4 active:border-b-0 active:translate-y-1 transition flex flex-col items-center justify-center h-24 font-bold;
    }
</style>

<script>
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const currentPage = ref('home');
            const pageTitle = ref('Home');
            const editMode = ref(false);
            const showSyncTip = ref(false);
            const currency = ref('JPY');
            const exRate = 0.22;

            // --- 資料核心 ---
            // 完整行程資料
            const itinerary = ref([
                { area: '抵達 & 晴空塔', events: [
                    { time: '06:40', title: '桃園起飛 (IT200)', note: 'T1' },
                    { time: '10:40', title: '抵達東京成田', note: '領西瓜卡' },
                    { time: '14:00', title: '晴空塔', note: '事先購票' },
                    { time: '18:00', title: '錦糸町晚餐', note: '燒肉或居酒屋' }
                ]},
                { area: '淺草 & 上野', events: [
                    { time: '09:00', title: '淺草寺參拜', note: '雷門拍照' },
                    { time: '12:00', title: '午餐: 淺草周邊', note: '文字燒/天婦羅' },
                    { time: '14:00', title: '小網神社', note: '強運厄除' },
                    { time: '15:30', title: '上野恩賜公園', note: '賞櫻' },
                    { time: '18:00', title: '秋葉原/東京一番街', note: '逛街' },
                    { time: '20:00', title: '晚餐', note: '依逛街地決定' }
                ]},
                { area: '出發富士山', events: [
                    { time: '09:00', title: '錦糸町出發 -> 富士山', note: '開始租車 (3天2夜)' },
                    { time: '13:00', title: '河口湖自然生活館', note: '看富士山' },
                    { time: '15:00', title: '新倉富士淺間神社', note: '需爬階梯' },
                    { time: '17:00', title: '金鳥居 & 本町商店街', note: '拍照點' },
                    { time: '19:00', title: '晚餐', note: '自煮 or 商店街' }
                ]},
                { area: '山中湖單車', events: [
                    { time: '05:30', title: '平野之濱日出', note: '早起注意保暖' },
                    { time: '09:00', title: '山中湖租單車', note: '長池親水公園/白鳥濱' },
                    { time: '12:00', title: '午餐: 山中湖', note: '' },
                    { time: '14:00', title: 'KABA 水陸巴士', note: '旭日丘湖畔' },
                    { time: '18:00', title: 'Ogino 超市採買', note: '買食材回宿煮' }
                ]},
                { area: '纜車 & 返回新宿', events: [
                    { time: '09:00', title: '金鳥居補拍 / 纜車', note: '絕景鞦韆' },
                    { time: '11:00', title: 'Fujisan shokupan', note: '買吐司伴手禮' },
                    { time: '14:00', title: '富士回遊 -> 新宿', note: '還車後搭車' },
                    { time: '17:00', title: '池袋太陽城', note: 'Check-in 放行李' },
                    { time: '19:00', title: '晚餐: 太陽城內', note: '' }
                ]},
                { area: '鎌倉江之電', events: [
                    { time: '09:00', title: '新宿 -> 藤澤', note: '江之電一日遊' },
                    { time: '10:30', title: '江之島', note: '吻仔魚丼' },
                    { time: '13:00', title: '鎌倉高校前', note: '灌籃高手' },
                    { time: '14:00', title: '七里濱', note: '午餐/下午茶' },
                    { time: '16:00', title: '鎌倉小町通', note: '' },
                    { time: '19:00', title: '返回新宿晚餐', note: '自煮 or 外食' }
                ]},
                { area: '澀谷潮流', events: [
                    { time: '09:00', title: '東京鐵塔', note: '拍照' },
                    { time: '10:30', title: '六本木/麻布台Hills', note: '' },
                    { time: '12:00', title: '午餐: 六本木', note: '' },
                    { time: '14:00', title: '前往澀谷', note: '逛街' },
                    { time: '16:30', title: 'SHIBUYA SKY', note: '夕陽場需預約' },
                    { time: '19:00', title: '澀谷十字路口', note: '最後採買/晚餐' }
                ]},
                { area: '返台', events: [
                    { time: 'Free', title: '自由補貨時間', note: '整理行李' },
                    { time: '17:00', title: '前往成田機場', note: 'NEX/Skyliner' },
                    { time: '20:40', title: '起飛 (IT201)', note: 'T1' },
                    { time: '23:20', title: '抵達桃園', note: 'End' }
                ]}
            ]);

            const expenses = ref([]);
            const newExp = reactive({ item: '', amount: null, payer: '我' });
            const tickets = ref([]);

            // --- 計算屬性 ---
            const countdownDays = computed(() => {
                const diff = new Date('2026-03-28') - new Date();
                return Math.max(0, Math.ceil(diff / (1000 * 60 * 60 * 24)));
            });

            const balance = computed(() => {
                let myPaid = 0, total = 0;
                expenses.value.forEach(e => {
                    total += e.amount;
                    if(e.payer === '我') myPaid += e.amount;
                });
                const perPerson = total / 2;
                const diff = myPaid - perPerson;
                if(Math.abs(diff) < 1) return { val: 0 };
                return {
                    from: diff > 0 ? '旅伴' : '我',
                    to: diff > 0 ? '我' : '旅伴',
                    val: Math.abs(diff)
                };
            });

            // --- 功能函數 ---
            const navigate = (p) => { 
                currentPage.value = p; 
                pageTitle.value = { itinerary:'行程表', accounting:'分帳表', home:'Home' }[p] || p;
                window.scrollTo(0,0);
            };
            const goHome = () => { navigate('home'); editMode.value = false; };
            const toggleEdit = () => editMode.value = !editMode.value;
            const addExp = () => {
                if(newExp.item && newExp.amount) {
                    expenses.value.push({...newExp});
                    newExp.item = ''; newExp.amount = null;
                    saveLocal();
                }
            };
            const delExp = (i) => { expenses.value.splice(i,1); saveLocal(); };
            const fmt = (n) => currency.value === 'JPY' ? `¥${Math.round(n).toLocaleString()}` : `NT$${Math.round(n*exRate).toLocaleString()}`;
            
            const checkTickets = () => {
                tickets.value = [
                    {name:'Skyliner 來回', desc:'機場交通'},
                    {name:'SHIBUYA SKY', desc:'Day7 黃昏場需搶票'},
                    {name:'江之島鎌倉周遊券', desc:'Day6 江之電無限搭'}
                ];
                saveLocal();
            };

            // --- 核心：同步與存檔 (Magic Link) ---
            const saveLocal = () => {
                const data = { it: itinerary.value, ex: expenses.value, ti: tickets.value };
                localStorage.setItem('trip2026', JSON.stringify(data));
            };

            const loadLocal = () => {
                // 1. 優先檢查網址是否有資料 (Import)
                const urlParams = new URLSearchParams(window.location.search);
                const syncData = urlParams.get('data');
                
                if (syncData) {
                    try {
                        const json = LZString.decompressFromEncodedURIComponent(syncData);
                        const data = JSON.parse(json);
                        if(data.it) itinerary.value = data.it;
                        if(data.ex) expenses.value = data.ex;
                        if(data.ti) tickets.value = data.ti;
                        showSyncTip.value = true;
                        // 載入後存入 LocalStorage 並清除網址讓看起來乾淨
                        saveLocal();
                        window.history.replaceState({}, document.title, window.location.pathname);
                    } catch(e) { console.error('Sync failed', e); }
                } else {
                    // 2. 否則從 LocalStorage 讀取
                    const saved = localStorage.getItem('trip2026');
                    if(saved) {
                        const data = JSON.parse(saved);
                        if(data.it) itinerary.value = data.it;
                        if(data.ex) expenses.value = data.ex;
                        if(data.ti) tickets.value = data.ti;
                    }
                }
            };

            const generateShareLink = () => {
                saveLocal(); // 先存
                const data = { it: itinerary.value, ex: expenses.value, ti: tickets.value };
                const json = JSON.stringify(data);
                const compressed = LZString.compressToEncodedURIComponent(json);
                const url = `${window.location.origin}${window.location.pathname}?data=${compressed}`;
                
                // 複製到剪貼簿
                navigator.clipboard.writeText(url).then(() => {
                    alert('✨ 同步連結已複製！\n\n請將此連結傳給旅伴，或貼到您的手機瀏覽器開啟，\n資料就會自動同步囉！');
                }).catch(() => {
                    prompt('請手動複製連結傳送：', url);
                });
            };

            onMounted(loadLocal);

            return {
                currentPage, pageTitle, navigate, goHome,
                itinerary, editMode, toggleEdit,
                expenses, newExp, addExp, delExp, balance, currency, fmt,
                tickets, checkTickets,
                generateShareLink, showSyncTip, countdownDays
            };
        }
    }).mount('#app');
</script>
</body>
</html>
