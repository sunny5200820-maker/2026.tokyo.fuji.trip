<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 é—œæ±8æ—¥å¥³å­æ—… | å‰ä¼Šå¡å“‡æ«»èŠ±ç‰¹åˆ¥ç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>

    <style>
        /* --- å…¨ç«™ä¸»é¡Œè¨­å®š --- */
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #fff0f5; /* æ·ºç²‰æ«»è‰² */
            color: #5d4037; /* æš–æ£•è‰²æ–‡å­— */
            overscroll-behavior-y: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* æ«»èŠ±é£„è½èƒŒæ™¯å‹•ç•« */
        .sakura-bg {
            background-image: url('https://placehold.co/100x100/FFC0CB/ffffff?text=â€&font=roboto');
            background-size: 60px 60px;
            opacity: 0.15;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            animation: moveBackground 25s linear infinite;
        }
        @keyframes moveBackground {
            from { background-position: 0 0; }
            to { background-position: 100% 100%; }
        }

        /* å‰ä¼Šå¡å“‡é¢¨æ ¼æ¼‚æµ®å‹•ç•« */
        .chiikawa-float { animation: float 3s ease-in-out infinite; }
        .chiikawa-float-delay { animation: float 3s ease-in-out infinite; animation-delay: 1.5s; }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-6px); }
        }

        /* æ“¬çœŸæ°´å½©åœ–ç‰‡æ¿¾é¡ (æ ¸å¿ƒæŠ€è¡“) */
        .watercolor-img {
            filter: contrast(1.1) brightness(1.08) saturate(1.3) blur(0.2px);
            mask-image: radial-gradient(circle, black 60%, transparent 100%);
            -webkit-mask-image: radial-gradient(circle, black 80%, transparent 100%);
            border-radius: 16px;
            border: 4px solid #fff;
            box-shadow: 0 6px 10px rgba(255, 182, 193, 0.4);
            background-color: white;
            transition: transform 0.2s;
        }
        .watercolor-img:active { transform: scale(0.98); }

        /* é é¢åˆ‡æ›éæ¸¡ */
        .fade-enter-active, .fade-leave-active { transition: opacity 0.25s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }

        /* æ¨¡æ“¬ç›¸æ©Ÿä»‹é¢ */
        .camera-overlay {
            background: rgba(0,0,0,0.85);
            position: fixed; inset: 0; z-index: 60;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .scan-frame {
            width: 70%; height: 40%;
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 0 1000px rgba(0,0,0,0.5);
        }
        .scan-line {
            width: 100%; height: 2px; background: #ff69b4;
            box-shadow: 0 0 10px #ff69b4;
            animation: scan 2s linear infinite;
        }
        @keyframes scan { 0% {transform: translateY(-200px);} 100% {transform: translateY(200px);} }

        /* è‡ªå®šç¾©æ»¾å‹•æ¢ */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #ffb7b2; border-radius: 4px; }
    </style>
</head>
<body>

<div id="app" @touchstart="handleTouchStart" @touchend="handleTouchEnd">
    <div class="sakura-bg"></div>

    <header class="fixed top-0 left-0 w-full bg-pink-100/95 backdrop-blur-md shadow-sm z-40 h-14 flex items-center justify-between px-4 border-b border-pink-200">
        <div class="flex items-center gap-3">
            <button v-if="currentPage !== 'home'" @click="goHome" class="text-pink-600 hover:bg-pink-200 p-2 rounded-full transition active:scale-90">
                <i class="fa-solid fa-chevron-left text-lg"></i>
            </button>
            <div class="flex flex-col">
                <h1 class="text-base font-bold text-pink-600 tracking-wide">{{ pageTitle }}</h1>
                <span v-if="editMode" class="text-[10px] text-pink-400 font-bold"><i class="fa-solid fa-pen"></i> ç·¨è¼¯æ¨¡å¼</span>
            </div>
        </div>
        <div class="flex gap-2">
            <div v-if="savedMessage" class="px-2 py-1 bg-green-100 text-green-600 text-xs rounded-full fade-enter-active">
                <i class="fa-solid fa-check"></i> å·²å­˜æª”
            </div>
        </div>
    </header>

    <div class="h-16"></div> <transition name="fade" mode="out-in">
        
        <div v-if="currentPage === 'home'" key="home" class="px-4 pb-24">
            
            <div class="relative bg-white rounded-3xl p-6 shadow-xl mb-6 text-center border-4 border-pink-100 overflow-hidden group">
                <div class="absolute -top-4 -left-4 w-16 h-16 bg-yellow-100 rounded-full opacity-50 blur-xl"></div>
                <div class="absolute bottom-0 right-0 text-6xl opacity-10 rotate-12">ğŸŒ¸</div>
                
                <img src="https://placehold.co/600x250/FFEFF4/FF69B4?text=2026+Tokyo+Trip&font=playfair" class="w-full h-36 object-cover rounded-2xl mb-4 watercolor-img shadow-md">
                
                <h2 class="text-2xl font-black text-pink-600 mb-1 tracking-wider" style="text-shadow: 1px 1px 0px #fff;">é—œæ±8æ—¥å¥³å­æ—…</h2>
                <div class="flex justify-center items-center gap-2 mb-2">
                    <span class="px-2 py-1 bg-pink-100 text-pink-500 text-xs rounded-lg font-bold">æ±äº¬</span>
                    <span class="px-2 py-1 bg-blue-100 text-blue-500 text-xs rounded-lg font-bold">å¯Œå£«å±±</span>
                    <span class="px-2 py-1 bg-green-100 text-green-500 text-xs rounded-lg font-bold">éŒå€‰</span>
                </div>

                <div class="chiikawa-float absolute top-2 right-2 bg-white/90 backdrop-blur border-2 border-pink-300 rounded-2xl p-2 shadow-lg z-10 transform rotate-6">
                    <div class="text-[10px] text-pink-500 font-bold text-center leading-tight">å€’æ•¸<br>å‡ºç™¼</div>
                    <div class="text-xl font-black text-pink-600 text-center">{{ countdownDays }}<span class="text-xs">å¤©</span></div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button @click="navigate('itinerary')" class="p-4 bg-white rounded-2xl shadow-md border-b-4 border-pink-200 active:border-b-0 active:translate-y-1 transition flex flex-col items-center gap-2 relative overflow-hidden group">
                    <div class="bg-pink-50 p-3 rounded-full group-hover:bg-pink-100 transition"><i class="fa-solid fa-map-location-dot text-2xl text-pink-500"></i></div>
                    <span class="font-bold text-gray-700">è¡Œç¨‹ç¸½è¦½</span>
                </button>
                <button @click="navigate('accounting')" class="p-4 bg-white rounded-2xl shadow-md border-b-4 border-yellow-200 active:border-b-0 active:translate-y-1 transition flex flex-col items-center gap-2 group">
                    <div class="bg-yellow-50 p-3 rounded-full group-hover:bg-yellow-100 transition"><i class="fa-solid fa-calculator text-2xl text-yellow-500"></i></div>
                    <span class="font-bold text-gray-700">åˆ†å¸³è¨ˆç®—</span>
                </button>
                <button @click="navigate('shopping')" class="p-4 bg-white rounded-2xl shadow-md border-b-4 border-purple-200 active:border-b-0 active:translate-y-1 transition flex flex-col items-center gap-2 group">
                    <div class="bg-purple-50 p-3 rounded-full group-hover:bg-purple-100 transition"><i class="fa-solid fa-bag-shopping text-2xl text-purple-500"></i></div>
                    <span class="font-bold text-gray-700">å¿…è²·æ¸…å–®</span>
                </button>
                <button @click="navigate('weather')" class="p-4 bg-white rounded-2xl shadow-md border-b-4 border-blue-200 active:border-b-0 active:translate-y-1 transition flex flex-col items-center gap-2 group">
                    <div class="bg-blue-50 p-3 rounded-full group-hover:bg-blue-100 transition"><i class="fa-solid fa-shirt text-2xl text-blue-400"></i></div>
                    <span class="font-bold text-gray-700">æ°£è±¡ç©¿æ­</span>
                </button>
                <button @click="navigate('preparation')" class="p-4 bg-white rounded-2xl shadow-md border-b-4 border-green-200 active:border-b-0 active:translate-y-1 transition flex flex-col items-center gap-2 group">
                    <div class="bg-green-50 p-3 rounded-full group-hover:bg-green-100 transition"><i class="fa-solid fa-ticket text-2xl text-green-500"></i></div>
                    <span class="font-bold text-gray-700">è¡Œå‰ & ç¥¨åˆ¸</span>
                </button>
                <button @click="navigate('emergency')" class="p-4 bg-red-50 rounded-2xl shadow-md border-b-4 border-red-200 active:border-b-0 active:translate-y-1 transition flex flex-col items-center gap-2 group">
                    <div class="bg-white p-3 rounded-full shadow-sm"><i class="fa-solid fa-truck-medical text-2xl text-red-500"></i></div>
                    <span class="font-bold text-red-600">å³æ™‚æ•‘å‘½</span>
                </button>
            </div>
            
            <div class="mt-8 text-center text-xs text-gray-400">
                <i class="fa-brands fa-github"></i> Data saves locally (GitHub Page Ready)
            </div>
        </div>

        <div v-else-if="currentPage === 'itinerary'" key="itinerary" class="px-4 pb-24">
            <div class="flex justify-between items-center mb-4 sticky top-14 bg-pink-50/95 p-2 z-30 rounded-lg backdrop-blur">
                <span class="text-xs text-gray-500 font-bold bg-white px-2 py-1 rounded-md shadow-sm">2026.03.28 - 04.04</span>
                <button @click="toggleEdit" :class="editMode ? 'bg-pink-500 text-white shadow-lg' : 'bg-white text-pink-600 border border-pink-200'" class="text-xs px-3 py-1.5 rounded-full font-bold transition">
                    {{ editMode ? 'å®Œæˆç·¨è¼¯' : 'ç·¨è¼¯è¡Œç¨‹' }}
                </button>
            </div>
            
            <div class="space-y-6">
                <div v-for="(day, index) in itinerary" :key="index" class="bg-white p-5 rounded-2xl shadow-sm border-2 border-pink-100 relative overflow-hidden">
                    <div class="absolute top-0 right-0 bg-pink-200 w-16 h-16 rounded-bl-full opacity-20 z-0"></div>
                    <div class="absolute top-2 right-2 font-black text-4xl text-pink-100 z-0">{{ index + 1 }}</div>

                    <h3 class="font-bold text-lg mb-4 text-pink-600 relative z-10 flex items-center gap-2">
                        <i class="fa-solid fa-calendar-day"></i> {{ day.date }}
                    </h3>
                    
                    <div class="space-y-4 relative z-10">
                        <div v-for="(item, i) in day.events" :key="i" class="flex gap-3 text-sm group">
                            <div class="w-14 flex-shrink-0 pt-1">
                                <input v-if="editMode" v-model="item.time" class="w-full bg-gray-50 border rounded px-1 text-xs">
                                <span v-else class="font-mono font-bold text-gray-400 bg-gray-50 px-1 rounded">{{ item.time }}</span>
                            </div>
                            <div class="flex-1 pb-3 border-b border-dashed border-gray-100 last:border-0">
                                <template v-if="!editMode">
                                    <div class="font-bold text-gray-700 text-base mb-1">{{ item.title }}</div>
                                    <div v-if="item.note" class="text-gray-500 text-xs flex items-start gap-1">
                                        <i class="fa-solid fa-comment-dots text-pink-300 mt-0.5"></i> {{ item.note }}
                                    </div>
                                    <a v-if="shouldShowMap(item.title)" 
                                       :href="getMapLink(item.title)" 
                                       target="_blank"
                                       class="inline-flex items-center gap-1 mt-2 text-[10px] bg-blue-50 text-blue-500 px-2 py-1 rounded-full hover:bg-blue-100 transition">
                                       <i class="fa-solid fa-location-arrow"></i> å°èˆªå»é€™è£¡
                                    </a>
                                </template>
                                <template v-else>
                                    <input v-model="item.title" class="w-full border rounded px-2 py-1 mb-1 text-sm font-bold placeholder-gray-300" placeholder="è¡Œç¨‹æ¨™é¡Œ">
                                    <input v-model="item.note" class="w-full border rounded px-2 py-1 text-xs placeholder-gray-300" placeholder="å‚™è¨»ç´°ç¯€">
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-else-if="currentPage === 'accounting'" key="accounting" class="px-4 pb-24">
            <div class="bg-white p-2 rounded-xl shadow-sm mb-4 flex justify-between items-center border border-pink-100">
                <span class="text-xs font-bold text-gray-500 pl-2">é¡¯ç¤ºå¹£åˆ¥ (åŒ¯ç‡: {{exchangeRate}})</span>
                <div class="flex bg-pink-50 rounded-lg p-1">
                    <button @click="currencyMode = 'JPY'" :class="{'bg-white text-pink-600 shadow-sm': currencyMode === 'JPY', 'text-gray-400': currencyMode !== 'JPY'}" class="px-3 py-1 rounded-md text-xs font-bold transition">JPY</button>
                    <button @click="currencyMode = 'TWD'" :class="{'bg-white text-pink-600 shadow-sm': currencyMode === 'TWD', 'text-gray-400': currencyMode !== 'TWD'}" class="px-3 py-1 rounded-md text-xs font-bold transition">TWD</button>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-md p-4 mb-6 border-t-4 border-pink-400 relative">
                <div class="absolute -top-3 left-4 bg-pink-400 text-white text-xs px-2 py-0.5 rounded">æ–°å¢æ”¯å‡º</div>
                <div class="grid grid-cols-5 gap-2 mb-3 mt-1">
                    <input v-model="newExpense.item" placeholder="é …ç›® (å¦‚: æ™šé¤)" class="col-span-3 p-2 bg-gray-50 rounded-lg text-sm border-none focus:ring-2 focus:ring-pink-200">
                    <input v-model.number="newExpense.amount" type="number" placeholder="Â¥é‡‘é¡" class="col-span-2 p-2 bg-gray-50 rounded-lg text-sm border-none focus:ring-2 focus:ring-pink-200">
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs text-gray-400">èª°å…ˆå¢Šä»˜?</span>
                    <div class="flex gap-2 flex-1">
                        <button v-for="user in ['æˆ‘', 'æ—…ä¼´']" :key="user" 
                            @click="newExpense.payer = user"
                            :class="newExpense.payer === user ? 'bg-pink-500 text-white' : 'bg-gray-100 text-gray-500'"
                            class="flex-1 py-1.5 rounded-lg text-xs font-bold transition">
                            {{ user }}
                        </button>
                    </div>
                    <button @click="addExpense" class="bg-gray-800 text-white w-16 py-1.5 rounded-lg text-xs font-bold active:scale-95 transition">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </div>
            </div>

            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-5 rounded-2xl shadow-sm border border-yellow-200 mb-6 text-center relative overflow-hidden">
                <i class="fa-solid fa-coins absolute -right-3 -bottom-3 text-6xl text-yellow-200 opacity-50"></i>
                <h3 class="text-xs font-bold text-yellow-700 tracking-widest mb-2">çµç®—ç‹€æ…‹ (è‡ªå‹•å°åˆ†)</h3>
                
                <div v-if="balanceResult.amount === 0" class="text-green-600 font-bold text-lg">
                    <i class="fa-regular fa-circle-check"></i> ç›®å‰å…©æ¸…ï¼
                </div>
                <div v-else>
                    <div class="flex justify-center items-end gap-2 text-gray-700 mb-1">
                        <span class="font-bold text-lg">{{ balanceResult.debtor }}</span>
                        <span class="text-xs pb-1">éœ€çµ¦</span>
                        <span class="font-bold text-lg">{{ balanceResult.creditor }}</span>
                    </div>
                    <div class="text-3xl font-black text-pink-500 tracking-tight">
                        {{ formatMoney(balanceResult.amount) }}
                    </div>
                    <div class="text-[10px] text-gray-400 mt-1">å·²è‡ªå‹•æ‰£æŠµé›™æ–¹å¢Šä»˜å·®é¡</div>
                </div>
            </div>

            <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                <div class="bg-gray-50 px-4 py-2 text-xs font-bold text-gray-500 flex justify-between">
                    <span>é …ç›®</span>
                    <span>é‡‘é¡</span>
                </div>
                <div v-for="(exp, index) in expenses" :key="index" class="p-3 border-b border-gray-100 last:border-0 flex justify-between items-center hover:bg-pink-50 transition">
                    <div>
                        <div class="font-bold text-gray-700 text-sm">{{ exp.item }}</div>
                        <div class="text-[10px] text-gray-400 flex items-center gap-1">
                            <span :class="exp.payer==='æˆ‘'?'text-pink-400':'text-blue-400'">â—</span>
                            {{ exp.payer }} å…ˆä»˜
                        </div>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="font-mono font-bold text-gray-600 text-sm">{{ formatMoney(exp.amount) }}</span>
                        <button @click="removeExpense(index)" class="text-gray-300 hover:text-red-400 px-2">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div v-else-if="currentPage === 'shopping'" key="shopping" class="px-4 pb-24">
            
            <div class="mb-8">
                <h3 class="text-lg font-bold text-pink-600 mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-crown text-yellow-400"></i> Cosme ç†±é–€è³
                </h3>
                <div class="grid grid-cols-2 gap-4">
                    <div v-for="item in shopping.cosme" :key="item.name" class="bg-white rounded-2xl p-3 shadow-md border border-pink-100">
                        <div class="relative mb-2">
                            <img :src="item.img" class="w-full h-32 object-cover watercolor-img" alt="Product">
                            <div class="absolute -top-2 -left-2 bg-yellow-400 text-white text-xs font-black w-6 h-6 flex items-center justify-content rounded-full shadow border-2 border-white pl-1.5">{{ item.rank }}</div>
                        </div>
                        <h4 class="font-bold text-sm text-gray-800 truncate">{{ item.name }}</h4>
                        <p class="text-xs text-gray-400">{{ item.brand }}</p>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-lg font-bold text-pink-600 mb-3 flex items-center gap-2">
                    <i class="fa-solid fa-book-open text-blue-400"></i> LDK æ¯’èˆŒé›œèªŒæ¨è–¦
                </h3>
                <div class="space-y-4">
                    <div v-for="item in shopping.ldk" :key="item.name" class="bg-white rounded-2xl p-3 shadow-md flex gap-3 items-center border border-pink-100">
                        <img :src="item.img" class="w-20 h-20 object-cover watercolor-img flex-shrink-0">
                        <div>
                            <span class="bg-pink-100 text-pink-600 text-[10px] px-2 py-0.5 rounded font-bold mb-1 inline-block">{{ item.category }}</span>
                            <h4 class="font-bold text-sm text-gray-800">{{ item.name }}</h4>
                            <p class="text-xs text-gray-500 mt-1 leading-tight">{{ item.desc }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-else-if="currentPage === 'weather'" key="weather" class="px-4 pb-24">
            <div class="bg-gradient-to-br from-pink-400 to-pink-600 text-white rounded-2xl p-5 mb-6 shadow-lg relative overflow-hidden">
                <div class="sakura-bg opacity-30"></div>
                <div class="flex justify-between items-start relative z-10">
                    <div>
                        <h3 class="font-bold text-lg"><i class="fa-solid fa-tree"></i> 2026 æ«»èŠ±é æ¸¬</h3>
                        <p class="text-xs text-pink-100 opacity-90">è¡Œç¨‹æœŸé–“: 3/28 - 4/04</p>
                    </div>
                    <div class="text-3xl chiikawa-float">ğŸŒ¸</div>
                </div>
                
                <div class="mt-4 flex gap-2 text-center">
                    <div class="bg-white/20 backdrop-blur rounded-xl p-2 flex-1 border border-white/30">
                        <div class="text-xs opacity-80">æ±äº¬</div>
                        <div class="font-bold text-xl">æ»¿é–‹ä¸­</div>
                        <div class="text-[10px]">ğŸŒ¸ğŸŒ¸ğŸŒ¸ğŸŒ¸</div>
                    </div>
                    <div class="bg-white/20 backdrop-blur rounded-xl p-2 flex-1 border border-white/30">
                        <div class="text-xs opacity-80">æ²³å£æ¹–</div>
                        <div class="font-bold text-xl">å«è‹</div>
                        <div class="text-[10px]">ğŸŒ±ğŸŒ±</div>
                    </div>
                </div>
            </div>

            <h3 class="font-bold text-gray-700 mb-3 ml-1">ä¸€é€±ç©¿æ­å»ºè­°</h3>
            <div class="space-y-3">
                <div v-for="w in weatherData" :key="w.day" class="bg-white p-4 rounded-2xl shadow-sm flex items-center justify-between border-l-4" :class="w.borderColor">
                    <div class="text-center w-12">
                        <div class="text-xs text-gray-400">{{ w.date }}</div>
                        <div class="font-bold text-gray-600">Day {{ w.day }}</div>
                    </div>
                    <div class="text-center flex-1 px-2">
                        <i :class="w.icon" class="text-2xl mb-1 block transition hover:scale-110"></i>
                        <span class="text-xs font-bold">{{ w.temp }}</span>
                    </div>
                    <div class="w-28 bg-gray-50 rounded-lg p-2 flex flex-col items-center">
                        <div class="text-2xl mb-1 chiikawa-float-delay">{{ w.emoji }}</div>
                        <div class="text-[10px] text-gray-500 font-bold text-center leading-tight">{{ w.advice }}</div>
                    </div>
                </div>
            </div>
        </div>

        <div v-else-if="currentPage === 'preparation'" key="preparation" class="px-4 pb-24">
            
            <div class="mb-6 bg-white p-4 rounded-2xl shadow-md text-center">
                <div class="text-sm text-gray-500 mb-2">æ ¹æ“šæ‚¨çš„è¡Œç¨‹è‡ªå‹•åˆ†æ</div>
                <button @click="generateTickets" class="w-full bg-gradient-to-r from-green-400 to-green-500 text-white py-3 rounded-xl shadow-lg font-bold flex items-center justify-center gap-2 active:scale-95 transition">
                    <i class="fa-solid fa-wand-magic-sparkles animate-pulse"></i> ç”Ÿæˆå¿…è²·ç¥¨åˆ¸æ¸…å–®
                </button>
            </div>

            <transition-group name="fade" tag="div" class="space-y-3 mb-8">
                <div v-for="(ticket, idx) in tickets" :key="idx" class="bg-white border-l-4 border-green-400 rounded-xl p-4 shadow-sm relative">
                    <button @click="removeTicket(idx)" class="absolute top-2 right-2 text-gray-300"><i class="fa-solid fa-times"></i></button>
                    <h4 class="font-bold text-green-700 text-sm">{{ ticket.name }}</h4>
                    <p class="text-xs text-gray-500 mt-1">{{ ticket.reason }}</p>
                    <div class="mt-2 text-[10px] bg-green-50 text-green-700 px-2 py-1 rounded inline-block">
                        <i class="fa-solid fa-circle-info"></i> {{ ticket.note }}
                    </div>
                </div>
            </transition-group>

            <h3 class="font-bold text-gray-700 mb-3 ml-1">è¡Œå‰æª¢æŸ¥ Check</h3>
            <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                <label v-for="(item, idx) in prepList" :key="idx" class="flex items-center p-4 border-b border-gray-100 last:border-0 hover:bg-gray-50 cursor-pointer transition">
                    <div class="relative flex items-center">
                        <input type="checkbox" v-model="item.checked" class="peer h-5 w-5 cursor-pointer appearance-none rounded-full border border-pink-300 checked:bg-pink-500 checked:border-pink-500 transition-all">
                        <i class="fa-solid fa-check text-white absolute left-1 top-1 text-xs opacity-0 peer-checked:opacity-100 pointer-events-none"></i>
                    </div>
                    <span :class="{'line-through text-gray-300': item.checked}" class="ml-3 text-sm font-medium text-gray-600 select-none">{{ item.text }}</span>
                </label>
            </div>
        </div>

        <div v-else-if="currentPage === 'emergency'" key="emergency" class="px-4 pb-24">
            
            <div class="text-center mb-6 mt-4">
                <div class="inline-block p-4 rounded-full bg-red-50 border-4 border-red-100 mb-2 chiikawa-float">
                    <i class="fa-solid fa-kit-medical text-4xl text-red-500"></i>
                </div>
                <h2 class="text-xl font-bold text-red-600">ç·Šæ€¥æ‡‰è®Šä¸­å¿ƒ</h2>
            </div>

            <div class="grid grid-cols-1 gap-4">
                <button @click="showCamera = true" class="bg-white border-2 border-pink-400 p-4 rounded-2xl shadow-md flex items-center gap-4 active:bg-pink-50 transition relative overflow-hidden">
                    <div class="absolute right-0 top-0 bg-pink-400 text-white text-[10px] px-2 rounded-bl-lg">AI è¾¨è­˜</div>
                    <div class="bg-pink-100 p-3 rounded-full">
                        <i class="fa-solid fa-camera text-pink-600 text-xl"></i>
                    </div>
                    <div class="text-left">
                        <div class="font-bold text-gray-800">å³æ™‚ç¿»è­¯æ”å½±æ©Ÿ</div>
                        <div class="text-xs text-gray-500">æƒææ—¥æ–‡èœå–® / è—¥å¦æ¨™ç±¤</div>
                    </div>
                </button>

                <a href="tel:119" class="bg-white border-2 border-red-200 p-4 rounded-2xl shadow-md flex items-center gap-4 active:bg-red-50 transition">
                    <div class="bg-red-100 p-3 rounded-full">
                        <i class="fa-solid fa-phone text-red-600 text-xl"></i>
                    </div>
                    <div class="text-left">
                        <div class="font-bold text-gray-800">æ—¥æœ¬æ•‘è­·è»Š / ç«è­¦</div>
                        <div class="text-xs text-red-500 font-bold">ç›´æ’¥ 119 (å…åŠ åœ‹ç¢¼)</div>
                    </div>
                </a>
            </div>

            <div class="mt-6 bg-white p-5 rounded-2xl shadow-sm">
                <h3 class="font-bold text-gray-700 mb-3 text-sm">ç·Šæ€¥æŒ‡å·®ç”¨èª</h3>
                <div class="space-y-3">
                    <div class="flex justify-between border-b border-dashed border-gray-200 pb-2">
                        <span class="text-sm">æˆ‘ä¸èˆ’æœ</span>
                        <div class="text-right">
                            <div class="font-bold text-gray-800">å…·åˆãŒæ‚ªã„ã§ã™</div>
                            <div class="text-[10px] text-gray-400">Gu-ai ga wa-rui de-su</div>
                        </div>
                    </div>
                    <div class="flex justify-between border-b border-dashed border-gray-200 pb-2">
                        <span class="text-sm">è«‹å¹«æˆ‘å«é†«ç”Ÿ</span>
                        <div class="text-right">
                            <div class="font-bold text-gray-800">åŒ»è€…ã‚’å‘¼ã‚“ã§</div>
                            <div class="text-[10px] text-gray-400">I-sha o yon-de</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </transition>

    <div v-if="showCamera" class="camera-overlay" @click="showCamera = false">
        <div class="absolute top-10 w-full text-center text-white z-10">
            <h3 class="text-xl font-bold drop-shadow-md">æ™ºæ…§æƒæä¸­...</h3>
            <p class="text-sm opacity-80">è«‹å°æº–æ—¥æ–‡æ–‡å­— (æ¨¡æ“¬)</p>
        </div>
        
        <div class="scan-frame">
            <div class="scan-line"></div>
        </div>

        <div class="absolute bottom-20 bg-white/90 backdrop-blur px-6 py-3 rounded-xl shadow-2xl animate-bounce text-center">
            <div class="text-xs text-gray-500 mb-1">åµæ¸¬åˆ°æ–‡å­—</div>
            <div class="font-bold text-pink-600 text-lg">ç‰¹é¸é»‘æ¯›å’Œç‰›</div>
            <div class="text-xs text-gray-400 mt-1">(é»æ“Šç•«é¢é—œé–‰)</div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, reactive, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // --- æ ¸å¿ƒè®Šæ•¸ ---
            const currentPage = ref('home');
            const pageTitle = ref('Home');
            const editMode = ref(false);
            const showCamera = ref(false);
            const savedMessage = ref(false);
            const currencyMode = ref('JPY'); 
            const exchangeRate = 0.22; // åŒ¯ç‡

            // --- è³‡æ–™é›† (ä¾æ“šæ‚¨æä¾›çš„8å¤©7å¤œè¡Œç¨‹) ---
            const itinerary = ref([
                { date: '3/28 (å…­) æŠµé” & æ™´ç©ºå¡”', events: [
                    { time: '06:40', title: 'æ¡ƒåœ’èµ·é£› (IT200)', note: 'T1' },
                    { time: '10:40', title: 'æŠµé”æ±äº¬æˆç”°', note: 'é ˜è¥¿ç“œå¡/Skyliner' },
                    { time: '14:00', title: 'æ™´ç©ºå¡” SkyTree', note: 'äº‹å…ˆè³¼ç¥¨' },
                    { time: '18:00', title: 'éŒ¦ç³¸ç”ºæ™šé¤', note: 'ç‡’è‚‰æˆ–å±…é…’å±‹' }
                ]},
                { date: '3/29 (æ—¥) æ·ºè‰ & ä¸Šé‡', events: [
                    { time: '09:00', title: 'æ·ºè‰å¯ºåƒæ‹œ', note: 'é›·é–€æ‹ç…§' },
                    { time: '12:00', title: 'åˆé¤: æ·ºè‰å‘¨é‚Š', note: 'æ–‡å­—ç‡’/å¤©å©¦ç¾…' },
                    { time: '14:00', title: 'å°ç¶²ç¥ç¤¾', note: 'å¼·é‹å„é™¤' },
                    { time: '15:30', title: 'ä¸Šé‡æ©è³œå…¬åœ’', note: 'è³æ«»é‡é¤' },
                    { time: '18:00', title: 'ç§‹è‘‰åŸ/æ±äº¬ä¸€ç•ªè¡—', note: 'é€›è¡—' },
                    { time: '20:00', title: 'æ™šé¤', note: 'ä¾é€›è¡—åœ°æ±ºå®š' }
                ]},
                { date: '3/30 (ä¸€) å‡ºç™¼å¯Œå£«å±±', events: [
                    { time: '09:00', title: 'éŒ¦ç³¸ç”ºå‡ºç™¼ -> å¯Œå£«å±±', note: 'é–‹å§‹ç§Ÿè»Š (3å¤©2å¤œ)' },
                    { time: '13:00', title: 'æ²³å£æ¹–è‡ªç„¶ç”Ÿæ´»é¤¨', note: 'çœ‹å¯Œå£«å±±' },
                    { time: '15:00', title: 'æ–°å€‰å¯Œå£«æ·ºé–“ç¥ç¤¾', note: 'éœ€çˆ¬éšæ¢¯, åœè»Šå ´è¦æ’' },
                    { time: '17:00', title: 'é‡‘é³¥å±… & æœ¬ç”ºå•†åº—è¡—', note: 'æ³¨æ„äº¤é€šå®‰å…¨' },
                    { time: '19:00', title: 'æ™šé¤', note: 'è‡ªç…® or å•†åº—è¡—' }
                ]},
                { date: '3/31 (äºŒ) å±±ä¸­æ¹–å–®è»Š', events: [
                    { time: '05:30', title: 'å¹³é‡ä¹‹æ¿±æ—¥å‡º', note: 'æ—©èµ·æ³¨æ„ä¿æš–' },
                    { time: '09:00', title: 'å±±ä¸­æ¹–ç§Ÿå–®è»Š', note: 'é•·æ± è¦ªæ°´å…¬åœ’/ç™½é³¥æ¿±' },
                    { time: '12:00', title: 'åˆé¤: å±±ä¸­æ¹–', note: '' },
                    { time: '14:00', title: 'KABA æ°´é™¸å·´å£«', note: 'æ—­æ—¥ä¸˜æ¹–ç•”' },
                    { time: '18:00', title: 'Ogino æ²³å£æ¹–è¶…å¸‚', note: 'è²·é£Ÿæå›å®¿ç…®' }
                ]},
                { date: '4/01 (ä¸‰) çºœè»Š & è¿”å›æ–°å®¿', events: [
                    { time: '09:00', title: 'æ²³å£æ¹–çºœè»Š/çµ•æ™¯é¦éŸ†', note: 'æ—©é»å»æ’éšŠ' },
                    { time: '11:00', title: 'Fujisan shokupan', note: 'è²·åå¸ä¼´æ‰‹ç¦®' },
                    { time: '14:00', title: 'å¯Œå£«å›éŠ -> æ–°å®¿', note: 'é‚„è»Šå¾Œæ­è»Š' },
                    { time: '17:00', title: 'æ± è¢‹å¤ªé™½åŸ', note: 'Check-in æ”¾è¡Œæ' },
                    { time: '19:00', title: 'æ™šé¤: å¤ªé™½åŸå…§', note: '' }
                ]},
                { date: '4/02 (å››) éŒå€‰æ±Ÿä¹‹é›»', events: [
                    { time: '09:00', title: 'æ–°å®¿ -> è—¤æ¾¤', note: 'æ±Ÿä¹‹é›»ä¸€æ—¥éŠ' },
                    { time: '10:30', title: 'æ±Ÿä¹‹å³¶', note: 'å»ä»”é­šä¸¼' },
                    { time: '13:00', title: 'éŒå€‰é«˜æ ¡å‰', note: 'çŒç±ƒé«˜æ‰‹å¹³äº¤é“' },
                    { time: '14:00', title: 'ä¸ƒé‡Œæ¿±', note: 'åˆé¤/ä¸‹åˆèŒ¶' },
                    { time: '16:00', title: 'éŒå€‰å°ç”ºé€š', note: '' },
                    { time: '19:00', title: 'è¿”å›æ–°å®¿æ™šé¤', note: '' }
                ]},
                { date: '4/03 (äº”) æ¾€è°·æ½®æµ', events: [
                    { time: '09:00', title: 'æ±äº¬éµå¡”', note: 'æ‹ç…§' },
                    { time: '10:30', title: 'å…­æœ¬æœ¨/éº»å¸ƒå°Hills', note: '' },
                    { time: '12:00', title: 'åˆé¤: å…­æœ¬æœ¨', note: '' },
                    { time: '14:00', title: 'å‰å¾€æ¾€è°·', note: 'é€›è¡—' },
                    { time: '16:30', title: 'SHIBUYA SKY', note: 'å¤•é™½å ´éœ€é ç´„' },
                    { time: '19:00', title: 'æ¾€è°·åå­—è·¯å£', note: 'æœ€å¾Œæ¡è²·/æ™šé¤' }
                ]},
                { date: '4/04 (å…­) è¿”å°', events: [
                    { time: 'Free', title: 'è‡ªç”±è£œè²¨æ™‚é–“', note: 'æ•´ç†è¡Œæ' },
                    { time: '17:00', title: 'å‰å¾€æˆç”°æ©Ÿå ´', note: 'NEX/Skyliner' },
                    { time: '20:40', title: 'èµ·é£› (IT201)', note: 'T1' },
                    { time: '23:20', title: 'æŠµé”æ¡ƒåœ’', note: 'End' }
                ]}
            ]);

            const expenses = ref([]);
            const newExpense = reactive({ item: '', amount: null, payer: 'æˆ‘' });
            
            const prepList = ref([
                { text: 'è­·ç…§ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)', checked: false },
                { text: 'Visit Japan Web å¡«å¯«', checked: false },
                { text: 'åœ‹éš›é§•ç…§ (è­¯æœ¬)', checked: false },
                { text: 'esim / æ¼«éŠé–‹é€š', checked: false }
            ]);
            const tickets = ref([]);

            const shopping = reactive({
                cosme: [
                    { name: 'Decorte æ•£ç²‰', brand: 'Cosme Decorte', rank: 1, img: 'https://placehold.co/200x200/fff/FF69B4?text=Powder&font=playfair' },
                    { name: 'Tirtir æ°£å¢Š', brand: 'TIRTIR', rank: 2, img: 'https://placehold.co/200x200/fff/FF69B4?text=Cushion&font=playfair' },
                    { name: 'Canmake çœ¼å½±', brand: 'Canmake', rank: 3, img: 'https://placehold.co/200x200/fff/FF69B4?text=Eye&font=playfair' },
                    { name: '&Honey é«®æ²¹', brand: 'Honey', rank: 4, img: 'https://placehold.co/200x200/fff/FF69B4?text=Oil&font=playfair' }
                ],
                ldk: [
                    { name: 'Quality 1st é¢è†œ', category: 'Aè©•åƒ¹', desc: 'ä¿æ¿•åŠ›æœ€å¼·ï¼Œ3åˆ†é˜æå®š', img: 'https://placehold.co/100x100/fff/FF69B4?text=Mask' },
                    { name: 'LDK é˜²æ›¬ä¹³', category: 'Sè©•åƒ¹', desc: 'ä¸é»è†©ä¸”é˜²è­·åŠ›é«˜', img: 'https://placehold.co/100x100/fff/FF69B4?text=Sun' }
                ]
            });

            const weatherData = ref([
                { day: 1, date: '3/28', temp: '12-18Â°C', icon: 'fa-solid fa-cloud-sun text-yellow-500', advice: 'è–„é•·è¢–', emoji: 'ğŸ§¥', borderColor: 'border-yellow-300' },
                { day: 2, date: '3/29', temp: '15-20Â°C', icon: 'fa-solid fa-sun text-orange-500', advice: 'æ´‹è£OK', emoji: 'ğŸ‘—', borderColor: 'border-orange-300' },
                { day: 3, date: '3/30', temp: '5-12Â°C', icon: 'fa-solid fa-snowflake text-blue-300', advice: 'æ²³å£æ¹–å†·!', emoji: 'ğŸ§£', borderColor: 'border-blue-300' },
                { day: 4, date: '3/31', temp: '4-11Â°C', icon: 'fa-solid fa-cloud text-gray-400', advice: 'ç¾½çµ¨è¡£', emoji: 'ğŸ§¤', borderColor: 'border-gray-300' },
                { day: 5, date: '4/01', temp: '10-16Â°C', icon: 'fa-solid fa-sun text-orange-500', advice: 'é‡ç¹”è¡«', emoji: 'ğŸ‘š', borderColor: 'border-orange-300' },
                { day: 6, date: '4/02', temp: '14-19Â°C', icon: 'fa-solid fa-wind text-green-400', advice: 'æµ·é‚Šé¢¨å¤§', emoji: 'ğŸ§¢', borderColor: 'border-green-300' },
                { day: 7, date: '4/03', temp: '15-21Â°C', icon: 'fa-solid fa-sun text-red-400', advice: 'èˆ’é©é€›è¡—', emoji: 'ğŸ‘Ÿ', borderColor: 'border-red-300' }
            ]);

            // --- è¨ˆç®—å±¬æ€§ ---
            const countdownDays = computed(() => {
                const diff = new Date('2026-03-28') - new Date();
                return Math.max(0, Math.ceil(diff / (1000 * 60 * 60 * 24)));
            });

            const balanceResult = computed(() => {
                let myPaid = 0;
                let total = 0;
                
                expenses.value.forEach(exp => {
                    total += exp.amount;
                    if (exp.payer === 'æˆ‘') myPaid += exp.amount;
                });

                const perPerson = total / 2;
                const myBalance = myPaid - perPerson;
                
                if (Math.abs(myBalance) < 1) return { amount: 0 };
                
                return {
                    debtor: myBalance > 0 ? 'æ—…ä¼´' : 'æˆ‘',
                    creditor: myBalance > 0 ? 'æˆ‘' : 'æ—…ä¼´',
                    amount: Math.abs(myBalance)
                };
            });

            // --- åŠŸèƒ½èˆ‡é‚è¼¯ ---
            
            // åœ°åœ–é€£çµç”¢ç”Ÿå™¨ (é‡å°å¯Œå£«å±±åœè»Šå ´ç­‰)
            const shouldShowMap = (title) => {
                const keywords = ['åœè»Šå ´', 'è‡ªç„¶ç”Ÿæ´»é¤¨', 'ç¥ç¤¾', 'å…¬åœ’', 'Sky', 'è¶…å¸‚'];
                return keywords.some(k => title.includes(k));
            };
            const getMapLink = (title) => {
                // é‡å°ç‰¹å®šåœ°é»å„ªåŒ–
                if(title.includes('æ–°å€‰')) return 'https://goo.gl/maps/Place1'; // ç¤ºæ„
                return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(title + ' æ—¥æœ¬')}`;
            };

            const formatMoney = (val) => {
                if(currencyMode.value === 'JPY') return `Â¥${Math.round(val).toLocaleString()}`;
                return `NT$${Math.round(val * exchangeRate).toLocaleString()}`;
            };

            const addExpense = () => {
                if(!newExpense.item || !newExpense.amount) return;
                expenses.value.push({ ...newExpense });
                newExpense.item = ''; newExpense.amount = null;
                saveData();
            };
            const removeExpense = (i) => {
                if(confirm('åˆªé™¤æ­¤ç­†?')) { expenses.value.splice(i, 1); saveData(); }
            };

            // è‡ªå‹•ç”Ÿæˆç¥¨åˆ¸ (æ™ºæ…§åˆ¤æ–·)
            const generateTickets = () => {
                const list = [];
                const str = JSON.stringify(itinerary.value);
                
                if(str.includes('Skyliner') || str.includes('æˆç”°')) 
                    list.push({name: 'Skyliner äº¬æˆé›»éµ', reason: 'æ©Ÿå ´å¾€è¿”å¸‚å€æœ€å¿«', note: 'Klook è²·æ¯”ç¾å ´ä¾¿å®œ'});
                if(str.includes('æ±Ÿä¹‹é›»') || str.includes('éŒå€‰')) 
                    list.push({name: 'æ±Ÿä¹‹å³¶âˆ’éŒå€‰å‘¨éŠåˆ¸', reason: 'Day 6 æ±Ÿä¹‹é›»ç„¡é™æ­ä¹˜', note: 'æ–°å®¿å‡ºç™¼ç‰ˆæˆ–ç¾åœ°ç‰ˆ'});
                if(str.includes('SHIBUYA SKY')) 
                    list.push({name: 'SHIBUYA SKY å±•æœ›å°', reason: 'Day 7 å¤•é™½ç†±é–€æ™‚æ®µ', note: 'éœ€æå‰4é€±æ¶ç¥¨'});
                if(str.includes('æ™´ç©ºå¡”')) 
                    list.push({name: 'æ±äº¬æ™´ç©ºå¡”é–€ç¥¨', reason: 'Day 1 è¡Œç¨‹', note: 'å¤©æœ›ç”²æ¿+å¤©æœ›å›å»Š'});
                if(str.includes('å¯Œå£«å›éŠ')) 
                    list.push({name: 'JR å¯Œå£«å›éŠè™Ÿ', reason: 'å›æ–°å®¿ä¸å¡è»Š', note: 'éå¸¸ç†±é–€éœ€æå‰é è¨‚'});
                
                tickets.value = list;
                saveData();
            };
            const removeTicket = (i) => { tickets.value.splice(i,1); saveData(); };

            // å°èˆªèˆ‡æ‰‹å‹¢
            const navigate = (p) => {
                currentPage.value = p;
                window.scrollTo(0,0);
                const titles = { itinerary:'è¡Œç¨‹è¦åŠƒ', accounting:'æ—…è²»åˆ†å¸³', shopping:'å¿…è²·æ¸…å–®', weather:'æ°£è±¡ç©¿æ­', preparation:'è¡Œå‰æº–å‚™', emergency:'ç·Šæ€¥æ‡‰è®Š' };
                pageTitle.value = titles[p] || 'Home';
            };
            const goHome = () => { navigate('home'); editMode.value = false; };
            const toggleEdit = () => { editMode.value = !editMode.value; if(!editMode.value) saveData(); };

            // Swipe Logic
            let touchStartX = 0;
            const handleTouchStart = (e) => { touchStartX = e.changedTouches[0].screenX; };
            const handleTouchEnd = (e) => {
                if (e.changedTouches[0].screenX - touchStartX > 100 && currentPage.value !== 'home') goHome();
            };

            // Data Persistence (æ¨¡æ“¬ GitHub ç·¨è¼¯)
            const saveData = () => {
                const data = { itinerary: itinerary.value, expenses: expenses.value, prep: prepList.value, tickets: tickets.value };
                localStorage.setItem('trip_2026_v17', JSON.stringify(data));
                savedMessage.value = true;
                setTimeout(() => savedMessage.value = false, 2000);
            };
            const loadData = () => {
                const saved = localStorage.getItem('trip_2026_v17');
                if(saved) {
                    const p = JSON.parse(saved);
                    if(p.itinerary) itinerary.value = p.itinerary; // è‹¥æœ‰ç·¨è¼¯éå‰‡è¦†è“‹
                    if(p.expenses) expenses.value = p.expenses;
                    if(p.prep) prepList.value = p.prep;
                    if(p.tickets) tickets.value = p.tickets;
                }
            };

            onMounted(loadData);

            return {
                currentPage, pageTitle, navigate, goHome,
                itinerary, editMode, toggleEdit,
                expenses, newExpense, addExpense, removeExpense, balanceResult, currencyMode, formatMoney, exchangeRate,
                shopping, weatherData, prepList, tickets, generateTickets, removeTicket,
                showCamera, countdownDays, savedMessage,
                getMapLink, shouldShowMap,
                handleTouchStart, handleTouchEnd
            };
        }
    }).mount('#app');
</script>
</body>
</html>
