<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#FFF0F5">
<title>é—œæ±ä¹‹æ—… 2026 (V43.0 Phoenix)</title>

<script>
    window.tailwind = {
        config: {
            theme: {
                extend: {
                    colors: {'chii-pink':'#FFD1DC','chii-deep-pink':'#FF9EAC','chii-blue':'#A2D2FF','chii-yellow':'#FFF5BA','chii-text':'#5D4037'},
                    fontFamily: {sans:['Zen Maru Gothic','sans-serif']},
                    animation: {'wiggle':'wiggle 3s ease-in-out infinite','float':'float 3s ease-in-out infinite','fade-in':'fadeIn 0.5s ease-out forwards','spin-slow':'spin 8s linear infinite','pulse-fast':'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'bounce-gentle': 'bounceGentle 2s infinite'},
                    keyframes: {
                        wiggle: {'0%,100%':{transform:'rotate(-3deg)'},'50%':{transform:'rotate(3deg)'}},
                        float: {'0%,100%':{transform:'translateY(0)'},'50%':{transform:'translateY(-5px)'}},
                        fadeIn: {from:{opacity:0,transform:'translateY(10px)'},to:{opacity:1,transform:'translateY(0)'}},
                        bounceGentle: {'0%, 100%': {transform: 'translateY(-5%)'}, '50%': {transform: 'translateY(0)'}}
                    }
                }
            }
        }
    }
</script>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/vue@3.3.4/dist/vue.global.prod.js"></script>

<style>
    /* V43.0 Core Styles - Mobile Optimized */
    html, body {
        margin: 0; padding: 0; width: 100%; height: 100%;
        font-family: "Zen Maru Gothic", sans-serif;
        color: #5D4037;
        overflow: hidden; 
        -webkit-tap-highlight-color: transparent;
        background-color: #FFF0F5;
        overscroll-behavior: none;
    }
    input, textarea, select { font-size: 16px !important; font-family: inherit; } 
    * { -webkit-overflow-scrolling: touch; }

    #app-content {
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
        padding-bottom: 160px; 
        padding-top: env(safe-area-inset-top);
    }
    
    /* Extra padding for shopping view to accommodate coupon bar */
    #app-content.view-shopping { padding-bottom: 220px !important; }

    body.modal-open #app-content { overflow: hidden; }

    #fixed-bg {
        position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: -1;
        background-color: #FFF0F5;
        background-image: radial-gradient(#FFD1DC 15%, transparent 16%), radial-gradient(#FFF5BA 15%, transparent 16%);
        background-size: 60px 60px;
        background-position: 0 0, 30px 30px;
    }

    [v-cloak] { display: none !important; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    
    .card {
        background: rgba(255,255,255,0.92); border-radius: 24px;
        box-shadow: 0 8px 30px rgba(255,105,180,0.12); border: 1px solid rgba(255,255,255,0.8);
        margin-bottom: 0; position: relative; backdrop-filter: blur(10px);
        transition: all 0.3s ease; overflow: hidden; transform: translateZ(0); 
    }
    .card:active { transform: scale(0.99); }
    
    .list-move, .list-enter-active, .list-leave-active { transition: all 0.5s ease; }
    .list-enter-from, .list-leave-to { opacity: 0; transform: translateX(30px); }
    .list-leave-active { position: absolute; }

    /* FABs */
    .fab-home {
        position: fixed; bottom: calc(25px + env(safe-area-inset-bottom)); left: 50%; transform: translateX(-50%);
        width: 68px; height: 68px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
        font-size: 28px; color: white; z-index: 90; border: 4px solid white;
        box-shadow: 0 10px 25px rgba(255,105,180,0.5); background: linear-gradient(135deg,#FF9EAC,#FFD1DC); cursor: pointer;
    }
    .fab-main {
        position: fixed; bottom: calc(100px + env(safe-area-inset-bottom)); right: 20px;
        width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
        font-size: 22px; color: white; z-index: 80; border: 3px solid white; box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .fab-search {
        position: fixed; bottom: calc(30px + env(safe-area-inset-bottom)); left: 20px;
        width: 54px; height: 54px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
        font-size: 24px; color: #5D4037; z-index: 90; border: 2px solid white; background: rgba(255,255,255,0.9);
        backdrop-filter: blur(5px); box-shadow: 0 4px 15px rgba(0,0,0,0.15); transition: all 0.3s;
    }
    .fab-camera {
        position: fixed; bottom: calc(100px + env(safe-area-inset-bottom)); left: 20px;
        width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
        font-size: 22px; color: white; z-index: 80; border: 3px solid white; box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        background: #10b981; 
    }

    /* V43 Collapsible Coupon Bar */
    .coupon-bar-container {
        position: fixed; bottom: 0; left: 0; right: 0; z-index: 200;
        pointer-events: none; /* Let clicks pass through empty space */
        display: flex; flex-col; items-center; justify-end;
        padding-bottom: calc(100px + env(safe-area-inset-bottom)); /* Lift above FABs */
    }
    .coupon-bar-content {
        pointer-events: auto;
        background: rgba(255,255,255,0.95); backdrop-filter: blur(10px);
        border: 1px solid rgba(255,192,203,0.5);
        box-shadow: 0 5px 25px rgba(0,0,0,0.15);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    /* Minimized State */
    .coupon-min {
        width: 60px; height: 60px; border-radius: 50%; 
        display: flex; align-items: center; justify-content: center;
        background: linear-gradient(135deg, #ec4899, #db2777); color: white;
        margin-bottom: 10px; margin-right: 20px; align-self: flex-end;
    }
    /* Expanded State */
    .coupon-max {
        width: 90%; max-width: 400px; border-radius: 20px; padding: 12px;
        margin-bottom: 20px; align-self: center;
    }

    .rental-badge {
        position: absolute; top: 12px; right: 12px;
        padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 900;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1); z-index: 20; cursor: pointer;
        display: flex; items-center; gap: 6px; transition: all 0.2s;
    }
    .rental-badge.done { background: #dcfce7; color: #166534; border: 2px solid #86efac; }
    .rental-badge.todo { background: #fee2e2; color: #991b1b; border: 2px solid #fca5a5; animation: pulse-fast; }

    .welcome-screen {
        position: fixed; inset: 0; z-index: 9999; background: #FFF0F5;
        transition: transform 0.8s cubic-bezier(0.7,0,0.3,1); cursor: pointer; height: 100%;
    }
    .welcome-screen.hidden-screen { transform: translateY(-100%); pointer-events: none; }
    
    .sakura {
        position: fixed; top: -20px; background: #FFB7B2; border-radius: 100% 0 100% 0; opacity: 0.6;
        animation: fall linear infinite; z-index: 0; pointer-events: none; width: 14px; height: 14px;
    }
    @keyframes fall { to { transform: translate(10vw, 105vh) rotate(360deg); } }

    .timeline-connect {
        width: 2px; height: 50px; background: repeating-linear-gradient(to bottom, #FFD1DC 0, #FFD1DC 5px, transparent 5px, transparent 10px);
        margin: 0 auto; position: relative;
    }
    .timeline-badge {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        background: white; border: 1px solid #FFD1DC; border-radius: 12px; padding: 4px 10px; font-size: 11px; color: #FF9EAC; font-weight: bold;
        white-space: nowrap; box-shadow: 0 2px 5px rgba(0,0,0,0.05); z-index: 5;
    }
    .drive-line { background: repeating-linear-gradient(to bottom, #4ade80 0, #4ade80 5px, transparent 5px, transparent 10px) !important; height: 60px !important; }
    .drive-badge { border-color: #4ade80 !important; color: #16a34a !important; background: #f0fdf4 !important; font-size: 12px !important; padding: 6px 14px !important; }

    .online-floater {
        position: fixed; top: calc(10px + env(safe-area-inset-top)); right: 60px; z-index: 1000;
        display: flex; gap: -5px; pointer-events: none;
    }
    .online-avatar {
        width: 32px; height: 32px; border-radius: 50%; border: 2px solid white; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.2); background: #eee; object-fit: cover;
        margin-left: -10px; animation: bounceGentle 2s infinite; position: relative;
    }
    .online-avatar.active::after {
        content: ''; position: absolute; bottom: 0; right: 0; width: 10px; height: 10px; 
        background: #4ade80; border: 1.5px solid white; border-radius: 50%; box-shadow: 0 0 5px #4ade80;
    }

    .cloud-status {
        position: fixed; bottom: calc(30px + env(safe-area-inset-bottom)); left: 80px;
        font-size: 10px; font-weight: bold; color: #777;
        display: flex; align-items: center; gap: 6px; z-index: 50;
        background: rgba(255,255,255,0.9); padding: 6px 12px; border-radius: 20px;
        backdrop-filter: blur(4px); box-shadow: 0 4px 15px rgba(0,0,0,0.08); cursor: pointer;
        border: 1px solid rgba(255,255,255,0.5);
    }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; transition: all 0.3s; }
</style>
</head>
<body>

<div id="fixed-bg"></div>
<div id="sakura-container"></div>

<div id="app" v-cloak class="h-full flex flex-col">
    
    <div v-if="currentView!=='welcome'" class="online-floater">
        <div v-for="u in onlineUsersList" :key="u.id" class="online-avatar active transition-transform" :title="u.name">
            <img v-if="u.avatar" :src="u.avatar" class="w-full h-full rounded-full object-cover">
            <div v-else class="w-full h-full rounded-full flex items-center justify-center bg-white text-xs">{{u.icon}}</div>
        </div>
    </div>

    <div :class="['welcome-screen flex flex-col items-center justify-between', isWelcomeClosed ? 'hidden-screen' : '']">
        <div class="absolute inset-0 z-0"><img :src="getImg('welcome.jpg')" class="w-full h-full object-cover opacity-90" @error="handleImgError"></div>
        <div class="absolute top-6 right-6 z-50 pt-[env(safe-area-inset-top)]">
            <button @click.stop="handleAuthClick" :class="['flex items-center gap-2 px-4 py-2 rounded-full backdrop-blur-md border border-white/50 shadow-lg font-bold text-sm transition', isLoggedIn ? 'bg-green-500/80 text-white' : 'bg-white/40 text-gray-800']">
                <i :class="isLoggedIn ? 'fa-solid fa-cloud' : 'fa-solid fa-cloud-arrow-up'"></i> {{ isLoggedIn ? 'å·²é€£ç·š' : 'é›²ç«¯åŒæ­¥' }}
            </button>
        </div>
        <div class="relative z-10 mt-32 text-center px-6">
            <div class="inline-block bg-white/40 backdrop-blur-md px-6 py-2 rounded-full text-white text-xs font-black tracking-[0.2em] border border-white/50 mb-6 animate-float shadow-lg">PHOENIX V43.0</div>
            <h1 class="text-7xl font-black text-white drop-shadow-lg tracking-widest mb-2 font-sans" style="text-shadow: 0 4px 10px rgba(255,105,180,0.3);">é—œæ±ä¹‹æ—…</h1>
            <p class="text-3xl text-white/90 font-bold tracking-widest drop-shadow-md">2026.03.27</p>
        </div>
        <div class="relative z-10 mb-20 w-full px-10 pb-[env(safe-area-inset-bottom)] space-y-4">
            <button @click="enterSite" class="w-full bg-white/90 text-pink-500 font-black py-4 rounded-full shadow-2xl backdrop-blur-xl text-xl flex items-center justify-center gap-3 border border-white animate-pulse-slow">
                <span class="animate-spin-slow">ğŸŒ¸</span> æ—…ä¼´ç™»å…¥
            </button>
            <button @click="enterAsGuest" class="w-full bg-gray-800/60 text-white font-bold py-3 rounded-full backdrop-blur-md text-sm border border-white/30 hover:bg-gray-800/80 transition">
                <i class="fa-solid fa-user-secret"></i> è¨ªå®¢åƒè§€ (å”¯è®€)
            </button>
        </div>
    </div>

    <div v-if="currentView !== 'menu'" class="fixed top-0 left-0 right-0 h-[60px] bg-[#FFF0F5]/90 backdrop-blur-xl z-30 flex items-center justify-between px-4 border-b border-white/50 shadow-sm pt-[env(safe-area-inset-top)] box-content transition-all">
        <button @click="currentView='menu'" class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-pink-400 shadow-md border border-white active:scale-90 transition"><i class="fa-solid fa-chevron-left"></i></button>
        <h1 class="font-black text-gray-700 text-lg flex items-center gap-2"><i class="fa-solid fa-sakura text-pink-300"></i> {{getPageTitle(currentView)}}</h1>
        <div class="w-10"></div>
    </div>
    <div v-if="currentView !== 'menu'" class="h-[60px] pt-[env(safe-area-inset-top)] box-content shrink-0"></div>

    <div id="app-content" class="flex-1" :class="{'view-shopping': currentView === 'shopping'}">

        <div v-if="currentView==='menu'" class="p-6 pt-12 animate-fade-in pb-32">
            <h2 class="text-3xl font-black text-gray-700 mb-8 text-center pt-[env(safe-area-inset-top)]">æ—…ç¨‹ä¸­å¿ƒ</h2>
            <div class="mb-8 bg-white/70 backdrop-blur-xl border border-white rounded-[32px] p-6 shadow-xl relative overflow-hidden">
                 <div class="flex items-start gap-4 relative z-10">
                     <div class="bg-gradient-to-br from-yellow-200 to-yellow-400 w-12 h-12 rounded-2xl flex items-center justify-center text-white text-xl shrink-0 shadow-lg"><i class="fa-solid fa-bell"></i></div>
                     <div class="flex-1">
                         <div class="font-black text-gray-800 text-lg mb-1">å€’æ•¸ {{daysUntilTrip}} å¤©</div>
                         <div class="text-xs text-gray-500 font-bold leading-relaxed space-y-1">
                            <div v-for="alert in smartReminders" class="text-pink-500 flex items-start gap-1 font-black"><i class="fa-solid fa-circle-exclamation mt-0.5"></i> {{alert}}</div>
                            <div class="text-gray-400 mt-2 pt-2 border-t border-gray-200">
                                <div class="flex items-center gap-1"><i class="fa-solid fa-check text-green-400"></i> è­·ç…§æœŸé™æª¢æŸ¥</div>
                            </div>
                         </div>
                     </div>
                 </div>
            </div>
            <div class="grid grid-cols-3 gap-x-4 gap-y-8 px-2">
                <div v-for="app in apps" :key="app.id" class="flex flex-col items-center cursor-pointer active:scale-95 transition duration-300 group" @click="currentView=app.view">
                    <div class="w-[76px] h-[76px] rounded-[30px] flex items-center justify-center text-3xl text-white shadow-lg border-[4px] border-white relative overflow-hidden" :class="app.bgClass"><i :class="app.icon"></i></div>
                    <span class="text-sm font-bold mt-3 text-gray-600 group-hover:text-pink-500 transition">{{app.name}}</span>
                </div>
            </div>
            <button @click="isWelcomeClosed=false" class="mt-12 mx-auto text-gray-400 text-sm font-bold border-b border-gray-300 pb-1 block">å›åˆ°æ­¡è¿é é¢</button>
            <div v-if="isGuest" class="text-center mt-4 text-xs font-bold text-gray-400 bg-gray-200 rounded-full py-1 w-32 mx-auto">è¨ªå®¢æ¨¡å¼</div>
        </div>

        <div v-if="currentView==='itinerary'" class="px-5 py-4 animate-fade-in">
            <div class="flex overflow-x-auto gap-3 mb-6 hide-scrollbar sticky top-0 bg-[#FFF0F5]/95 z-20 py-3 -mx-5 px-5 backdrop-blur-md">
                 <button v-for="(d,i) in tripDays" :key="i" @click="selectedDayIndex=i" :class="['px-6 py-3 rounded-2xl text-sm font-black border-2 transition shrink-0 shadow-sm flex flex-col items-center min-w-[70px]',selectedDayIndex===i?'bg-pink-400 text-white border-pink-400 shadow-lg scale-105':'bg-white text-gray-300 border-white']"><span>{{d.week}}</span><span class="text-[10px] mt-1 opacity-80">{{d.title}}</span></button>
            </div>
            <div v-if="[2,3].includes(selectedDayIndex)" class="flex justify-center mb-6">
                <div class="bg-white p-1 rounded-full border border-gray-200 shadow-sm flex">
                    <button @click="itineraryMode='normal'" :class="['px-4 py-1.5 rounded-full text-xs font-bold transition', itineraryMode==='normal'?'bg-pink-400 text-white':'text-gray-400']">ä¸€èˆ¬</button>
                    <button @click="itineraryMode='drive'" :class="['px-4 py-1.5 rounded-full text-xs font-bold transition', itineraryMode==='drive'?'bg-green-500 text-white':'text-gray-400']"><i class="fa-solid fa-car"></i> è‡ªé§•</button>
                </div>
            </div>
            <div class="pb-20 relative">
                <transition-group name="list" tag="div">
                    <div v-for="(item,idx) in getCurrentItinerary()" :key="item.id || idx">
                        <div class="card p-5 border-0 shadow-sm relative group z-10 mb-4" @click="!isGuest && openEditItineraryModal(item, idx)">
                            <div class="absolute left-0 top-0 bottom-0 w-1.5" :class="itineraryMode==='drive' && [2,3].includes(selectedDayIndex)?'bg-green-400':'bg-gradient-to-b from-pink-300 to-pink-100'"></div>
                            <div class="flex gap-4 pr-8">
                                <div class="flex flex-col items-center pt-1 min-w-[50px]">
                                    <span class="text-xs font-black text-gray-400 mb-2">{{item.hours}}</span>
                                    <div class="w-10 h-10 rounded-full text-lg flex items-center justify-center border" :class="itineraryMode==='drive' && [2,3].includes(selectedDayIndex)?'bg-green-50 text-green-500 border-green-100':'bg-pink-50 text-pink-400 border-pink-100'"><i :class="getIconByCategory(item.category)"></i></div>
                                </div>
                                <div class="flex-1 py-1">
                                    <h3 class="font-black text-gray-800 text-lg mb-1">{{item.name}}</h3>
                                    <p class="text-sm text-gray-500 line-clamp-2 font-medium mb-2">{{item.note}}</p>
                                    <div class="flex gap-2 flex-wrap">
                                        <a :href="getMapLink(item.mapKeyword, item.name)" target="_blank" @click.stop class="inline-flex items-center gap-1 text-[10px] bg-blue-50 text-blue-500 px-2 py-1 rounded-full font-bold border border-blue-100 hover:bg-blue-100 transition"><i class="fa-solid fa-location-arrow"></i> å°èˆª</a>
                                        <a v-if="itineraryMode==='drive' && [2,3].includes(selectedDayIndex) && item.parkingLink" :href="getMapLink(item.parkingLink)" target="_blank" @click.stop class="inline-flex items-center gap-1 text-[10px] bg-green-50 text-green-600 px-2 py-1 rounded-full font-bold border border-green-200 hover:bg-green-100"><i class="fa-solid fa-square-parking"></i> åœè»Šå ´</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-if="idx < getCurrentItinerary().length - 1" class="timeline-connect !h-[40px] mb-4" :class="{'drive-line': itineraryMode==='drive' && [2,3].includes(selectedDayIndex)}">
                            <div v-if="item.travelTime" class="timeline-badge" :class="{'drive-badge': itineraryMode==='drive' && [2,3].includes(selectedDayIndex)}">
                                {{item.travelTime}}
                            </div>
                        </div>
                    </div>
                </transition-group>
                <div v-if="getCurrentItinerary().length === 0" class="text-center text-gray-400 py-10 font-bold">æœ¬æ—¥ç„¡ç‰¹å®šè¡Œç¨‹ã€‚</div>
                <button v-if="!isGuest" @click="openAddItineraryModal" class="w-full py-4 mt-6 border-2 border-dashed border-gray-300 rounded-2xl text-gray-400 font-bold hover:bg-white/50 transition"><i class="fa-solid fa-plus"></i> æ–°å¢è¡Œç¨‹</button>
            </div>
        </div>

        <div v-if="currentView==='weather'" class="px-5 py-4 animate-fade-in">
             <div class="bg-pink-50 p-4 rounded-2xl border border-pink-200 mb-6 shadow-sm text-center relative overflow-hidden"><i class="fa-solid fa-fan text-pink-200 text-6xl absolute -right-4 -bottom-4 animate-spin-slow"></i><h3 class="font-black text-pink-500 mb-3 text-sm">ğŸŒ¸ 2026 æ¬Šå¨æ«»èŠ±é æ¸¬ (å¾©åŸç‰ˆ)</h3><div class="grid grid-cols-2 gap-3 mb-3"><a href="https://weathernews.jp/s/sakura/" target="_blank" class="bg-white text-pink-500 py-2 rounded-lg text-xs font-bold shadow-sm hover:shadow-md transition">Weathernews</a><a href="https://tenki.jp/sakura/" target="_blank" class="bg-white text-pink-500 py-2 rounded-lg text-xs font-bold shadow-sm hover:shadow-md transition">æ—¥æœ¬æ°£è±¡å”æœƒ</a></div>
             <div class="grid grid-cols-3 gap-2 mt-2"><div class="bg-white rounded-lg p-2 shadow-sm border border-pink-100"><div class="text-[10px] text-gray-400 font-bold">æ±äº¬</div><div class="font-black text-pink-600 text-lg">3/22</div></div><div class="bg-white rounded-lg p-2 shadow-sm border border-pink-100"><div class="text-[10px] text-gray-400 font-bold">éŒå€‰</div><div class="font-black text-pink-600 text-lg">3/25</div></div><div class="bg-white rounded-lg p-2 shadow-sm border border-pink-100"><div class="text-[10px] text-gray-400 font-bold">å¯Œå£«å±±</div><div class="font-black text-pink-600 text-lg">4/10</div></div></div>
             </div>
             <div class="space-y-4">
                <div v-for="w in weatherData" class="card p-6 text-white relative transition-all duration-500" :class="w.bg">
                    <div class="relative z-10 flex justify-between items-center">
                        <div>
                            <div class="font-bold opacity-80 uppercase text-xs tracking-widest">{{w.name}}</div>
                            <div class="text-5xl font-black my-2">{{w.temp}}<span class="text-2xl">Â°C</span></div>
                            <div class="text-sm font-bold opacity-90"><i class="fa-solid fa-cloud"></i> {{w.desc}}</div>
                        </div>
                        <div class="text-right">
                             <div class="text-xs font-bold bg-white/20 backdrop-blur px-3 py-1 rounded-full mb-2">ğŸ‘• ç©¿æ­å»ºè­°</div>
                             <div class="text-sm font-bold">{{getClothingAdvice(parseFloat(w.temp))}}</div>
                        </div>
                    </div>
                    <div class="absolute -bottom-4 -right-4 text-8xl opacity-20"><i class="fa-solid fa-sun"></i></div>
                </div>
                <div class="text-center text-[10px] text-gray-400 mt-4">Weather data provided by Open-Meteo</div>
             </div>
        </div>

        <div v-if="currentView==='shopping'" class="px-5 py-4 animate-fade-in">
            <div class="grid grid-cols-2 gap-3 mb-6"><a href="https://www.cosme.net/ranking/" target="_blank" class="bg-green-50 text-green-600 p-3 rounded-xl text-center font-bold text-xs border border-green-200 block">ğŸ‘‘ COSME å¤§è³</a><a href="https://www.shinyusha.co.jp/media/ldk-the-beauty/" target="_blank" class="bg-pink-50 text-pink-600 p-3 rounded-xl text-center font-bold text-xs border border-pink-200 block">ğŸ’„ LDK æ¯’èˆŒé›œèªŒ</a></div>
            <div class="flex gap-2 mb-4 overflow-x-auto hide-scrollbar"><button v-for="cat in ['cosme','ldk','souvenir']" @click="shopCat=cat" :class="['px-5 py-2 rounded-full font-bold text-xs whitespace-nowrap transition', shopCat===cat?'bg-pink-400 text-white':'bg-white text-gray-400']">{{{'cosme':'è—¥å¦æ¸…å–®','ldk':'LDKæ¨è–¦','souvenir':'ä¼´æ‰‹ç¦®'}[cat]}}</button></div>
            <div class="grid grid-cols-2 gap-4"><div v-for="(item,idx) in shopping[shopCat]" class="card !p-0 border-0 shadow-lg group relative" :key="idx"><div class="h-32 bg-gray-100 relative overflow-hidden"><img :src="item.img || 'https://placehold.co/300x300/pink/white?text=SHOP'" class="w-full h-full object-cover" @error="handleImgError"></div><div class="p-3"><div class="font-bold text-gray-800 text-sm mb-1 truncate">{{item.name}}</div><a :href="item.link || getSearchLink(item.name)" target="_blank" class="block text-center bg-gray-50 text-gray-500 text-[10px] py-1.5 rounded font-bold hover:bg-pink-500 hover:text-white transition">å‰å¾€å®˜ç¶² / æœå°‹</a></div><div v-if="!isGuest" class="absolute top-1 right-1 flex gap-1"><button @click="openEditModal('shopping', item, idx)" class="bg-white/90 p-1.5 rounded-full text-blue-400 shadow w-7 h-7 flex items-center justify-center"><i class="fa-solid fa-pen text-[10px]"></i></button><button @click="shopping[shopCat].splice(idx,1);saveData()" class="bg-white/90 p-1.5 rounded-full text-red-400 shadow w-7 h-7 flex items-center justify-center"><i class="fa-solid fa-trash text-[10px]"></i></button></div></div></div>
            
            <button v-if="!isGuest" @click="openAddShopModal" class="fab-main bg-purple-400 text-white" :class="{'lifted': true}"><i class="fa-solid fa-plus"></i></button>
            
            <div class="coupon-bar-container" v-if="currentView === 'shopping'">
                <button v-if="!isCouponMinimized" @click="showCouponModal=true" class="coupon-bar-content coupon-max flex items-center justify-center gap-2 animate-bounce-gentle">
                    <i class="fa-solid fa-ticket text-pink-500 text-xl"></i> 
                    <div class="text-left">
                        <div class="font-black text-gray-800 text-sm">ğŸ‡¯ğŸ‡µ æ¿€çœæŠ˜åƒ¹åˆ¸</div>
                        <div class="text-[10px] text-gray-400 font-bold">é»æ“Šé–‹å•Ÿ (å”å‰è¨¶å¾·/Bic/æ¾æœ¬æ¸…)</div>
                    </div>
                </button>
                <div v-if="!isCouponMinimized" @click="isCouponMinimized=true" class="text-[10px] text-gray-400 font-bold bg-white/80 px-2 py-1 rounded-full mb-4 cursor-pointer shadow pointer-events-auto">æ”¶èµ· <i class="fa-solid fa-chevron-down"></i></div>
                <button v-if="isCouponMinimized" @click="isCouponMinimized=false" class="coupon-bar-content coupon-min shadow-lg pointer-events-auto">
                    <i class="fa-solid fa-ticket text-2xl"></i>
                </button>
            </div>
        </div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, signOut, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
import { getFirestore, doc, onSnapshot, setDoc, enableIndexedDbPersistence } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
import { createApp, ref, computed, onMounted, watch } from "https://unpkg.com/vue@3.3.4/dist/vue.esm-browser.js";

// V43.0 Configuration
const firebaseConfig = { apiKey: "AIzaSyD3ojbkJVfDKmZQHRpZG-gp8gv7ajKdJr4", authDomain: "tokyo-trip-24b28.firebaseapp.com", projectId: "tokyo-trip-24b28", storageBucket: "tokyo-trip-24b28.firebasestorage.app", messagingSenderId: "518699705070", appId: "1:518699705070:web:56e95f603210d8d5d209ff" };
let auth, db; 
try { 
    const app = initializeApp(firebaseConfig); 
    auth = getAuth(app); 
    db = getFirestore(app); 
    enableIndexedDbPersistence(db).catch(e=>{console.log("Persistence enabled")}); 
} catch (e) { console.warn("Firebase Init Fail", e); }

// V43.0 Data Structure
const defaultPrepList = [{text:'è­·ç…§',checked:false},{text:'æ—¥å¹£',checked:false},{text:'ç¶²å¡/æ¼«éŠ',checked:false},{text:'è¡Œå‹•é›»æº',checked:false}];
const defaultData = {
    users: [{id:1,name:'å‰ä¼Š',icon:'ğŸ¹',list:[...defaultPrepList],lastActive:0},{id:2,name:'å°å…«',icon:'ğŸ±',list:[...defaultPrepList],lastActive:0},{id:3,name:'å…”å…”',icon:'ğŸ°',list:[...defaultPrepList],lastActive:0},{id:4,name:'å°æ¡ƒ',icon:'ğŸ‘',list:[...defaultPrepList],lastActive:0}],
    itinerary: [
        [{hours:"06:40",category:"Flight",name:"TPE èµ·é£›",note:"T1 è¾¦ç†ç™»æ©Ÿ",mapKeyword:"æ¡ƒåœ’æ©Ÿå ´ T1"},{hours:"10:40",category:"Flight",name:"NRT æŠµé”",note:"é ˜å–è¡Œæ/è³¼è²·è¥¿ç“œå¡",mapKeyword:"æˆç”°æ©Ÿå ´"},{hours:"14:00",category:"Sightseeing",name:"æ™´ç©ºå¡”",note:"ä¸‹åˆè¡Œç¨‹",mapKeyword:"æ±äº¬æ™´ç©ºå¡”",travelTime:"â¬‡ 60-90min (é›»è»Š/å·´å£«)"},{hours:"18:00",category:"Food",name:"éŒ¦ç³¸ç”ºå‘¨é­",note:"æ™šé¤",mapKeyword:"éŒ¦ç³¸ç”ºç«™ ç¾é£Ÿ",travelTime:"â¬‡ 15min (æ­¥è¡Œ)"}],
        [{hours:"09:00",category:"Sightseeing",name:"æ·ºè‰å¯º",note:"é›·é–€/ä»²è¦‹ä¸–é€š",mapKeyword:"æ·ºè‰å¯º",travelTime:"â¬‡ 20min (é›»è»Š)"},{hours:"12:00",category:"Food",name:"æ·ºè‰å‘¨é­",note:"åˆé¤",mapKeyword:"æ·ºè‰ç«™ ç¾é£Ÿ",travelTime:"â¬‡ 5min (æ­¥è¡Œ)"},{hours:"14:00",category:"Sightseeing",name:"å°ç¶²ç¥ç¤¾/ä¸Šé‡å…¬åœ’",note:"å¼·é‹å„é™¤/å…¬åœ’æ•£æ­¥",mapKeyword:"å°ç¶²ç¥ç¤¾",travelTime:"â¬‡ 25min (é›»è»Š)"},{hours:"18:00",category:"Shopping",name:"ç§‹è‘‰åŸ/æ±äº¬ä¸€ç•ªè¡—",note:"å‹•æ¼«æˆ–é€›è¡—",mapKeyword:"ç§‹è‘‰åŸ",travelTime:"â¬‡ 15min (é›»è»Š)"},{hours:"20:00",category:"Food",name:"æ™šé¤",note:"ä¾é€›è¡—è¡Œç¨‹æ±ºå®š",mapKeyword:"æ±äº¬è»Šç«™ ç¾é£Ÿ"}],
        [{hours:"08:00",category:"Transport",name:"å‰å¾€å¯Œå£«å±±",note:"éŒ¦ç³¸ç”ºå‡ºç™¼ (å¯Œå£«å›éŠ)",mapKeyword:"éŒ¦ç³¸ç”ºç«™",travelTime:"â¬‡ 120min (JRç‰¹æ€¥)"},{hours:"10:30",category:"Transport",name:"é–‹å§‹ç§Ÿè»Š",note:"å¯Œå£«å±±ç§Ÿè»Š 3å¤©2å¤œ",mapKeyword:"æ²³å£æ¹– ç§Ÿè»Š",travelTime:"â¬‡ 0min"},{hours:"13:00",category:"Sightseeing",name:"æ²³å£æ¹–è‡ªç„¶ç”Ÿæ´»é¤¨",note:"å¤§çŸ³å…¬åœ’çµ•æ™¯",mapKeyword:"æ²³å£æ¹–è‡ªç„¶ç”Ÿæ´»é¤¨",travelTime:"â¬‡ 20min (è»Š)"},{hours:"15:00",category:"Sightseeing",name:"æ–°å€‰å±±æ·ºé–“å…¬åœ’",note:"å¿ éˆå¡”ç­æœ›å° (éœ€çˆ¬éšæ¢¯)",mapKeyword:"æ–°å€‰å±±æ·ºé–“å…¬åœ’",travelTime:"â¬‡ 25min (è»Š)"},{hours:"17:30",category:"Sightseeing",name:"é‡‘é³¥å±…/æœ¬ç”ºå•†åº—è¡—",note:"æ—¥å·æ™‚è¨ˆåº—æ‹ç…§",mapKeyword:"å¯Œå£«å‰ç”°æœ¬ç”ºé€šã‚Š",travelTime:"â¬‡ 10min (è»Š)"},{hours:"19:00",category:"Food",name:"æ™šé¤",note:"è‡ªè¡Œçƒ¹é£ªæˆ–å•†åº—è¡—",mapKeyword:"Ogino æ²³å£æ¹–åº—"}],
        [{hours:"05:00",category:"Sightseeing",name:"å¹³é‡ä¹‹æ¿±",note:"çœ‹æ—¥å‡º (è¦–å¤©æ°£)",mapKeyword:"å¹³é‡ã®æµœ",travelTime:"â¬‡ 30min (è»Š)"},{hours:"09:00",category:"Sightseeing",name:"é•·æ± è¦ªæ°´å…¬åœ’/ç™½é³¥æ¿±",note:"å±±ä¸­æ¹–ç§Ÿè‡ªè¡Œè»Š",mapKeyword:"é•·æ± è¦ªæ°´å…¬åœ’",travelTime:"â¬‡ 15min (è»Š)"},{hours:"12:00",category:"Food",name:"å±±ä¸­æ¹–é¤å»³",note:"åˆé¤",mapKeyword:"å±±ä¸­æ¹– ç¾é£Ÿ",travelTime:"â¬‡ 0min"},{hours:"14:00",category:"Sightseeing",name:"KABA æ°´é™¸å·´å£«",note:"æ—­æ—¥ä¸˜æ¹–ç•”ç¶ åœ°å…¬åœ’",mapKeyword:"KABA BUS",travelTime:"â¬‡ 10min (è»Š)"},{hours:"18:00",category:"Food",name:"æ™šé¤",note:"è‡ªè¡Œçƒ¹é£ª (Oginoè¶…å¸‚)",mapKeyword:"Ogino æ²³å£æ¹–åº—",travelTime:"â¬‡ 30min (è»Š)"}],
        [{hours:"09:00",category:"Sightseeing",name:"æ²³å£æ¹–çºœè»Š",note:"é‡‘é³¥å±…/çµ•æ™¯é¦éŸ†",mapKeyword:"æ²³å£æ¹– å¯Œå£«å±±å…¨æ™¯çºœè»Š",travelTime:"â¬‡ 20min (è»Š)"},{hours:"11:00",category:"Shopping",name:"Fujisan Shokupan",note:"è³¼è²·ä¼´æ‰‹ç¦®é»å¿ƒ",mapKeyword:"Fujisan Shokupan",travelTime:"â¬‡ 10min (è»Š)"},{hours:"14:00",category:"Transport",name:"å¯Œå£«å›éŠ",note:"è¿”å›æ±äº¬æ–°å®¿ (æ”¾è¡Œæ)",mapKeyword:"æ²³å£æ¹–ç«™",travelTime:"â¬‡ 120min (JRç‰¹æ€¥)"},{hours:"16:30",category:"Shopping",name:"æ± è¢‹å¤ªé™½åŸ",note:"é€›è¡—è¡Œç¨‹",mapKeyword:"æ± è¢‹å¤ªé™½åŸ",travelTime:"â¬‡ 20min (é›»è»Š)"},{hours:"19:00",category:"Food",name:"å¤ªé™½åŸé¤å»³",note:"æ™šé¤",mapKeyword:"æ± è¢‹å¤ªé™½åŸ ç¾é£Ÿ"}],
        [{hours:"09:00",category:"Transport",name:"å‰å¾€è—¤æ¾¤",note:"æ–°å®¿å‡ºç™¼ (æ±Ÿä¹‹é›»ä¸€æ—¥éŠ)",mapKeyword:"æ–°å®¿ç«™",travelTime:"â¬‡ 60min (å°ç”°æ€¥)"},{hours:"10:30",category:"Sightseeing",name:"æ±Ÿä¹‹å³¶/éŒå€‰é«˜æ ¡",note:"çŒç±ƒé«˜æ‰‹å¹³äº¤é“",mapKeyword:"éŒå€‰é«˜æ ¡å‰ç«™",travelTime:"â¬‡ 20min (æ±Ÿä¹‹é›»)"},{hours:"13:00",category:"Food",name:"ä¸ƒé‡Œæ¿±é¤å»³",note:"åˆé¤",mapKeyword:"ä¸ƒé‡Œæ¿± ç¾é£Ÿ",travelTime:"â¬‡ 10min (æ±Ÿä¹‹é›»)"},{hours:"15:00",category:"Sightseeing",name:"éŒå€‰/é¶´å²¡å…«å¹¡å®®",note:"å°ç”ºé€šé€›è¡—",mapKeyword:"é¶´å²¡å…«å¹¡å®®",travelTime:"â¬‡ 20min (æ±Ÿä¹‹é›»)"},{hours:"18:00",category:"Transport",name:"è¿”å›æ–°å®¿",note:"æ™šé¤: æ–°å®¿æˆ–çƒ¹é£ª",mapKeyword:"æ–°å®¿ç«™",travelTime:"â¬‡ 60min (å°ç”°æ€¥)"}],
        [{hours:"09:00",category:"Sightseeing",name:"æ±äº¬éµå¡”/éº»å¸ƒå°",note:"å…­æœ¬æœ¨å‘¨é­æ‹ç…§",mapKeyword:"éº»å¸ƒå°Hills",travelTime:"â¬‡ 30min (åœ°éµ)"},{hours:"12:00",category:"Food",name:"å…­æœ¬æœ¨é¤å»³",note:"åˆé¤",mapKeyword:"å…­æœ¬æœ¨ ç¾é£Ÿ",travelTime:"â¬‡ 10min (æ­¥è¡Œ)"},{hours:"14:00",category:"Shopping",name:"å‰å¾€æ¾€è°·",note:"é€›è¡—",mapKeyword:"æ¾€è°·ç«™",travelTime:"â¬‡ 15min (åœ°éµ)"},{hours:"17:00",category:"Sightseeing",name:"SHIBUYA SKY",note:"çµ•ç¾æ—¥è½/åå­—è·¯å£",mapKeyword:"SHIBUYA SKY",travelTime:"â¬‡ 5min (æ­¥è¡Œ)"},{hours:"20:00",category:"Food",name:"æ¾€è°·é¤å»³",note:"æ™šé¤",mapKeyword:"æ¾€è°· ç¾é£Ÿ"}],
        [{hours:"10:00",category:"Sightseeing",name:"è‡ªç”±è¡Œç¨‹",note:"æœ€å¾Œæ¡è²·",mapKeyword:"ä¸Šé‡é˜¿ç¾æ©«ä¸",travelTime:"â¬‡ 0min"},{hours:"20:40",category:"Flight",name:"NRT èµ·é£›",note:"æˆç”°æ©Ÿå ´å ±åˆ°",mapKeyword:"æˆç”°æ©Ÿå ´"},{hours:"23:20",category:"Flight",name:"TPE æŠµé”",note:"å›åˆ°æº«æš–çš„å®¶",mapKeyword:"æ¡ƒåœ’æ©Ÿå ´"}]
    ],
    drivePlan: [
        [{hours:"08:00",category:"Transport",name:"å‰å¾€å¯Œå£«å±±",note:"éŒ¦ç³¸ç”ºå‡ºç™¼",travelTime:"ğŸš— 120min"}, {hours:"10:30",category:"Transport",name:"é–‹å§‹ç§Ÿè»Š",note:"æ²³å£æ¹– ç§Ÿè»Š",travelTime:"ğŸš— 20min",parkingLink:"æ²³å£æ¹–é§… é§è»Šå ´"}, {hours:"13:00",category:"Sightseeing",name:"æ²³å£æ¹–è‡ªç„¶ç”Ÿæ´»é¤¨",note:"å¤§çŸ³å…¬åœ’çµ•æ™¯",travelTime:"ğŸš— 20min",parkingLink:"å¤§çŸ³å…¬åœ’ é§è»Šå ´"}, {hours:"15:00",category:"Sightseeing",name:"æ–°å€‰å±±æ·ºé–“å…¬åœ’",note:"å¿ éˆå¡”ç­æœ›å°",travelTime:"ğŸš— 15min",parkingLink:"æ–°å€‰å±±æ·ºé–“å…¬åœ’ é§è»Šå ´"}, {hours:"17:30",category:"Sightseeing",name:"é‡‘é³¥å±…/æœ¬ç”ºå•†åº—è¡—",note:"æ—¥å·æ™‚è¨ˆåº—æ‹ç…§",travelTime:"ğŸš— 10min",parkingLink:"å¯Œå£«å‰ç”°å¸‚å–¶ æœ¬ç”ºé€šã‚Šé§è»Šå ´"}, {hours:"19:00",category:"Food",name:"æ™šé¤",note:"è‡ªè¡Œçƒ¹é£ªæˆ–å•†åº—è¡—"}],
        [{hours:"05:00",category:"Sightseeing",name:"å¹³é‡ä¹‹æ¿±",note:"çœ‹æ—¥å‡º",travelTime:"ğŸš— 30min",parkingLink:"å¹³é‡ã®æµœ é§è»Šå ´"}, {hours:"09:00",category:"Sightseeing",name:"é•·æ± è¦ªæ°´å…¬åœ’/ç™½é³¥æ¿±",note:"å±±ä¸­æ¹–ç§Ÿè‡ªè¡Œè»Š",travelTime:"ğŸš— 15min",parkingLink:"é•·æ± è¦ªæ°´å…¬åœ’ é§è»Šå ´"}, {hours:"12:00",category:"Food",name:"å±±ä¸­æ¹–é¤å»³",note:"åˆé¤",travelTime:"ğŸš— 20min"}, {hours:"14:00",category:"Sightseeing",name:"KABA æ°´é™¸å·´å£«",note:"æ—­æ—¥ä¸˜æ¹–ç•”ç¶ åœ°å…¬åœ’",travelTime:"ğŸš— 30min",parkingLink:"æ—­æ—¥ä¸˜æ¹–ç•”ç·‘åœ°å…¬åœ’ é§è»Šå ´"}, {hours:"18:00",category:"Food",name:"æ™šé¤",note:"è‡ªè¡Œçƒ¹é£ª (Oginoè¶…å¸‚)"}]
    ],
    shopping: {
        cosme: [{name:'Canmake è‡¥è ¶ç›¤',link:'https://www.canmake.com/'},{name:'Kate æ€ªç¸å”‡è†',link:'https://www.nomorerules.net/'},{name:'Tirtir æ°£å¢Šç²‰é¤…',link:''},{name:'Cezanne ç å…‰ä¿®å®¹',link:'https://www.cezanne.co.jp/'},{name:'Excel çœ¼å½±',link:'https://noevirgroup.jp/excel/'}],
        ldk: [{name:'MINON èƒºåŸºé…¸é¢è†œ',link:'https://www.daiichisankyo-hc.co.jp/site_minon/'},{name:'Quality 1st é¢è†œ',link:''},{name:'IHADA åŒ–å¦æ°´',link:''},{name:'Elixir å°é‡‘ç®¡',link:''},{name:'Fino é«®è†œ',link:''}],
        souvenir: [{name:'NY Perfect Cheese',link:''},{name:'Press Butter Sand',link:'https://buttersand.com/'},{name:'Sugar Butter Tree',link:''},{name:'Tokyo Banana',link:'https://www.tokyobanana.jp/'},{name:'ç™½è‰²æˆ€äºº',link:'https://www.ishiya.co.jp/'}]
    },
    coupons: [
        {name: 'å”å‰è¨¶å¾·', discount: '10% (å…ç¨…) + 5%', link: 'https://www.djapanpass.com/coupon/0002000103', note: 'æœªç¨…æ»¿ 1è¬æ—¥åœ“'},
        {name: 'Bic Camera', discount: '10% (å…ç¨…) + 7%', link: 'https://www.biccamera.com/bc/c/info/order/lang-select.jsp', note: 'å‡ºç¤ºè­·ç…§'},
        {name: 'æ¾æœ¬æ¸…', discount: '10% (å…ç¨…) + 3~7%', link: 'https://www.matsukiyo.co.jp/store/online', note: 'ä¾é‡‘é¡æŠ˜æ‰£'},
        {name: 'ä¸‰äº• Outlet', discount: 'å„ªæƒ åˆ¸ + è´ˆå“', link: 'https://mitsui-shopping-park.com/mop/index.html', note: 'è‡³æœå‹™å°å‡ºç¤º QR Code æ›å–'}
    ],
    phrases: [{jp:'ã™ã¿ã¾ã›ã‚“',zh:'ä¸å¥½æ„æ€/è«‹å•'},{jp:'ã“ã‚Œãã ã•ã„',zh:'æˆ‘è¦é€™å€‹'},{jp:'ã„ãã‚‰ã§ã™ã‹',zh:'è«‹å•å¤šå°‘éŒ¢'},{jp:'ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™',zh:'æˆ‘è¦çµå¸³'},{jp:'è¢‹ã„ã‚Šã¾ã›ã‚“',zh:'ä¸ç”¨è¢‹å­'},{jp:'ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹',zh:'å»æ‰€åœ¨å“ªè£¡'},{jp:'å†™çœŸã‚’æ’®ã£ã¦ã‚‚ã„ã„ã§ã™ã‹',zh:'å¯ä»¥æ‹ç…§å—'},{jp:'è‹±èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ã‚Šã¾ã™ã‹',zh:'æœ‰è‹±æ–‡èœå–®å—'},{jp:'ãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹',zh:'æœ‰æ¨è–¦çš„å—'},{jp:'æ°´ãã ã•ã„',zh:'è«‹çµ¦æˆ‘æ°´'}], 
    spots: { 
        food: {
            Tokyo: [{name:'AFURI',desc:'æ¸…æ–°æŸšå­é¹½æ‹‰éºµ',link:'AFURI åŸå®¿', reserve:false, note:'ã€å…è¨‚ä½ã€‘å»ºè­°é¿é–‹ç”¨é¤å°–å³°ï¼ŒæŸšå­é¹½æ‹‰éºµå¿…é»ã€‚'},{name:'å™å™è‹‘',desc:'é«˜ç´šç‡’è‚‰æ™¯è§€é¤å»³',link:'å™å™è‹‘ æ™´ç©ºå¡”', reserve:true, reserveLink:'https://www.tablecheck.com/zh-TW/shops/jojoen-tokyoskytreetown-solamachi/reserve', note:'ã€éœ€è¨‚ä½ã€‘åˆé–“å¥—é¤CPå€¼æœ€é«˜ï¼Œçª—é‚Šä½ç½®éœ€ä¸€å€‹æœˆå‰é è¨‚ã€‚'},{name:'HARBS',desc:'å¿…åƒæ°´æœåƒå±¤è›‹ç³•',link:'HARBS LUMINE EST', reserve:false, note:'ã€å…è¨‚ä½ã€‘å…§ç”¨æ¯äººä½æ¶ˆä¸€æ¯é£²æ–™ï¼Œäº¦å¯å¤–å¸¶å›é£¯åº—åƒã€‚'},{name:'æ·ºè‰ä»ŠåŠ',desc:'ç™¾å¹´å£½å–œç‡’è€åº—',link:'æ·ºè‰ä»ŠåŠ åœ‹éš›é€š', reserve:true, reserveLink:'https://www.asakusaimahan.co.jp/english/guide', note:'ã€éœ€è¨‚ä½ã€‘åˆé–“å£½å–œç‡’å®šé£Ÿè¼ƒåˆ’ç®—ï¼Œç™¾å¹´è€åº—æœå‹™æ¥µä½³ã€‚'},{name:'ç‚¸ç‰›æ’ æœ¬æ‘',desc:'è‡ªè¡Œç…çƒ¤è»Ÿå«©ç‰›æ’',link:'ç‰›ã‹ã¤ã‚‚ã¨æ‘ æ¾€è°·', reserve:false, note:'ã€ç¾å ´æ’éšŠã€‘åªèƒ½ç¾å ´æ’éšŠï¼Œå»ºè­°é–‹åº—å‰15åˆ†é˜åˆ°ã€‚'}], 
            Kamakura: [{name:'Bills',desc:'ä¸–ç•Œç¬¬ä¸€å¥½åƒé¬†é¤…',link:'Bills ä¸ƒé‡Œãƒ¶æµœ', reserve:true, reserveLink:'https://billsjapan.com/en/shichirigahama', note:'ã€éœ€è¨‚ä½ã€‘æˆ¶å¤–åº§ä½å¯çœ‹æµ·æ™¯ï¼Œé¬†é¤…è£½ä½œéœ€20åˆ†é˜ã€‚'},{name:'Caraway',desc:'æ’éšŠå’–å“©ååº—',link:'Caraway Curry', reserve:false, note:'ã€ç¾å ´æ’éšŠã€‘ä»½é‡éå¸¸å¤§ï¼Œå¥³ç”Ÿå»ºè­°é»å°é£¯ã€‚åªæ”¶ç¾é‡‘ã€‚'},{name:'Pacific Drive-in',desc:'æµ·æ™¯å¤å¨å¤·é¤å»³',link:'Pacific Drive-in', reserve:false, note:'ã€ç¾å ´æ’éšŠã€‘é€±æœ«äººæ½®å¤šï¼Œè’œè“‰è¦é£¯æ˜¯æ‹›ç‰Œã€‚'},{name:'åŠ›é¤…å®¶',desc:'ç™¾å¹´è€èˆ–æ¬Šäº”éƒåŠ›é¤…',link:'åŠ›é¤…å®¶', reserve:false, note:'ä¿å­˜æœŸé™çŸ­ï¼Œå»ºè­°ç•¶å¤©åƒå®Œã€‚'},{name:'éŒå€‰é‡œé£¯',desc:'å»ä»”é­šé‡œé£¯',link:'éŒå€‰é‡œé£¯ ã‹ã¾ã‹ã¾', reserve:true, reserveLink:'https://www.kamakama.jp/', note:'ã€å»ºè­°è¨‚ä½ã€‘æœ€å¾Œå¯ä»¥åŠ é«˜æ¹¯è®ŠèŒ¶æ³¡é£¯ï¼Œä¸€é£¯å…©åƒã€‚'}], 
            Fuji: [{name:'ä¸å‹•èŒ¶å±‹',desc:'ç‰¹è‰²é›²æœµå»ºç¯‰é¤ºé£¥éºµ',link:'ä¸å‹•èŒ¶å±‹ æ±æˆ€è·¯', reserve:false, note:'ã€ç¾å ´æ’éšŠã€‘æ±æˆ€è·¯åº—å»ºç¯‰æœ€ç¾ï¼Œç¿»æ¡Œç‡å¿«ã€‚'},{name:'å±±éº“åœ’',desc:'ç‚­ç«çˆç«¯ç‡’é«”é©—',link:'å±±éº“åœ’', reserve:true, reserveLink:'https://sanrokuen.com/', note:'ã€å»ºè­°è¨‚ä½ã€‘é«”é©—åœçˆè£ç‡’çƒ¤ï¼Œèº«ä¸Šæœƒæœ‰ç‚­ç«å‘³ã€‚'},{name:'æ¹–æ³¢',desc:'æ²³å£æ¹–æ™¯è§€å®šé£Ÿ',link:'æ¹–æ³¢é£Ÿäº‹è™•', reserve:false, note:'ã€ç¾å ´æ’éšŠã€‘é çª—ä½ç½®å¯çœ‹å¯Œå£«å±±ï¼Œå¤©å©¦ç¾…å®šé£Ÿæ¨è–¦ã€‚'},{name:'Hana ç‡’è‚‰',desc:'ç•¶åœ°äººæ¨è–¦ç‡’è‚‰',link:'Hana Yakiniku', reserve:true, reserveLink:'https://www.hotpepper.jp/strJ000354673/yoyaku/', note:'ã€éœ€è¨‚ä½ã€‘CPå€¼é«˜çš„å–®é»ç‡’è‚‰ï¼Œå»ºè­°é ç´„ã€‚'},{name:'The Park',desc:'å¯Œå£«å±±åå¸',link:'Food Labo', reserve:false, note:'å¯Œå£«å±±é€ å‹åå¸ï¼Œæ‹ç…§æ‰“å¡å¿…å‚™ã€‚'}]
        }, 
        photo: {
            Tokyo: [{name:'SHIBUYA SKY',desc:'æ±äº¬æœ€ç¾å±•æœ›å°',link:'SHIBUYA SKY'},{name:'è±ªå¾·å¯º',desc:'æ»¿æ»¿æ‹›è²¡è²“',link:'è±ªå¾·å¯º'},{name:'æ±äº¬éµå¡”',desc:'èŠå…¬åœ’æœ€ä½³æ©Ÿä½',link:'èŠå…¬åœ’ 4è™Ÿåœ°'},{name:'æ·ºè‰é›·é–€',desc:'ç¶“å…¸åœ°æ¨™å¤§ç‡ˆç± ',link:'é›·é–€'},{name:'TeamLab',desc:'å…‰å½±è—è¡“å±•',link:'TeamLab Planets'}], 
            Kamakura: [{name:'éŒå€‰é«˜æ ¡å‰',desc:'çŒç±ƒé«˜æ‰‹å¹³äº¤é“',link:'éŒå€‰é«˜æ ¡å‰é§…'},{name:'é•·è°·å¯º',desc:'çœºæœ›æ¹˜å—æµ·å²¸',link:'é•·è°·å¯º'},{name:'å ±åœ‹å¯º',desc:'çµ•ç¾ç«¹æ—',link:'å ±åœ‹å¯º'},{name:'æ±Ÿå³¶ç¥ç¤¾',desc:'æµ·ä¸Šé³¥å±…',link:'æ±Ÿå³¶ç¥ç¤¾'},{name:'ä¸ƒé‡Œæ¿±',desc:'æœ€ç¾æµ·å²¸ç·š',link:'ä¸ƒé‡Œãƒ¶æµœ æµ·å²¸'}], 
            Fuji: [{name:'æ–°å€‰å±±æ·ºé–“å…¬åœ’',desc:'äº”é‡å¡”èˆ‡å¯Œå£«å±±',link:'æ–°å€‰å±±æ·ºé–“å…¬åœ’'},{name:'ä¸‹å‰ç”°',desc:'æ—¥å·æ™‚è¨ˆåº—æœ¬ç”ºé€š',link:'æ—¥å·æ™‚è¨ˆåº—'},{name:'å¤§çŸ³å…¬åœ’',desc:'èŠ±æµ·å¯Œå£«å±±',link:'å¤§çŸ³å…¬åœ’'},{name:'æ²³å£æ¹–è»Šç«™',desc:'LAWSON å¯Œå£«å±±',link:'æ²³å£æ¹–é§…'},{name:'å¹³é‡ä¹‹æ¿±',desc:'å¯§éœæ¹–ç•”å€’å½±',link:'å¹³é‡ã®æµœ'}]
        } 
    },
    transportTickets: [
        {name:'æ±äº¬åœ°éµåˆ¸ (24/48/72h)', url:'https://www.tokyometro.jp/tcn/ticket/travel/index.html', icon:'fa-solid fa-subway', note:'ã€ä½¿ç”¨ç¯„åœã€‘\næ±äº¬ Metro 9æ¢ç·š + éƒ½ç‡Ÿåœ°éµ 4æ¢ç·š\n\nã€ä¸é©ç”¨ã€‘\nJR å±±æ‰‹ç·šã€ç§éµ (å¦‚ç™¾åˆæµ·é·—è™Ÿ)\n\nã€å•Ÿç”¨ã€‘\nç¬¬ä¸€æ¬¡é€²ç«™èµ·ç®—å°æ™‚ï¼Œå»ºè­°é€£çºŒä½¿ç”¨ã€‚'},
        {name:'Suica è¥¿ç“œå¡', url:'https://www.jreast.co.jp/tc/pass/suica.html', icon:'fa-solid fa-mobile-screen', note:'ã€æ‰‹æ©Ÿç‰ˆã€‘\niPhone éŒ¢åŒ…ç›´æ¥æ–°å¢ > äº¤é€šå¡ > Suica\n\nã€å„²å€¼ã€‘\nå¯ä½¿ç”¨ Apple Pay (Mastercard/JCB)\n\nã€å¯¦é«”å¡ã€‘\nç›®å‰ç¼ºè²¨ï¼Œå»ºè­°ä½¿ç”¨ Welcome Suica (æˆç”°æ©Ÿå ´è²·)'},
        {name:'JR æ±äº¬å»£åŸŸå‘¨éŠåˆ¸', url:'https://www.jreast.co.jp/multi/zh-CHT/pass/tokyowide.html', icon:'fa-solid fa-ticket', note:'ã€å”®åƒ¹ã€‘\n15,000 æ—¥åœ“ (3å¤©)\n\nã€å¿…ç”¨è¡Œç¨‹ã€‘\n1. æ±äº¬ <-> æ²³å£æ¹– (å¯Œå£«å›éŠ)\n2. æ±äº¬ <-> è¼•äº•æ¾¤/æ—¥å…‰\n3. æˆç”°æ©Ÿå ´ (N\'EX)\n\n* éœ€é€£çºŒ3å¤©ä½¿ç”¨ï¼Œè«‹è¨ˆç®—ç¸½è»Šè³‡æ˜¯å¦åˆ’ç®—ã€‚'},
        {name:'å¯Œå£«å›éŠè™Ÿ (JR)', url:'https://www.eki-net.com/zh-CHT/jreast-train-reservation/Top/Index', icon:'fa-solid fa-train', note:'ã€é‡è¦ã€‘\nå…¨è»ŠæŒ‡å®šå¸­ï¼Œç„¡ç«™ç¥¨ï¼\nè«‹å‹™å¿…æå‰ 30 å¤©ç”± Eki-net é ç´„ã€‚\n\næŒæœ‰å»£åŸŸå‘¨éŠåˆ¸è€…ï¼Œä»éœ€å»æ©Ÿå°åŠƒä½ (å…è²»)ã€‚'}
    ],
    rentalCars: [
        {company: 'Toyota Rent a Car', pickup: 'æ²³å£æ¹–ç«™å‰åº—', url: 'https://rent.toyota.co.jp/zh-tw/', note: 'éœ€æº–å‚™å°ç£é§•ç…§ + æ—¥æ–‡è­¯æœ¬', status: 'todo', reservationNumber:'', insurance:''},
        {company: 'Tabirai æ¯”åƒ¹ç¶²', pickup: 'ä¾ç…§æ–¹æ¡ˆ', url: 'https://tc.tabirai.net/car/', note: 'å¤šé–“ç§Ÿè»Šå…¬å¸æ¯”åƒ¹', status: 'todo', reservationNumber:'', insurance:''}
    ],
    hotels: [
        {name:'éŒ¦ç³¸ç”ºæ°‘å®¿', img:'bnb.jpg', link:'éŒ¦ç³¸ç”º æ°‘å®¿'},
        {name:'Megu Fuji', img:'megu.jpg', link:'Megu Fuji 2026'},
        {name:'DOMO æ°‘å®¿', img:'domo.jpg', link:'DOMO æ°‘å®¿ æ±æ–°å®¿'}
    ]
};

createApp({
    setup() {
        const currentView = ref('welcome');
        const currentUser = ref(null);
        const isGuest = ref(false); 
        const showPersonaModal = ref(false);
        const showUserEditModal = ref(false);
        const editingUser = ref({});
        const isWelcomeClosed = ref(false);
        const showLoginModal = ref(false);
        const loginForm = ref({email:'',password:''});
        const isLoggedIn = ref(false);
        const isSaving = ref('synced'); 
        const syncLog = ref([]); 
        
        // Data Refs
        const users = ref(JSON.parse(JSON.stringify(defaultData.users)));
        const itinerary = ref(defaultData.itinerary);
        const drivePlan = ref(defaultData.drivePlan);
        const expenses = ref([]);
        const spots = ref(defaultData.spots);
        const shopping = ref(defaultData.shopping);
        const japanesePhrases = ref(defaultData.phrases);
        const suggestedTickets = ref([]); 
        const transportTickets = ref(defaultData.transportTickets);
        const rentalCars = ref(defaultData.rentalCars);
        const hotels = ref(defaultData.hotels);
        const coupons = ref(defaultData.coupons);
        
        const selectedDayIndex = ref(0);
        const itineraryMode = ref('normal');
        const exchangeRate = ref(0.215);
        const moneyTab = ref('record');
        const hotelTab = ref('stay');
        const shopCat = ref('cosme');
        const currentLoc = ref('Tokyo');
        const weatherData = ref([{name:'Tokyo',temp:'--',bg:'bg-blue-400',desc:'è¼‰å…¥ä¸­'},{name:'Kamakura',temp:'--',bg:'bg-indigo-400',desc:'è¼‰å…¥ä¸­'},{name:'Fuji',temp:'--',bg:'bg-purple-400',desc:'è¼‰å…¥ä¸­'}]);
        const showCouponModal = ref(false);
        const isCouponMinimized = ref(true); // V43.0 Coupon Minimized State
        
        const showExpenseModal = ref(false);
        const modalData = ref({});
        const expenseMode = ref('private'); 
        const expandedPhrase = ref(null);
        const showModal = ref(false);
        const modalTitle = ref('');
        const modalFields = ref([]);
        const modalHasImg = ref(false);
        const modalCallback = ref(null);
        const isEditingItem = ref(false); 
        const modalDeleteCallback = ref(null);
        const showFlightModal = ref(false);
        const tempFlightData = ref({code:'',seat:''});
        const flightMode = ref('out'); 
        const showRentalModal = ref(false);
        const activeRental = ref({});
        
        const apps = [{id:1,name:'è¡Œç¨‹',icon:'fa-solid fa-map',view:'itinerary',bgClass:'bg-pink-400'},{id:2,name:'å°è²¡åº«',icon:'fa-solid fa-yen-sign',view:'money',bgClass:'bg-yellow-400'},{id:3,name:'ä½å®¿äº¤é€š',icon:'fa-solid fa-hotel',view:'hotel',bgClass:'bg-indigo-400'},{id:4,name:'è¡Œå‰æº–å‚™',icon:'fa-solid fa-suitcase',view:'prep',bgClass:'bg-blue-400'},{id:5,name:'åƒåƒå–å–',icon:'fa-solid fa-utensils',view:'food',bgClass:'bg-orange-400'},{id:6,name:'ç¶²ç¾æ‰“å¡',icon:'fa-solid fa-camera',view:'photo',bgClass:'bg-rose-400'},{id:7,name:'å¿«æ¨‚è³¼',icon:'fa-solid fa-bag-shopping',view:'shopping',bgClass:'bg-purple-400'},{id:8,name:'å¤©æ°£',icon:'fa-solid fa-cloud-sun',view:'weather',bgClass:'bg-sky-400'},{id:9,name:'ç¿»è­¯',icon:'fa-solid fa-language',view:'japanese',bgClass:'bg-emerald-400'}];
        const tripDays = [{week:'D1',title:'3/27'},{week:'D2',title:'3/28'},{week:'D3',title:'3/29'},{week:'D4',title:'3/30'},{week:'D5',title:'3/31'},{week:'D6',title:'4/01'},{week:'D7',title:'4/02'},{week:'D8',title:'4/03'}];
        const daysUntilTrip = ref(Math.ceil((new Date('2026-03-27') - new Date())/(1000*60*60*24)));
        const smartReminders = computed(() => { const l=[]; const diffDays = daysUntilTrip.value; const text = JSON.stringify(itinerary.value); if(text.includes('å¯Œå£«å›éŠ')) { if(diffDays <= 33 && diffDays > 30) l.push("å¯Œå£«å›éŠè™Ÿï¼šæº–å‚™æ¶ç¥¨ (30å¤©å‰)ï¼"); if(diffDays <= 30) l.push("ğŸ”´ å¯Œå£«å›éŠè™Ÿï¼šç¾åœ¨å¯ä»¥æ¶ç¥¨äº†ï¼"); } if(diffDays <= 2) l.push("ç·šä¸Šé è¾¦ç™»æ©Ÿ (48hrå‰)"); if(diffDays <= 0 && diffDays > -8) l.push("æ—…é€”æ„‰å¿«ï¼ğŸŒ¸"); return l; });

        // V43.0 Ticket Wizard Restoration
        const autoScanTickets = () => {
            const fullText = JSON.stringify(itinerary.value).toLowerCase();
            const rules = [
                {k:'disney', n:'è¿ªå£«å°¼é–€ç¥¨', u:'https://www.tokyodisneyresort.jp/tc/'},
                {k:'shibuya sky', n:'SHIBUYA SKY é–€ç¥¨', u:'https://www.shibuya-scramble-square.com/sky/ticket/'},
                {k:'warner', n:'å“ˆåˆ©æ³¢ç‰¹å½±åŸ', u:'https://www.wbstudiotour.jp/en/tickets/'},
                {k:'skytree', n:'æ™´ç©ºå¡”é–€ç¥¨', u:'https://www.tokyo-skytree.jp/tcn/ticket/'},
                {k:'teamlab', n:'TeamLab Planets', u:'https://planets.teamlab.art/tokyo/zh-hant/'}
            ];
            rules.forEach(r => {
                if(fullText.includes(r.k) && !suggestedTickets.value.some(t => t.name === r.n)) {
                    suggestedTickets.value.push({name: r.n, url: r.u, custom: false});
                }
            });
        };
        watch(itinerary, autoScanTickets, {deep:true});

        // Weather Logic
        const fetchRealTimeWeather = async () => {
            try {
                const url = "https://api.open-meteo.com/v1/forecast?latitude=35.6895,35.3197,35.3606&longitude=139.6917,139.5467,138.7274&current_weather=true&timezone=Asia%2FTokyo";
                const res = await fetch(url);
                const data = await res.json();
                const mapWeatherCode = (code) => { if (code <= 1) return 'æ™´æœ—'; if (code <= 3) return 'å¤šé›²'; if (code <= 48) return 'èµ·éœ§'; if (code <= 67) return 'æœ‰é›¨'; if (code <= 77) return 'é™é›ª'; return 'é™°å¤©'; };
                const mapBg = (code) => { if (code <= 1) return 'bg-orange-400'; if (code <= 3) return 'bg-blue-400'; if (code >= 51) return 'bg-gray-500'; return 'bg-blue-400'; }
                if(data && data.length === 3) {
                     weatherData.value = [
                        {name:'Tokyo', temp: data[0].current_weather.temperature, desc: mapWeatherCode(data[0].current_weather.weathercode), bg: mapBg(data[0].current_weather.weathercode)},
                        {name:'Kamakura', temp: data[1].current_weather.temperature, desc: mapWeatherCode(data[1].current_weather.weathercode), bg: mapBg(data[1].current_weather.weathercode)},
                        {name:'Fuji', temp: data[2].current_weather.temperature, desc: mapWeatherCode(data[2].current_weather.weathercode), bg: mapBg(data[2].current_weather.weathercode)}
                     ];
                }
            } catch (e) {
                console.error("Weather Fetch Error", e);
                weatherData.value = [{name:'Tokyo',temp:'--',bg:'bg-gray-400',desc:'é›¢ç·š'},{name:'Kamakura',temp:'--',bg:'bg-gray-400',desc:'é›¢ç·š'},{name:'Fuji',temp:'--',bg:'bg-gray-400',desc:'é›¢ç·š'}];
            }
        };

        const compressImage = (base64) => { return new Promise((resolve) => { const img = new Image(); img.src = base64; img.onload = () => { const canvas = document.createElement('canvas'); let width = img.width; let height = img.height; const MAX_SIZE = 800; if (width > MAX_SIZE) { height *= MAX_SIZE / width; width = MAX_SIZE; } canvas.width = width; canvas.height = height; const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, width, height); let q = 0.7; let result = canvas.toDataURL('image/jpeg', q); while(result.length > 200000 && q > 0.3) { q -= 0.1; result = canvas.toDataURL('image/jpeg', q); } resolve(result); }; }); };

        const getCurrentItinerary = () => (itineraryMode.value === 'drive' && [2,3].includes(selectedDayIndex.value)) ? (drivePlan.value[selectedDayIndex.value-2] || []) : (itinerary.value[selectedDayIndex.value] || []);
        const getIconByCategory = (cat) => ({'Flight':'fa-solid fa-plane','Sightseeing':'fa-solid fa-camera','Food':'fa-solid fa-utensils','Shopping':'fa-solid fa-bag-shopping','Transport':'fa-solid fa-train-subway','Hotel':'fa-solid fa-bed'}[cat]||'fa-solid fa-location-dot');
        const getMapLink = (k,n) => { let q = k || n; if(!q) return ''; if(q.startsWith('http')) return q; return `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`; };
        const getSearchLink = (n) => `https://www.google.com/search?q=${encodeURIComponent(n)}`;
        const getImg = (p) => p.startsWith('data:')?p:`https://raw.githubusercontent.com/sunny5200820-maker/2026.tokyo.fuji.trip/main/${p}`;
        const handleImgError = (e) => e.target.src='https://placehold.co/400x300/pink/white?text=IMAGE';
        const getPageTitle = (view) => ({'itinerary':'è¡Œç¨‹è¡¨','money':'å°è²¡åº«','hotel':'ä½å®¿äº¤é€š','prep':'è¡Œå‰æº–å‚™','food':'ç¾é£Ÿåœ°åœ–','photo':'æ‰“å¡æ™¯é»','shopping':'è³¼ç‰©æ¸…å–®','weather':'å³æ™‚å¤©æ°£','japanese':'ç¿»è­¯è’Ÿè’»'}[view]||'é—œæ±ä¹‹æ—…');
        const isUserOnline = (id) => { const u = users.value.find(user => user.id === id); return u && u.lastActive && (Date.now() - u.lastActive) < 65000; };
        const onlineUsersList = computed(() => users.value.filter(u => isUserOnline(u.id)));
        const getUserName = (id) => users.value.find(u=>u.id===id)?.name||'æœªçŸ¥';
        const getClothingAdvice = (t) => t<10?'ç¾½çµ¨+åœå·¾':t<15?'å¤§è¡£+ç™¼ç†±è¡£':t<20?'è–„å¤–å¥—+é•·è¢–':'æ´‹è”¥å¼ç©¿æ­';
        const getPaymentIcon = (m) => ({'cash':'ğŸ’µ','card':'ğŸ’³','suica':'ğŸ§','other':'ğŸ”–'}[m]||'ğŸ’µ');
        const flightStatusLink = (code) => code ? `https://www.flightradar24.com/data/flights/${code.toLowerCase()}` : '';
        const getAirlineInfo = (flightCode, isShort) => { if(!flightCode) return null; const c = flightCode.toUpperCase(); if(c.startsWith('TR')) return isShort?"é…·èˆª Scoot":"ã€é…·èˆª Scootã€‘\nğŸ“ å ±åˆ°ï¼šæ¡ƒåœ’ T1 / æˆç”° T1 å—ç¿¼\nğŸ§³ æ‰‹æï¼š10kg (åš´æ ¼ç§¤é‡)"; if(c.startsWith('BR')) return isShort?"é•·æ¦® EVA":"ã€é•·æ¦® EVAã€‘\nğŸ“ å ±åˆ°ï¼šæ¡ƒåœ’ T2 / æˆç”° T1 å—ç¿¼\nğŸ§³ è¨—é‹ï¼šè¨ˆä»¶åˆ¶ 23kg x 2 ä»¶"; return 'è«‹ç¢ºèªé›»å­æ©Ÿç¥¨ä¸Šçš„èˆªå»ˆè³‡è¨Š'; };
        const getDirLink = (dest) => { const list = getCurrentItinerary(); let origin = list.length > 0 ? list[list.length-1].mapKeyword || list[list.length-1].name : ""; return `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(origin)}&destination=${encodeURIComponent(dest)}&travelmode=transit`; };
        const getAmountInTWD = (e) => e.currency==='JPY' ? e.amount*exchangeRate.value : e.amount;
        const myPrivateExpenses = computed(() => currentUser.value ? expenses.value.filter(e => e.whoPaid===currentUser.value.id && e.forWhom.length===1 && e.forWhom[0]===currentUser.value.id) : []);
        const myPrivateTotalTWD = computed(() => myPrivateExpenses.value.reduce((sum, e) => sum + getAmountInTWD(e), 0));
        const groupExpenses = computed(() => expenses.value.filter(e => e.forWhom.length > 1 || (e.forWhom.length===1 && e.forWhom[0]!==e.whoPaid)));
        const settlements = computed(() => { const b={}; users.value.forEach(u=>b[u.id]=0); groupExpenses.value.forEach(e=>{ const t=getAmountInTWD(e); b[e.whoPaid]+=t; const s=t/e.forWhom.length; e.forWhom.forEach(i=>b[i]-=s); }); const r=[]; const n=users.value.map(u=>({id:u.id,v:b[u.id]})); const d=n.filter(x=>x.v<-1).sort((x,y)=>x.v-y.v); const c=n.filter(x=>x.v>1).sort((x,y)=>y.v-x.v); let i=0,j=0; while(i<d.length&&j<c.length){ let a=Math.min(-d[i].v,c[j].v); r.push({from:d[i].id,to:c[j].id,amount:Math.round(a)}); d[i].v+=a; c[j].v-=a; if(Math.abs(d[i].v)<1)i++; if(Math.abs(c[j].v)<1)j++; } return r; });

        // ğŸ”¥ V43.0 Serializer Engine - The Fix for "Nested arrays are not supported"
        let saveTimeout = null;
        
        const saveData = async () => { 
            if(isGuest.value) return;
            isSaving.value = 'saving';
            clearTimeout(saveTimeout);
            
            if(currentUser.value) {
                const idx = users.value.findIndex(u => u.id === currentUser.value.id);
                if(idx !== -1) users.value[idx].lastActive = Date.now();
            }

            saveTimeout = setTimeout(async () => {
                // SERIALIZE Nested Arrays to JSON Strings before saving to Firestore
                const payload = { 
                    users:users.value, 
                    itinerary: JSON.stringify(itinerary.value), // ğŸŸ¢ Serialize
                    drivePlan: JSON.stringify(drivePlan.value), // ğŸŸ¢ Serialize
                    expenses:expenses.value, spots:spots.value, 
                    shopping:shopping.value, phrases:japanesePhrases.value, 
                    tickets:suggestedTickets.value, transportTickets:transportTickets.value, rentalCars:rentalCars.value,
                    hotels:hotels.value, coupons:coupons.value,
                    _lastModified: Date.now()
                };
                
                try {
                    const localBackup = JSON.stringify(defaultData); // Save raw data locally
                    localStorage.setItem('V43_DATA', JSON.stringify({
                        ...payload,
                        itinerary: itinerary.value, // Keep raw for local
                        drivePlan: drivePlan.value  // Keep raw for local
                    }));
                    
                    if(db && isLoggedIn.value) {
                        await setDoc(doc(db,"trips","kanto2026"), payload, {merge:true}); 
                        isSaving.value = 'synced';
                        logSync("Saved (Serialized)");
                    } else {
                        isSaving.value = 'error';
                        logSync("Offline save");
                    }
                } catch(e) { console.error(e); isSaving.value = 'error'; logSync("Error: " + e.message); }
            }, 500); 
        };

        const logSync = (msg) => {
            syncLog.value.unshift(`${new Date().toLocaleTimeString()}: ${msg}`);
            if(syncLog.value.length > 10) syncLog.value.pop();
        };

        const showDiagnostic = () => {
             const status = isLoggedIn.value ? 'ğŸŸ¢ Online' : 'ğŸ”´ Offline';
             const log = syncLog.value.join('\n');
             // V43 Check Serialization
             const check = Array.isArray(itinerary.value[0]) ? "Array (OK)" : "String (Error)";
             alert(`ã€V43.0 é³³å‡°è¨ºæ–·ç³»çµ±ã€‘\n\nç‹€æ…‹ï¼š${status}\nåŒæ­¥ï¼š${isSaving.value}\nè³‡æ–™çµæ§‹ï¼š${check}\n\næœ€è¿‘æ—¥èªŒï¼š\n${log}`);
        };
        const statusColor = computed(() => isSaving.value === 'saving' ? 'bg-yellow-400 animate-pulse' : isSaving.value === 'error' ? 'bg-red-500' : 'bg-green-400');
        const statusText = computed(() => isSaving.value === 'saving' ? 'Sync...' : isSaving.value === 'error' ? 'Error' : 'Online');

        const setCurrentUser = (u) => { 
            if(isGuest.value) return; 
            currentUser.value = u; 
            const idx = users.value.findIndex(user => user.id === u.id);
            if(idx !== -1) users.value[idx].lastActive = Date.now();
            saveData();
            localStorage.setItem('V43_LAST_USER_ID', u.id);
            showPersonaModal.value = false; currentView.value = 'menu'; 
        };
        const addPrepItem = (u) => { u.list.push({text:'æ–°é …ç›®',checked:false}); saveData(); };
        const enterSite = () => { isGuest.value=false; isWelcomeClosed.value=true; showPersonaModal.value=true; };
        const enterAsGuest = () => { isGuest.value=true; currentUser.value={id:999,name:'è¨ªå®¢',list:[]}; isWelcomeClosed.value=true; currentView.value='menu'; };
        const handleAuthClick = () => isLoggedIn.value ? (confirm('ç™»å‡º?')&&signOut(auth)) : showLoginModal.value=true;
        const doLogin = async () => { try{await setPersistence(auth, browserLocalPersistence); await signInWithEmailAndPassword(auth,loginForm.value.email,loginForm.value.password);showLoginModal.value=false;}catch(e){alert('ç™»å…¥å¤±æ•—');} };
        const openUserEditor = (u) => { editingUser.value={...u}; showUserEditModal.value=true; };
        const saveUserChanges = () => { if(isGuest.value) return; const idx=users.value.findIndex(u=>u.id===editingUser.value.id); if(idx!==-1){ users.value[idx]={...editingUser.value}; if(currentUser.value && currentUser.value.id === editingUser.value.id) currentUser.value = users.value[idx]; } saveData(); showUserEditModal.value=false; };
        const processAvatarUpload = async (e) => { const f = e.target.files[0]; if(f) { const res = await new Promise(r=>{const fr=new FileReader();fr.onload=ev=>r(ev.target.result);fr.readAsDataURL(f);}); editingUser.value.avatar = await compressImage(res); } };

        // Modal Helpers
        const openEditItineraryModal = (item, idx) => {
            if(isGuest.value) return;
            modalTitle.value = 'ç·¨è¼¯è¡Œç¨‹'; modalFields.value = [{key:'hours',label:'æ™‚é–“'},{key:'name',label:'åç¨±'},{key:'note',label:'å‚™è¨»'},{key:'mapKeyword',label:'åœ°åœ–é—œéµå­—'},{key:'travelTime',label:'äº¤é€šæ™‚é–“'},{key:'parkingLink',label:'åœè»Šå ´åœ°åœ– (è‡ªé§•ç”¨)'}];
            modalData.value = {...item}; modalHasImg.value=false; isEditingItem.value = true;
            const targetArray = (itineraryMode.value === 'drive' && [2,3].includes(selectedDayIndex.value)) ? drivePlan.value[selectedDayIndex.value-2] : itinerary.value[selectedDayIndex.value];
            modalCallback.value = () => { targetArray[idx] = modalData.value; targetArray.sort((a,b) => a.hours.localeCompare(b.hours)); saveData(); };
            modalDeleteCallback.value = () => { targetArray.splice(idx, 1); saveData(); };
            showModal.value = true;
        };
        const openAddItineraryModal = () => {
             modalTitle.value = 'æ–°å¢è¡Œç¨‹'; modalFields.value = [{key:'hours',label:'æ™‚é–“'},{key:'name',label:'åç¨±'},{key:'note',label:'å‚™è¨»'},{key:'mapKeyword',label:'åœ°åœ–é—œéµå­—'},{key:'travelTime',label:'äº¤é€šæ™‚é–“'},{key:'parkingLink',label:'åœè»Šå ´åœ°åœ– (è‡ªé§•ç”¨)'}];
             modalData.value = {hours:'',name:'',note:'',category:'Sightseeing'}; modalHasImg.value=false; isEditingItem.value = false;
             modalCallback.value = () => { const arr = (itineraryMode.value === 'drive' && [2,3].includes(selectedDayIndex.value)) ? drivePlan.value[selectedDayIndex.value-2] : itinerary.value[selectedDayIndex.value]; arr.push(modalData.value); arr.sort((a,b) => a.hours.localeCompare(b.hours)); saveData(); };
             showModal.value = true;
        };
        const openEditModal = (type, item, idx) => {
            if(isGuest.value) return;
            modalTitle.value = 'ç·¨è¼¯'; modalData.value = {...item}; modalHasImg.value=true; isEditingItem.value = true;
            if(type === 'shopping') {
                modalFields.value=[{key:'name',label:'åç¨±'},{key:'link',label:'é€£çµ'}];
                modalCallback.value = () => { shopping.value[shopCat.value][idx] = modalData.value; saveData(); };
                modalDeleteCallback.value = () => { shopping.value[shopCat.value].splice(idx, 1); saveData(); };
            } else if (type === 'spot') {
                modalFields.value=[{key:'name',label:'åç¨±'},{key:'desc',label:'æè¿°'},{key:'link',label:'åœ°åœ–é—œéµå­—'}];
                modalCallback.value = () => { spots.value.photo[currentLoc.value][idx] = modalData.value; saveData(); };
                modalDeleteCallback.value = () => { spots.value.photo[currentLoc.value].splice(idx, 1); saveData(); };
            } else if (type === 'food') {
                modalFields.value=[{key:'name',label:'åç¨±',onInput:autoFillFoodInfo},{key:'desc',label:'æè¿°'},{key:'reserve',label:'éœ€è¨‚ä½?',type:'checkbox'},{key:'reserveLink',label:'é ç´„é€£çµ'},{key:'note',label:'ç­†è¨˜',type:'textarea'},{key:'link',label:'åœ°åœ–é—œéµå­—'}];
                modalCallback.value = () => { spots.value.food[currentLoc.value][idx] = modalData.value; saveData(); };
                modalDeleteCallback.value = () => { spots.value.food[currentLoc.value].splice(idx, 1); saveData(); };
            }
            showModal.value=true;
        };
        const openAddShopModal = () => { modalTitle.value='æ–°å¢å•†å“'; modalFields.value=[{key:'name',label:'åç¨±'},{key:'link',label:'é€£çµ'}]; modalData.value={name:'',link:'',img:''}; modalHasImg.value=true; isEditingItem.value=false; modalCallback.value = () => { shopping.value[shopCat.value].push(modalData.value); saveData(); }; showModal.value=true; };
        const openAddSpotModal = () => { modalTitle.value='æ–°å¢æ™¯é»'; modalFields.value=[{key:'name',label:'åç¨±'},{key:'desc',label:'æè¿°'},{key:'link',label:'åœ°åœ–é—œéµå­—'}]; modalData.value={name:'',desc:'',link:'',img:''}; modalHasImg.value=true; isEditingItem.value=false; modalCallback.value=()=>{spots.value.photo[currentLoc.value].push(modalData.value); saveData();}; showModal.value=true; };
        const openAddFoodModal = () => { modalTitle.value='æ–°å¢ç¾é£Ÿ'; modalFields.value=[{key:'name',label:'é¤å»³åç¨±', onInput: autoFillFoodInfo},{key:'desc',label:'æè¿°'},{key:'reserve',label:'éœ€è¦è¨‚ä½?', type:'checkbox'},{key:'reserveLink',label:'é ç´„é€£çµ'},{key:'note',label:'ç­†è¨˜', type:'textarea'},{key:'link',label:'åœ°åœ–é—œéµå­—'}]; modalData.value={name:'',desc:'',reserve:false,reserveLink:'',note:'',link:'',img:''}; modalHasImg.value=true; isEditingItem.value=false; modalCallback.value=()=>{ if(!modalData.value.note) autoFillFoodInfo(); spots.value.food[currentLoc.value].push(modalData.value); saveData(); }; showModal.value=true; };
        const openAddCouponModal = () => { modalTitle.value='æ–°å¢å„ªæƒ åˆ¸'; modalFields.value=[{key:'name',label:'åº—å®¶åç¨±'},{key:'discount',label:'æŠ˜æ‰£å…§å®¹'},{key:'link',label:'é€£çµ'},{key:'note',label:'å‚™è¨»'}]; modalData.value={name:'',discount:'',link:'',note:''}; modalHasImg.value=false; modalCallback.value = () => { coupons.value.push(modalData.value); saveData(); }; showModal.value=true; };
        const openEditHotelModal = (h, idx) => { if(isGuest.value) return; modalTitle.value = 'ç·¨è¼¯ä½å®¿'; modalFields.value = [{key:'name',label:'åç¨±'},{key:'link',label:'åœ°åœ–é—œéµå­—'}]; modalData.value = {...h}; modalHasImg.value = true; isEditingItem.value = false; modalCallback.value = () => { hotels.value[idx] = modalData.value; saveData(); }; showModal.value = true; };
        const openAddTicketModal = () => { modalTitle.value='æ–°å¢é–€ç¥¨'; modalFields.value=[{key:'name',label:'æ™¯é»åç¨±'},{key:'url',label:'è³¼ç¥¨é€£çµ'}]; modalData.value={name:'',url:'https://', custom:true}; modalHasImg.value=false; isEditingItem.value=false; modalCallback.value=()=>{suggestedTickets.value.push(modalData.value); saveData();}; showModal.value=true; };
        const openAddTransTicketModal = () => { modalTitle.value='æ–°å¢äº¤é€šç¥¨åˆ¸'; modalFields.value=[{key:'name',label:'ç¥¨åˆ¸åç¨±'},{key:'url',label:'è³‡è¨Šé€£çµ'},{key:'note',label:'æ³¨æ„äº‹é …', type:'textarea'}]; modalData.value={name:'',url:'https://', note:'', icon:'fa-solid fa-ticket', custom:true, type:''}; modalHasImg.value=false; isEditingItem.value=false; modalCallback.value=()=>{transportTickets.value.push(modalData.value); saveData();}; showModal.value=true; };
        const openAddCarModal = () => { modalTitle.value = 'æ–°å¢ç§Ÿè»Šé ç´„'; modalFields.value = [{key:'company',label:'ç§Ÿè»Šå…¬å¸'},{key:'pickup',label:'å–è»Šåœ°é»'},{key:'url',label:'é ç´„é€£çµ'},{key:'note',label:'å‚™è¨»'}]; modalData.value = {company:'', pickup:'', url:'', note:'', status:'todo', reservationNumber:'', insurance:''}; modalHasImg.value = false; isEditingItem.value = false; modalCallback.value = () => { rentalCars.value.push(modalData.value); saveData(); }; showModal.value = true; };
        const openAddPhraseModal = () => { modalTitle.value='æ–°å¢ç¿»è­¯'; modalFields.value=[{key:'zh',label:'ä¸­æ–‡'},{key:'jp',label:'æ—¥æ–‡'}]; modalData.value={zh:'',jp:''}; modalHasImg.value=false; isEditingItem.value=false; modalCallback.value=()=>{japanesePhrases.value.push(modalData.value); saveData();}; showModal.value=true; };

        const handleModalSave = () => { if(modalCallback.value) modalCallback.value(); showModal.value=false; };
        const handleModalDelete = () => { if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ') && modalDeleteCallback.value) { modalDeleteCallback.value(); showModal.value=false; } };
        const processModalImg = async (e) => { const f = e.target.files[0]; if(f) { const res = await new Promise(r=>{const fr=new FileReader();fr.onload=ev=>r(ev.target.result);fr.readAsDataURL(f);}); modalData.value.img = await compressImage(res); } };
        
        const openExpenseModal = (mode) => { expenseMode.value = mode; modalData.value={name:'', amount:'', currency:'JPY', method:'cash', whoPaid: currentUser.value.id, forWhom: mode==='private' ? [currentUser.value.id] : users.value.map(u=>u.id)}; showExpenseModal.value=true; };
        const toggleShare = (id) => { const i=modalData.value.forWhom.indexOf(id); i>-1?modalData.value.forWhom.splice(i,1):modalData.value.forWhom.push(id); };
        const saveExpense = () => { expenses.value.push({...modalData.value,id:Date.now(),date:new Date().toLocaleDateString()}); saveData(); showExpenseModal.value=false; };
        const deleteExpense = (id) => { if(isGuest.value) return; if(confirm('ç¢ºå®šåˆªé™¤?')){expenses.value=expenses.value.filter(e=>e.id!==id); saveData();} };
        const deleteCar = (idx) => { if(confirm('ç¢ºå®šåˆªé™¤ï¼Ÿ')) { rentalCars.value.splice(idx,1); saveData(); } };
        const openRentalDetail = (car, idx) => { activeRental.value = rentalCars.value[idx]; showRentalModal.value = true; };
        const updateRentalStatus = (status) => { activeRental.value.status = status; };
        const editFlight = (mode) => { if(isGuest.value) return; flightMode.value = mode; tempFlightData.value.code = mode==='out' ? (currentUser.value.flightOut||'') : (currentUser.value.flightIn||''); tempFlightData.value.seat = mode==='out' ? (currentUser.value.flightOutSeat||'') : (currentUser.value.flightInSeat||''); showFlightModal.value = true; };
        const saveFlight = () => { if(flightMode.value === 'out') { currentUser.value.flightOut = tempFlightData.value.code; currentUser.value.flightOutSeat = tempFlightData.value.seat; } else { currentUser.value.flightIn = tempFlightData.value.code; currentUser.value.flightInSeat = tempFlightData.value.seat; } const idx = users.value.findIndex(u=>u.id===currentUser.value.id); if(idx!==-1) users.value[idx] = currentUser.value; saveData(); showFlightModal.value = false; };
        
        const autoFillFoodInfo = () => { const name = modalData.value.name; if(!name) return; const n = name.toLowerCase(); if(n.includes('å™å™è‹‘')) { modalData.value.reserve=true; modalData.value.reserveLink='https://www.tablecheck.com/zh-TW/shops/jojoen-tokyoskytreetown-solamachi/reserve'; modalData.value.note='ã€éœ€è¨‚ä½ã€‘åˆé–“å¥—é¤CPå€¼æœ€é«˜ã€‚'; } else if(n.includes('harbs')) { modalData.value.reserve=false; modalData.value.note='ã€ç¾å ´æ’éšŠã€‘æ°´æœåƒå±¤å¿…é»ã€‚'; } };
        const applyTicketTemplate = () => { const t = modalData.value.type; if(t==='suica') { modalData.value.name='Suica è¥¿ç“œå¡'; modalData.value.icon='fa-solid fa-mobile-screen'; modalData.value.url='https://www.jreast.co.jp/tc/pass/suica.html'; } };
        const speakJapanese = (text) => { const u = new SpeechSynthesisUtterance(text); u.lang = 'ja-JP'; window.speechSynthesis.speak(u); };
        const openGoogleTranslate = (text) => { window.open(`https://translate.google.com/?sl=zh-TW&tl=ja&text=${encodeURIComponent(text)}&op=translate`, '_blank'); };
        const handleCameraTranslate = () => { window.open('https://translate.google.com/?sl=auto&tl=zh-TW&op=images', '_blank'); };
        const expandCard = (p) => expandedPhrase.value=p;
        const initSakura = () => { const container = document.getElementById('sakura-container'); if(!container) return; setInterval(() => { const petal = document.createElement('div'); petal.className = 'sakura'; petal.style.left = Math.random() * 100 + 'vw'; petal.style.animationDuration = Math.random() * 3 + 2 + 's'; petal.style.opacity = Math.random(); container.appendChild(petal); setTimeout(() => petal.remove(), 5000); }, 400); };
        
        onMounted(() => {
            initSakura();
            fetchRealTimeWeather(); 

            if(auth) onAuthStateChanged(auth, u=>{ 
                isLoggedIn.value=!!u; 
                if(u && db) onSnapshot(doc(db,"trips","kanto2026"), d=>{
                    if(d.exists()){
                        const dt = d.data();
                        
                        // ğŸ”¥ V43.0 Deserializer Engine - Parse nested arrays back
                        if(dt.users) users.value = dt.users;
                        
                        // CHECK IF STRING OR ARRAY
                        if(dt.itinerary) {
                            itinerary.value = typeof dt.itinerary === 'string' ? JSON.parse(dt.itinerary) : dt.itinerary;
                        }
                        if(dt.drivePlan) {
                            drivePlan.value = typeof dt.drivePlan === 'string' ? JSON.parse(dt.drivePlan) : dt.drivePlan;
                        }
                        
                        if(dt.expenses) expenses.value = dt.expenses;
                        if(dt.spots) spots.value = dt.spots;
                        if(dt.shopping) shopping.value = dt.shopping;
                        if(dt.coupons) coupons.value = dt.coupons;
                        if(dt.phrases) japanesePhrases.value = dt.phrases;
                        if(dt.tickets) suggestedTickets.value = dt.tickets;
                        if(dt.transportTickets) transportTickets.value = dt.transportTickets;
                        if(dt.rentalCars) rentalCars.value = dt.rentalCars;
                        if(dt.hotels) hotels.value = dt.hotels;
                        
                        if(currentUser.value) {
                             const fresh = users.value.find(u => u.id === currentUser.value.id);
                             if(fresh) currentUser.value = fresh;
                        }
                        logSync("Received update");
                    }
                });
            });
            
            setInterval(() => { if(isLoggedIn.value && !isGuest.value) saveData(); }, 60000);
            
            const l = localStorage.getItem('V43_DATA');
            if(l && !isLoggedIn.value) { try { const d = JSON.parse(l); Object.assign(defaultData, d); } catch(e){} }
            const lastId = localStorage.getItem('V43_LAST_USER_ID');
            if(lastId) { const u = users.value.find(user => user.id === parseInt(lastId)); if(u) setCurrentUser(u); }
        });

        return {
            users, currentView, isWelcomeClosed, enterSite, enterAsGuest, isGuest, apps, getPageTitle,
            daysUntilTrip, smartReminders, tripDays, selectedDayIndex, getCurrentItinerary,
            moneyTab, exchangeRate, myPrivateExpenses, myPrivateTotalTWD, groupExpenses, settlements, getUserName, openExpenseModal, showExpenseModal, modalData, toggleShare, saveExpense, deleteExpense, expenseMode, getPaymentIcon,
            hotelTab, shopCat, shopping, openAddShopModal, currentLoc, spots, openAddSpotModal, weatherData, getClothingAdvice, japanesePhrases, expandCard, expandedPhrase, openAddPhraseModal,
            showModal, modalTitle, modalFields, modalHasImg, handleModalSave, handleModalDelete, isEditingItem, processModalImg, getIconByCategory, getMapLink, getSearchLink, getImg, handleImgError, saveData,
            currentUser, showPersonaModal, setCurrentUser, openUserEditor, showUserEditModal, editingUser, saveUserChanges, processAvatarUpload,
            addPrepItem, openEditModal, showFlightModal, tempFlightData, editFlight, saveFlight, flightMode, speakJapanese,
            handleAuthClick, showLoginModal, loginForm, doLogin, isLoggedIn, itineraryMode, suggestedTickets, openAddTicketModal,
            isSaving, openAddItineraryModal, openEditItineraryModal, openGoogleTranslate,
            transportTickets, openAddTransTicketModal, getAirlineInfo, flightStatusLink, getDirLink, applyTicketTemplate,
            rentalCars, openAddCarModal, deleteCar, openAddFoodModal, autoFillFoodInfo,
            coupons, showCouponModal, handleCameraTranslate, hotels, openEditHotelModal, 
            toggleCarStatus: updateRentalStatus, showRentalModal, activeRental, openRentalDetail, updateRentalStatus, 
            isUserOnline, showDiagnostic, openAddCouponModal,
            statusColor, statusText, onlineUsersList, isCouponMinimized
        };
    }
}).mount('#app');
</script>
</body>
</html>
