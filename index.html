<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é—œæ±8æ—¥å¥³å­æ—… | å‰ä¼Šå¡å“‡é¢¨ V6.0</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'chii-pink': '#FFD1DC',
                        'chii-blue': '#A2D2FF',
                        'chii-yellow': '#FFF5BA',
                        'chii-text': '#5D5D5D',
                    },
                    fontFamily: {
                        sans: ['Zen Maru Gothic', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-slow': 'bounce 3s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #FFF5F7; 
            font-family: 'Zen Maru Gothic', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Banner */
        .banner-container {
            height: 220px;
            background-image: url('./banner.jpg');
            background-size: cover;
            background-position: center;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            position: relative;
            box-shadow: 0 4px 20px rgba(255, 209, 220, 0.4);
            margin-bottom: 20px;
        }
        .banner-fallback {
            background: linear-gradient(135deg, #A2D2FF 0%, #FFD1DC 100%);
        }

        /* App Grid Icons */
        .app-icon {
            width: 65px;
            height: 65px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.1s;
            margin-bottom: 6px;
        }
        .app-icon:active { transform: scale(0.9); }
        .app-label { font-size: 12px; font-weight: bold; color: #5D5D5D; text-align: center; line-height: 1.2; }

        .card {
            background: white;
            border-radius: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            transition: all 0.2s;
        }

        /* Weather Card */
        .weather-card {
            background: linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%);
            color: white;
        }

        [v-cloak] { display: none; }
    </style>
</head>
<body>

<div id="app">
    <div v-if="!isMounted" class="fixed inset-0 flex flex-col items-center justify-center bg-white z-50">
        <i class="fa-solid fa-spinner fa-spin text-4xl text-chii-pink mb-4"></i>
        <div class="text-chii-text font-bold">è¼‰å…¥ç¾å¥½æ—…ç¨‹ V6.0...</div>
    </div>

    <div v-if="isMounted" v-cloak class="min-h-screen pb-24 relative z-10">
        
        <div v-if="currentView !== 'home'" class="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-sm z-40 px-4 py-3 flex justify-between items-center shadow-sm h-14">
            <button @click="goHome" class="w-8 h-8 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center hover:bg-chii-pink hover:text-white transition">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <h1 class="font-bold text-gray-700">{{ getPageTitle(currentView) }}</h1>
            <div class="w-8"></div> </div>
        <div v-if="currentView !== 'home'" class="h-16"></div>

        <div v-if="currentView === 'home'" class="animate-fade-in">
            <div class="banner-container" :class="{'banner-fallback': !hasBanner}">
                <div class="absolute inset-0 bg-black/10 rounded-b-[30px]"></div>
                <div class="absolute bottom-6 left-6 text-white">
                    <div class="text-xs opacity-90 mb-1 tracking-widest">TOKYO TRIP</div>
                    <h1 class="text-3xl font-black drop-shadow-md">é—œæ±å¥³å­æ—… V6 ğŸŒ¸</h1>
                    <div class="mt-2 text-sm bg-white/20 backdrop-blur-md px-3 py-1 rounded-full inline-block">
                        <i class="fa-solid fa-car mr-1"></i>8å¤©7å¤œå®Œæ•´ç‰ˆ
                    </div>
                </div>
                <button @click="resetData" class="absolute top-4 right-4 bg-red-400/80 backdrop-blur text-white px-3 py-1 rounded-full text-xs font-bold shadow-sm">
                    <i class="fa-solid fa-rotate-right mr-1"></i>é‡ç½®
                </button>
            </div>

            <div class="px-5 grid grid-cols-4 gap-y-6 gap-x-2 mb-8">
                <div v-for="app in apps" :key="app.id" class="flex flex-col items-center cursor-pointer group" @click="currentView = app.view">
                    <div class="app-icon" :class="app.color">
                        <i :class="app.icon"></i>
                    </div>
                    <span class="app-label group-hover:text-chii-pink transition">{{ app.name }}</span>
                </div>
            </div>

            <div class="px-4">
                <div @click="currentView = 'weather'" class="weather-card rounded-2xl p-4 relative overflow-hidden shadow-lg cursor-pointer">
                    <div class="flex justify-between items-center relative z-10">
                        <div>
                            <div class="text-sm font-bold opacity-90"><i class="fa-solid fa-location-dot mr-1"></i>ä»Šæ—¥å¯Œå£«å±±</div>
                            <div class="text-3xl font-bold mt-1">{{ fujiWeather.temp }}Â°C</div>
                            <div class="text-xs mt-1">èƒ½è¦‹åº¦: {{ fujiWeather.visibility }}%</div>
                        </div>
                        <div class="text-right">
                            <div class="text-4xl animate-float">{{ fujiWeather.icon }}</div>
                            <div class="text-xs mt-1">{{ fujiWeather.desc }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'itinerary'" class="px-4">
            <div class="flex overflow-x-auto hide-scrollbar gap-2 mb-4 pb-2 sticky top-16 bg-white/95 backdrop-blur py-2 z-30">
                <button v-for="(day, index) in tripDays" :key="index" 
                    @click="selectedDayIndex = index"
                    :class="['flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold transition border', 
                            selectedDayIndex === index ? 'bg-chii-pink text-white border-chii-pink shadow-md' : 'bg-white text-gray-400 border-gray-100']">
                    {{ day.week }}<br><span class="text-xs font-normal">{{ day.title }}</span>
                </button>
            </div>

            <div class="space-y-4">
                <div v-for="(item, idx) in currentDayItinerary" :key="item.id" class="card p-4 relative border-l-[6px]" :class="getBorderColor(item.category)">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-xs font-bold px-2 py-0.5 rounded text-white" :class="getCategoryColor(item.category)">{{ getCategoryName(item.category) }}</span>
                                <span class="text-xs text-gray-400 font-mono"><i class="fa-regular fa-clock mr-1"></i>{{ item.hours }}</span>
                            </div>
                            <h3 class="font-bold text-gray-800 text-lg">
                                {{ item.name }}
                                <a :href="getMapLink(item.mapKeyword)" target="_blank" class="ml-1 text-blue-400 hover:text-blue-600"><i class="fa-solid fa-location-arrow"></i></a>
                            </h3>
                            <p class="text-sm text-gray-500 mt-2 leading-relaxed bg-gray-50 p-2 rounded-lg">{{ item.note }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'hotel'" class="px-4">
            <h2 class="text-lg font-bold text-gray-700 mb-4 pl-2 border-l-4 border-pink-400">æœ¬æ¬¡æ—…ç¨‹ä½å®¿</h2>
            <div class="space-y-4">
                <div class="card overflow-hidden">
                    <div class="h-32 bg-gray-200 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1542314831-068cd1dbfeeb?auto=format&fit=crop&w=600&q=80')"></div>
                    <div class="p-4">
                        <span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">Day 1-2</span>
                        <h3 class="font-bold text-lg mt-1">éŒ¦ç³¸ç”º / æ±äº¬å¸‚å€</h3>
                        <p class="text-sm text-gray-500 mb-3">æ–¹ä¾¿å‰å¾€æ™´ç©ºå¡”èˆ‡ç§Ÿè»Šåœ°é»</p>
                        <a href="https://www.google.com/maps/search/éŒ¦ç³¸ç”ºé£¯åº—" target="_blank" class="block text-center bg-blue-50 text-blue-500 py-2 rounded-lg text-sm font-bold">æŸ¥çœ‹è¨‚æˆ¿/åœ°åœ–</a>
                    </div>
                </div>
                <div class="card overflow-hidden">
                    <div class="h-32 bg-gray-200 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1490806843957-31f4c9a91c65?auto=format&fit=crop&w=600&q=80')"></div>
                    <div class="p-4">
                        <span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">Day 3-4</span>
                        <h3 class="font-bold text-lg mt-1">å¯Œå£«å±± / æ²³å£æ¹–å‘¨é‚Š</h3>
                        <p class="text-sm text-gray-500 mb-3">äº«å—æ—©æ™¨é€†å¯Œå£«èˆ‡æº«æ³‰</p>
                        <a href="https://www.google.com/maps/search/æ²³å£æ¹–é£¯åº—" target="_blank" class="block text-center bg-blue-50 text-blue-500 py-2 rounded-lg text-sm font-bold">æŸ¥çœ‹è¨‚æˆ¿/åœ°åœ–</a>
                    </div>
                </div>
                <div class="card overflow-hidden">
                    <div class="h-32 bg-gray-200 bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=600&q=80')"></div>
                    <div class="p-4">
                        <span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">Day 5-7</span>
                        <h3 class="font-bold text-lg mt-1">æ–°å®¿ / æ± è¢‹å‘¨é‚Š</h3>
                        <p class="text-sm text-gray-500 mb-3">äº¤é€šæ¨ç´ï¼Œæ–¹ä¾¿è³¼ç‰©èˆ‡å‰å¾€éŒå€‰</p>
                        <a href="https://www.google.com/maps/search/æ–°å®¿é£¯åº—" target="_blank" class="block text-center bg-blue-50 text-blue-500 py-2 rounded-lg text-sm font-bold">æŸ¥çœ‹è¨‚æˆ¿/åœ°åœ–</a>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'photo'" class="px-4">
            <div class="flex bg-white rounded-xl p-1 mb-4 shadow-sm">
                <button v-for="area in ['Tokyo', 'Kamakura', 'Fuji']" :key="area" 
                    @click="photoArea = area" 
                    :class="['flex-1 py-2 rounded-lg text-sm font-bold transition', photoArea === area ? 'bg-rose-100 text-rose-500' : 'text-gray-400']">
                    {{ {'Tokyo':'æ±äº¬','Kamakura':'éŒå€‰','Fuji':'å¯Œå£«å±±'}[area] }}
                </button>
            </div>
            
            <div class="grid grid-cols-1 gap-4">
                <div v-for="(spot, idx) in photoSpots[photoArea]" :key="idx" class="card p-0 overflow-hidden group">
                    <a :href="getMapLink(spot.name)" target="_blank" class="flex">
                        <div class="w-32 h-28 bg-gray-200 relative flex-shrink-0">
                            <img :src="spot.img" class="w-full h-full object-cover">
                        </div>
                        <div class="p-3 flex flex-col justify-center flex-1">
                            <h3 class="font-bold text-gray-800">{{ spot.name }}</h3>
                            <p class="text-xs text-gray-500 mt-1 line-clamp-2">{{ spot.desc }}</p>
                            <div class="mt-2 text-rose-400 text-xs font-bold flex items-center">
                                <i class="fa-solid fa-location-dot mr-1"></i>å°èˆª
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'prep'" class="px-4">
            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 mb-4 text-sm text-gray-600">
                <h3 class="font-bold text-yellow-600 mb-2"><i class="fa-solid fa-triangle-exclamation mr-1"></i>é‡è¦æé†’</h3>
                <ul class="list-disc list-inside space-y-1">
                    <li>è­·ç…§æ•ˆæœŸéœ€ 6 å€‹æœˆä»¥ä¸Š</li>
                    <li>VJW å…¥å¢ƒæ‰‹çºŒè«‹æˆªåœ–å­˜æ‰‹æ©Ÿ</li>
                    <li>è‡ªé§•å¿…å‚™ï¼šå°ç£é§•ç…§æ­£æœ¬ + æ—¥æ–‡è­¯æœ¬</li>
                    <li>è¡Œå‹•é›»æºä¸èƒ½è¨—é‹ï¼Œè«‹æ”¾éš¨èº«è¡Œæ</li>
                </ul>
            </div>

            <div class="bg-white rounded-2xl shadow-sm p-4 relative">
                <div class="absolute top-0 left-0 w-full h-3 bg-chii-blue opacity-50 rounded-t-2xl"></div>
                <div v-for="(item, idx) in prepList" :key="idx" class="flex items-center gap-3 py-3 border-b border-gray-50 last:border-0">
                    <input type="checkbox" v-model="item.checked" class="w-5 h-5 accent-blue-400 rounded cursor-pointer">
                    <input v-model="item.text" class="flex-1 text-sm bg-transparent outline-none" :class="{'line-through text-gray-300': item.checked}">
                    <button @click="prepList.splice(idx, 1)" class="text-gray-300"><i class="fa-solid fa-xmark"></i></button>
                </div>
            </div>
            <button @click="addPrepItem" class="w-full mt-4 py-3 bg-gray-100 rounded-xl text-gray-500 font-bold border-2 border-dashed border-gray-200 hover:bg-white hover:border-blue-300 transition">+ æ–°å¢æº–å‚™é …ç›®</button>
        </div>

        <div v-if="currentView === 'weather'" class="px-4">
            <div class="space-y-6">
                <div class="card p-5 border-l-4 border-blue-400">
                    <h3 class="font-bold text-gray-700 mb-2">ğŸ—¼ æ±äº¬å¸‚å€</h3>
                    <div class="flex justify-between items-center">
                        <div class="text-4xl">{{ tokyoWeather.icon }}</div>
                        <div class="text-right">
                            <div class="text-3xl font-bold">{{ tokyoWeather.temp }}Â°C</div>
                            <div class="text-sm text-gray-500">{{ tokyoWeather.desc }}</div>
                        </div>
                    </div>
                </div>

                <div class="card p-5 border-l-4 border-teal-400">
                    <h3 class="font-bold text-gray-700 mb-2">ğŸŒŠ éŒå€‰æ±Ÿä¹‹å³¶</h3>
                    <div class="flex justify-between items-center">
                        <div class="text-4xl">{{ kamakuraWeather.icon }}</div>
                        <div class="text-right">
                            <div class="text-3xl font-bold">{{ kamakuraWeather.temp }}Â°C</div>
                            <div class="text-sm text-gray-500">{{ kamakuraWeather.desc }}</div>
                        </div>
                    </div>
                </div>

                <div class="card p-5 border-l-4 border-blue-600 bg-gradient-to-r from-blue-50 to-white">
                    <h3 class="font-bold text-gray-700 mb-2">ğŸ—» å¯Œå£«å±± (æ²³å£æ¹–)</h3>
                    <div class="flex justify-between items-center">
                        <div class="text-4xl">{{ fujiWeather.icon }}</div>
                        <div class="text-right">
                            <div class="text-3xl font-bold">{{ fujiWeather.temp }}Â°C</div>
                            <div class="text-sm text-gray-500">{{ fujiWeather.desc }}</div>
                            <div class="text-sm font-bold text-blue-600 mt-1 bg-white px-2 py-1 rounded shadow-sm inline-block">èƒ½è¦‹åº¦: {{ fujiWeather.visibility }}%</div>
                        </div>
                    </div>
                </div>
                <div class="text-center text-xs text-gray-400 mt-4">*æ•¸æ“šä¾†æº: Open-Meteo å³æ™‚é å ±</div>
            </div>
        </div>

        <div v-if="currentView === 'shopping'" class="px-4">
            <div class="flex bg-white rounded-xl p-1 mb-4 shadow-sm">
                <button v-for="tab in ['wish','ranking','souvenir']" :key="tab" 
                    @click="shopTab = tab" 
                    :class="['flex-1 py-2 rounded-lg text-sm font-bold transition', shopTab === tab ? 'bg-purple-100 text-purple-600' : 'text-gray-400']">
                    {{ {'wish':'é¡˜æœ›æ¸…å–®','ranking':'å¿…è²·æ¦œå–®','souvenir':'ä¼´æ‰‹ç¦®'}[tab] }}
                </button>
            </div>

            <div v-if="shopTab === 'wish'" class="grid grid-cols-2 gap-3">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="card p-3 flex flex-col items-center relative">
                    <button @click="shoppingList.splice(idx, 1)" class="absolute top-2 right-2 w-6 h-6 bg-gray-100 rounded-full text-gray-400 flex items-center justify-center"><i class="fa-solid fa-xmark"></i></button>
                    <div class="w-full h-24 bg-purple-50 rounded-lg mb-2 flex items-center justify-center text-3xl text-purple-200">
                        <i class="fa-solid fa-bag-shopping"></i>
                    </div>
                    <div class="font-bold text-sm text-center w-full truncate">{{ item.name }}</div>
                </div>
                <div @click="addShopItem" class="card p-3 flex flex-col items-center justify-center min-h-[140px] cursor-pointer border-2 border-dashed border-gray-300 hover:border-purple-300">
                    <i class="fa-solid fa-plus text-2xl text-gray-300"></i>
                </div>
            </div>

            <div v-if="shopTab === 'ranking'" class="space-y-4">
                <a href="https://www.cosme.net/bestcosme/" target="_blank" class="block card p-4 flex items-center gap-4 hover:bg-gray-50">
                    <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-green-600 text-xl"><i class="fa-solid fa-crown"></i></div>
                    <div>
                        <h3 class="font-bold text-lg">@cosme å¤§è³</h3>
                        <p class="text-xs text-gray-500">æ—¥æœ¬å…¬ä¿¡åŠ›ç¬¬ä¸€ç¾å¦æ’è¡Œ</p>
                    </div>
                    <i class="fa-solid fa-chevron-right ml-auto text-gray-300"></i>
                </a>
                <a href="https://360life.shinyusha.co.jp/list/ldk" target="_blank" class="block card p-4 flex items-center gap-4 hover:bg-gray-50">
                    <div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center text-pink-600 text-xl"><i class="fa-solid fa-magazine"></i></div>
                    <div>
                        <h3 class="font-bold text-lg">LDK æ¯’èˆŒé›œèªŒ</h3>
                        <p class="text-xs text-gray-500">è¶…çœŸå¯¦è©•æ¸¬ï¼Œä¸è¸©é›·æ¨è–¦</p>
                    </div>
                    <i class="fa-solid fa-chevron-right ml-auto text-gray-300"></i>
                </a>
            </div>

            <div v-if="shopTab === 'souvenir'" class="space-y-3">
                <div v-for="(s, i) in souvenirs" :key="i" class="card p-3 flex gap-3">
                    <div class="w-20 h-20 bg-gray-100 rounded-lg flex-shrink-0 bg-cover bg-center" :style="`background-image: url(${s.img})`"></div>
                    <div>
                        <h3 class="font-bold text-gray-800">{{ s.name }}</h3>
                        <p class="text-xs text-gray-500 mt-1">{{ s.desc }}</p>
                        <span class="inline-block mt-2 text-xs bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded">æ¨è–¦</span>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'japanese'" class="px-4">
            <h2 class="text-xl font-bold text-gray-700 mb-4 text-center">ğŸ†˜ ç¿»è­¯ç¥å™¨</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-8">
                <a href="https://lens.google.com/" target="_blank" class="card p-6 flex flex-col items-center justify-center gap-3 bg-blue-50 border-2 border-blue-100 hover:bg-blue-100 transition">
                    <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center text-3xl text-blue-500 shadow-sm">
                        <i class="fa-solid fa-camera"></i>
                    </div>
                    <div class="font-bold text-blue-600">æ‹ç…§ç¿»è­¯</div>
                    <div class="text-xs text-gray-400">æƒèœå–®/èªªæ˜æ›¸</div>
                </a>
                
                <a href="https://translate.google.com/?sl=ja&tl=zh-TW" target="_blank" class="card p-6 flex flex-col items-center justify-center gap-3 bg-green-50 border-2 border-green-100 hover:bg-green-100 transition">
                    <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center text-3xl text-green-500 shadow-sm">
                        <i class="fa-solid fa-language"></i>
                    </div>
                    <div class="font-bold text-green-600">æ–‡å­—ç¿»è­¯</div>
                    <div class="text-xs text-gray-400">æ‰“å­—/èªéŸ³å°è©±</div>
                </a>
            </div>

            <h3 class="font-bold text-gray-700 mb-3 pl-2 border-l-4 border-yellow-400">å¸¸ç”¨çŸ­å¥ (é»æ“Šç™¼éŸ³)</h3>
            <div class="space-y-3">
                <div v-for="(phrase, idx) in japanesePhrases" :key="idx" 
                        @click="speak(phrase.jp)"
                        class="card p-4 flex items-center justify-between cursor-pointer active:scale-95 transition">
                    <div>
                        <div class="font-bold text-lg text-gray-800">{{ phrase.jp }}</div>
                        <div class="text-xs text-gray-400 font-mono mb-1">{{ phrase.romaji }}</div>
                        <div class="text-sm text-yellow-600 font-bold">{{ phrase.tw }}</div>
                    </div>
                    <i class="fa-solid fa-volume-high text-yellow-400 text-xl"></i>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // === Core State ===
            const isMounted = ref(false);
            const currentView = ref('home');
            const hasBanner = ref(true);
            const STORAGE_KEY = 'tokyo_trip_v6'; // Updated key for V6

            // Apps Config
            const apps = [
                { id: 1, name: 'è¡Œç¨‹è¡¨', icon: 'fa-solid fa-map-location-dot', color: 'bg-gradient-to-br from-pink-300 to-pink-400', view: 'itinerary' },
                { id: 2, name: 'ä½å®¿', icon: 'fa-solid fa-bed', color: 'bg-gradient-to-br from-indigo-300 to-indigo-400', view: 'hotel' },
                { id: 3, name: 'è¡Œå‰æº–å‚™', icon: 'fa-solid fa-suitcase-rolling', color: 'bg-gradient-to-br from-blue-300 to-blue-400', view: 'prep' },
                { id: 4, name: 'åƒåƒå–å–', icon: 'fa-solid fa-utensils', color: 'bg-gradient-to-br from-orange-300 to-orange-400', view: 'food' }, // Placeholder view, can reuse previous logic if needed, but omitted for brevity in V6 specific prompt
                { id: 5, name: 'å¿«æ¨‚Shop', icon: 'fa-solid fa-bag-shopping', color: 'bg-gradient-to-br from-purple-300 to-purple-400', view: 'shopping' },
                { id: 6, name: 'å¤©æ°£é€±å ±', icon: 'fa-solid fa-cloud-sun', color: 'bg-gradient-to-br from-sky-300 to-sky-500', view: 'weather' },
                { id: 7, name: 'ç¶²ç¾æ‰“å¡', icon: 'fa-solid fa-camera', color: 'bg-gradient-to-br from-rose-300 to-rose-400', view: 'photo' },
                { id: 8, name: 'å³æ™‚æ•‘å‘½', icon: 'fa-solid fa-comment-medical', color: 'bg-gradient-to-br from-emerald-400 to-teal-500', view: 'japanese' },
            ];

            // Weather Data State
            const tokyoWeather = ref({ temp: '--', icon: 'â³', desc: 'è¼‰å…¥ä¸­', visibility: '--' });
            const kamakuraWeather = ref({ temp: '--', icon: 'â³', desc: 'è¼‰å…¥ä¸­', visibility: '--' });
            const fujiWeather = ref({ temp: '--', icon: 'â³', desc: 'è¼‰å…¥ä¸­', visibility: '--' });

            // Itinerary Data (Pre-filled V6)
            const selectedDayIndex = ref(0);
            const tripDays = [
                { week: 'Day 1', title: 'æŠµé”/æ™´ç©ºå¡”' }, { week: 'Day 2', title: 'æ·ºè‰/ä¸Šé‡' },
                { week: 'Day 3', title: 'ç§Ÿè»Š/æ²³å£æ¹–' }, { week: 'Day 4', title: 'å±±ä¸­æ¹–' },
                { week: 'Day 5', title: 'çºœè»Š/å›æ–°å®¿' }, { week: 'Day 6', title: 'éŒå€‰æ±Ÿä¹‹é›»' },
                { week: 'Day 7', title: 'æ±äº¬å¡”/æ¾€è°·' }, { week: 'Day 8', title: 'è¿”ç¨‹' }
            ];
            
            // 8-Day Detail Itinerary
            const defaultItinerary = [
                [ // D1
                    { id: 101, category: 'Flight', name: 'æ¡ƒåœ’èµ·é£› (06:40)', hours: '06:40', note: 'å¿«æ¨‚å‡ºç™¼ï¼', mapKeyword: 'æ¡ƒåœ’æ©Ÿå ´' },
                    { id: 102, category: 'Flight', name: 'æŠµé”æ—¥æœ¬æˆç”° (10:40)', hours: '10:40', note: 'å…¥å¢ƒæ‰‹çºŒã€é ˜è¡Œæ', mapKeyword: 'æˆç”°æ©Ÿå ´' },
                    { id: 103, category: 'Sightseeing', name: 'æ™´ç©ºå¡”', hours: 'ä¸‹åˆ', note: 'é€›è¡—ã€æ‹ç…§ã€æ°´æ—é¤¨', mapKeyword: 'Tokyo Skytree' },
                    { id: 104, category: 'Food', name: 'æ™šé¤ï¼šéŒ¦ç³¸ç”ºå‘¨é­', hours: 'æ™šä¸Š', note: 'ç‡’è‚‰æˆ–å±…é…’å±‹', mapKeyword: 'éŒ¦ç³¸ç”ºç¾é£Ÿ' }
                ],
                [ // D2
                    { id: 201, category: 'Sightseeing', name: 'æ·ºè‰å¯º', hours: 'ä¸Šåˆ', note: 'é›·é–€å¤§ç‡ˆç± ã€ä»²è¦‹ä¸–é€šåƒé»å¿ƒ', mapKeyword: 'æ·ºè‰å¯º' },
                    { id: 202, category: 'Food', name: 'åˆé¤ï¼šæ·ºè‰å‘¨é­', hours: 'ä¸­åˆ', note: 'ç‚¸ç‰›æ’æˆ–å¤©å©¦ç¾…', mapKeyword: 'æ·ºè‰åˆé¤' },
                    { id: 203, category: 'Sightseeing', name: 'å°ç¶²ç¥ç¤¾', hours: 'ä¸‹åˆ', note: 'å¼·é‹å„é™¤ã€æ´—éŒ¢å¼è²¡å¤©', mapKeyword: 'å°ç¶²ç¥ç¤¾' },
                    { id: 204, category: 'Sightseeing', name: 'ä¸Šé‡æ©è³œå…¬åœ’', hours: 'ä¸‹åˆ', note: 'æ•£æ­¥ã€é˜¿ç¾æ©«ä¸', mapKeyword: 'ä¸Šé‡æ©è³œå…¬åœ’' },
                    { id: 205, category: 'Shopping', name: 'ç§‹è‘‰åŸ / æ±äº¬ä¸€ç•ªè¡—', hours: 'æ™šä¸Š', note: 'æ‰­è›‹ã€å‹•æ¼«å‘¨é‚Š', mapKeyword: 'ç§‹è‘‰åŸ' }
                ],
                [ // D3
                    { id: 301, category: 'Transport', name: 'éŒ¦ç³¸ç”ºå‰å¾€å¯Œå£«å±±', hours: 'ä¸Šåˆ', note: 'é–‹å§‹ç§Ÿè»Š 3å¤©2å¤œ', mapKeyword: 'æ²³å£æ¹–ç§Ÿè»Š' },
                    { id: 302, category: 'Sightseeing', name: 'æ²³å£æ¹–è‡ªç„¶ç”Ÿæ´»é¤¨', hours: 'ä¸‹åˆ', note: 'å¤§çŸ³å…¬åœ’çœ‹å¯Œå£«å±±', mapKeyword: 'æ²³å£æ¹–è‡ªç„¶ç”Ÿæ´»é¤¨' },
                    { id: 303, category: 'Sightseeing', name: 'æ–°å€‰å¯Œå£«æ·ºé–“ç¥ç¤¾', hours: 'ä¸‹åˆ', note: 'çˆ¬æ¨“æ¢¯çœ‹äº”é‡å¡”', mapKeyword: 'æ–°å€‰å¯Œå£«æ·ºé–“ç¥ç¤¾' },
                    { id: 304, category: 'Sightseeing', name: 'é‡‘é³¥å±… & å•†åº—è¡—', hours: 'å‚æ™š', note: 'å¯Œå£«å‰ç”°æœ¬ç”ºé€šæ‹ç…§', mapKeyword: 'å¯Œå£«å‰ç”°æœ¬ç”ºé€š' },
                    { id: 305, category: 'Food', name: 'æ™šé¤', hours: 'æ™šä¸Š', note: 'è‡ªè¡Œçƒ¹é£ªæˆ–å•†åº—è¡—è¦“é£Ÿ', mapKeyword: 'å¯Œå£«å‰ç”°æ™šé¤' }
                ],
                [ // D4
                    { id: 401, category: 'Sightseeing', name: 'å¹³é‡ä¹‹æ¿±æ—¥å‡º', hours: 'æ¸…æ™¨', note: 'çµ•ç¾é€†å¯Œå£«', mapKeyword: 'å¹³é‡ä¹‹æ¿±' },
                    { id: 402, category: 'Sightseeing', name: 'é•·æ± è¦ªæ°´å…¬åœ’ & ç™½é³¥æ¿±', hours: 'ä¸Šåˆ', note: 'ç§Ÿè‡ªè¡Œè»Šç’°æ¹–', mapKeyword: 'é•·æ± è¦ªæ°´å…¬åœ’' },
                    { id: 403, category: 'Food', name: 'åˆé¤ï¼šå±±ä¸­æ¹–é¤å»³', hours: 'ä¸­åˆ', note: 'Houtouéºµ', mapKeyword: 'å±±ä¸­æ¹–ç¾é£Ÿ' },
                    { id: 404, category: 'Sightseeing', name: 'KABA æ°´é™¸å·´å£«', hours: 'ä¸‹åˆ', note: 'æ—­æ—¥ä¸˜æ¹–ç•”ç¶ åœ°å…¬åœ’', mapKeyword: 'å±±ä¸­æ¹–KABA' },
                    { id: 405, category: 'Food', name: 'Ogino è¶…å¸‚æ¡è²·æ™šé¤', hours: 'æ™šä¸Š', note: 'è²·å’Œç‰›å›æ°‘å®¿ç…®', mapKeyword: 'Oginoæ²³å£æ¹–åº—' }
                ],
                [ // D5
                    { id: 501, category: 'Sightseeing', name: 'æ²³å£æ¹–çºœè»Š', hours: 'æ—©ä¸Š', note: 'çµ•æ™¯é¦éŸ†', mapKeyword: 'æ²³å£æ¹–å¯Œå£«å±±å…¨æ™¯çºœè»Š' },
                    { id: 502, category: 'Shopping', name: 'Fujisan Shokupan', hours: 'é»å¿ƒ', note: 'å¯Œå£«å±±åå¸ä¼´æ‰‹ç¦®', mapKeyword: 'Fujisan Shokupan' },
                    { id: 503, category: 'Transport', name: 'æ­ä¹˜å¯Œå£«å›éŠè¿”æ–°å®¿', hours: 'ä¸‹åˆ', note: 'é‚„è»Šå¾Œæ­ç«è»Š', mapKeyword: 'æ²³å£æ¹–ç«™' },
                    { id: 504, category: 'Shopping', name: 'æ± è¢‹å¤ªé™½åŸ', hours: 'å‚æ™š', note: 'æ°´æ—é¤¨ã€å¯¶å¯å¤¢ä¸­å¿ƒ', mapKeyword: 'æ± è¢‹å¤ªé™½åŸ' },
                    { id: 505, category: 'Food', name: 'æ™šé¤ï¼šå¤ªé™½åŸå…§', hours: 'æ™šä¸Š', note: 'é¸æ“‡å¤šæ¨£æ–¹ä¾¿', mapKeyword: 'æ± è¢‹å¤ªé™½åŸç¾é£Ÿ' }
                ],
                [ // D6
                    { id: 601, category: 'Transport', name: 'å‰å¾€è—¤æ¾¤', hours: 'ä¸Šåˆ', note: 'é–‹å•Ÿæ±Ÿä¹‹é›»ä¸€æ—¥éŠ', mapKeyword: 'è—¤æ¾¤ç«™' },
                    { id: 602, category: 'Sightseeing', name: 'æ±Ÿä¹‹é›»ä¹‹æ—…', hours: 'å…¨å¤©', note: 'è—¤æ¾¤ > æ±Ÿä¹‹å³¶ > éŒå€‰é«˜æ ¡å‰ > ä¸ƒé‡Œæ¿± > éŒå€‰', mapKeyword: 'æ±Ÿä¹‹å³¶' },
                    { id: 603, category: 'Food', name: 'åˆé¤ï¼šä¸ƒé‡Œæ¿±', hours: 'ä¸­åˆ', note: 'æµ·æ™¯é¤å»³ (Bills)', mapKeyword: 'ä¸ƒé‡Œæ¿±Bills' },
                    { id: 604, category: 'Transport', name: 'è¿”å›æ–°å®¿', hours: 'å‚æ™š', note: 'ç´¯äº†å›é£¯åº—', mapKeyword: 'æ–°å®¿ç«™' },
                    { id: 605, category: 'Food', name: 'æ™šé¤ï¼šæ–°å®¿', hours: 'æ™šä¸Š', note: 'è»Šç«™å‘¨é‚Šæˆ–è‡ªç‚Š', mapKeyword: 'æ–°å®¿æ™šé¤' }
                ],
                [ // D7
                    { id: 701, category: 'Sightseeing', name: 'æ±äº¬éµå¡” & éº»å¸ƒå°', hours: 'ä¸Šåˆ', note: 'èŠå…¬åœ’æ‹ç…§', mapKeyword: 'æ±äº¬éµå¡”' },
                    { id: 702, category: 'Food', name: 'åˆé¤ï¼šå…­æœ¬æœ¨å‘¨é­', hours: 'ä¸­åˆ', note: '', mapKeyword: 'å…­æœ¬æœ¨åˆé¤' },
                    { id: 703, category: 'Shopping', name: 'å‰å¾€æ¾€è°·', hours: 'ä¸‹åˆ', note: 'Parco, Loft', mapKeyword: 'æ¾€è°·' },
                    { id: 704, category: 'Sightseeing', name: 'SHIBUYA SKY', hours: 'å‚æ™š', note: 'é ç´„å¤•é™½å ´', mapKeyword: 'SHIBUYA SKY' },
                    { id: 705, category: 'Shopping', name: 'æ¾€è°·æœ€å¾Œæ¡è²·', hours: 'æ™šä¸Š', note: 'è—¥å¦ã€å”å‰è¨¶å¾·', mapKeyword: 'æ¾€è°·å”å‰è¨¶å¾·' }
                ],
                [ // D8
                    { id: 801, category: 'Sightseeing', name: 'è‡ªç”±è¡Œç¨‹', hours: 'ç™½å¤©', note: 'è£œè²¨æˆ–ä¼‘æ¯', mapKeyword: '' },
                    { id: 802, category: 'Transport', name: 'æˆç”°æ©Ÿå ´èµ·é£› (20:40)', hours: '20:40', note: 'ææ—©åˆ°æ©Ÿå ´é€›å…ç¨…', mapKeyword: 'æˆç”°æ©Ÿå ´' },
                    { id: 803, category: 'Transport', name: 'æŠµé”æ¡ƒåœ’ (23:20)', hours: '23:20', note: 'ç”œèœœçš„å®¶', mapKeyword: 'æ¡ƒåœ’æ©Ÿå ´' }
                ]
            ];
            
            const itineraryData = ref(defaultItinerary);

            // Prep Data
            const prepList = ref([
                { text: 'è­·ç…§ (æª¢æŸ¥æ•ˆæœŸ)', checked: false },
                { text: 'å°ç£é§•ç…§ + æ—¥æ–‡è­¯æœ¬', checked: false },
                { text: 'Visit Japan Web QR Code', checked: false },
                { text: 'æ—¥å¹£ç¾é‡‘ (ç´„5-10è¬)', checked: false },
                { text: 'æµ·å¤–é«˜å›é¥‹ä¿¡ç”¨å¡ (å‰é¶´/Flygo)', checked: false },
                { text: 'SIMå¡ / æ¼«éŠé–‹é€š', checked: false },
                { text: 'è¡Œå‹•é›»æº (æ”¾éš¨èº«)', checked: false },
                { text: 'å€‹äººè—¥å“ (æ„Ÿå†’/è…¸èƒƒ/æ­¢ç—›)', checked: false },
                { text: 'ç‰™åˆ·ç‰™è† (éƒ¨åˆ†ç’°ä¿é£¯åº—ä¸æä¾›)', checked: false },
                { text: 'è³¼ç‰©è¢‹ (æ—¥æœ¬å¡‘è† è¢‹æ”¶è²»)', checked: false },
                { text: 'å……é›»ç·š / è½‰æ¥é ­ (æ—¥æœ¬é›™æ‰å­”)', checked: false }
            ]);

            // Photo Spots Data (5 per region)
            const photoArea = ref('Tokyo');
            const photoSpots = {
                'Tokyo': [
                    { name: 'SHIBUYA SKY', desc: 'é€æ˜æ‰‹æ‰¶æ¢¯èˆ‡çµ•ç¾å¤œæ™¯', img: 'https://images.unsplash.com/photo-1696257523267-313d4b68ec29?auto=format&fit=crop&w=600&q=80' },
                    { name: 'æ±äº¬éµå¡” (èŠå…¬åœ’)', desc: 'è‰åœ°ä¸Šèˆ‡éµå¡”åˆç…§', img: 'https://images.unsplash.com/photo-1536098561742-ca998e48cbcc?auto=format&fit=crop&w=600&q=80' },
                    { name: 'æ·ºè‰å¯ºé›·é–€', desc: 'ç¶“å…¸å¤§ç´…ç‡ˆç± ', img: 'https://images.unsplash.com/photo-1563865646-b33705330368?auto=format&fit=crop&w=600&q=80' },
                    { name: 'éº»å¸ƒå° Hills', desc: 'æœ€æ–°æ³¢æµªå»ºç¯‰åœ°æ¨™', img: 'https://images.unsplash.com/photo-1707054948834-0346c8206096?auto=format&fit=crop&w=600&q=80' },
                    { name: 'æ±äº¬è»Šç«™ä¸¸ä¹‹å…§', desc: 'ç´…ç£šå¾©å¤è»Šç«™å»ºç¯‰', img: 'https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?auto=format&fit=crop&w=600&q=80' }
                ],
                'Kamakura': [
                    { name: 'éŒå€‰é«˜æ ¡å‰', desc: 'çŒç±ƒé«˜æ‰‹å¹³äº¤é“', img: 'https://images.unsplash.com/photo-1633519398858-693247d86348?auto=format&fit=crop&w=600&q=80' },
                    { name: 'ä¸ƒé‡Œæ¿±æµ·å²¸', desc: 'çœ‹æµ·ã€çœ‹æ±Ÿä¹‹å³¶ã€çœ‹å¯Œå£«å±±', img: 'https://images.unsplash.com/photo-1565618790209-411a51163627?auto=format&fit=crop&w=600&q=80' },
                    { name: 'é¶´å²¡å…«å¹¡å®®', desc: 'è‘—åçš„ç´…è‰²é³¥å±…', img: 'https://images.unsplash.com/photo-1600414864509-32215c32470c?auto=format&fit=crop&w=600&q=80' },
                    { name: 'é«˜å¾·é™¢å¤§ä½›', desc: 'èŠåš´çš„éœ²å¤©å¤§ä½›', img: 'https://images.unsplash.com/photo-1553603227-2358e375ece5?auto=format&fit=crop&w=600&q=80' },
                    { name: 'æ±Ÿä¹‹å³¶ Sea Candle', desc: 'å±•æœ›ç‡ˆå¡”èˆ‡èŠ±åœ’', img: 'https://images.unsplash.com/photo-1598418086208-164478832a22?auto=format&fit=crop&w=600&q=80' }
                ],
                'Fuji': [
                    { name: 'ä¸‹å‰ç”°æœ¬ç”ºé€š', desc: 'å•†åº—è¡—èˆ‡å·¨å¤§å¯Œå£«å±±', img: 'https://images.unsplash.com/photo-1589451814294-26d36298dd22?auto=format&fit=crop&w=600&q=80' },
                    { name: 'æ²³å£æ¹– Lawson', desc: 'ä¾¿åˆ©å•†åº—ä¸Šçš„å¯Œå£«å±±', img: 'https://images.unsplash.com/photo-1584856403612-9c3f09599d10?auto=format&fit=crop&w=600&q=80' },
                    { name: 'æ–°å€‰å±±æ·ºé–“å…¬åœ’', desc: 'äº”é‡å¡” x å¯Œå£«å±±', img: 'https://images.unsplash.com/photo-1524225010903-8898df5d0954?auto=format&fit=crop&w=600&q=80' },
                    { name: 'å¤§çŸ³å…¬åœ’', desc: 'è–°è¡£è‰/æƒå¸šè‰èˆ‡å¯Œå£«å±±', img: 'https://images.unsplash.com/photo-1490806843957-31f4c9a91c65?auto=format&fit=crop&w=600&q=80' },
                    { name: 'å¤©ç©ºé³¥å±…', desc: 'æ²³å£æ·ºé–“ç¥ç¤¾é™æ‹œæ‰€', img: 'https://images.unsplash.com/photo-1667022275253-34e85741f021?auto=format&fit=crop&w=600&q=80' }
                ]
            };

            // Shopping Data
            const shopTab = ref('wish');
            const shoppingList = ref([]);
            const souvenirs = [
                { name: 'NY Perfect Cheese', desc: 'å¥¶æ²¹èµ·å¸è„†é¤…ï¼Œæ±äº¬è»Šç«™å¿…æ’', img: 'https://images.unsplash.com/photo-1621303837174-89787a7d4729?auto=format&fit=crop&w=200&q=80' },
                { name: 'Press Butter Sand', desc: 'ç„¦ç³–å¥¶æ²¹å¤¾å¿ƒé¤…', img: 'https://images.unsplash.com/photo-1599639668356-b60507b51e06?auto=format&fit=crop&w=200&q=80' },
                { name: 'è±å³¶å±‹ é³©ä¸‰éƒ', desc: 'éŒå€‰å¿…è²·é´¿å­é¤…ä¹¾', img: 'https://plus.unsplash.com/premium_photo-1675279401925-83e911277a06?auto=format&fit=crop&w=200&q=80' },
                { name: 'å¯Œå£«å±±é€ å‹é¤…ä¹¾', desc: 'æ²³å£æ¹–å¯æ„›ä¼´æ‰‹ç¦®', img: 'https://images.unsplash.com/photo-1601205741712-b261aff33a7d?auto=format&fit=crop&w=200&q=80' },
            ];

            // Japanese Data
            const japanesePhrases = [
                { jp: 'ã™ã¿ã¾ã›ã‚“', romaji: 'Sumimasen', tw: 'ä¸å¥½æ„æ€ / è«‹å•' },
                { jp: 'ã“ã‚Œã‚’ãŠé¡˜ã„ã—ã¾ã™', romaji: 'Kore o onegaishimasu', tw: 'æˆ‘è¦é€™å€‹' },
                { jp: 'ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™', romaji: 'Okaikei onegaishimasu', tw: 'æˆ‘è¦çµå¸³' },
                { jp: 'è¢‹ã¯ã„ã‚Šã¾ã›ã‚“', romaji: 'Fukuro wa irimasen', tw: 'ä¸ç”¨è¢‹å­' },
                { jp: 'ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹', romaji: 'Toire wa doko desu ka', tw: 'å»æ‰€åœ¨å“ªï¼Ÿ' },
                { jp: 'å†™çœŸã‚’ã¨ã£ã¦ã‚‚ã„ã„ã§ã™ã‹', romaji: 'Shashin o tottemo ii desu ka', tw: 'å¯ä»¥æ‹ç…§å—ï¼Ÿ' },
                { jp: 'å…ç¨ã§ãã¾ã™ã‹', romaji: 'Menzei dekimasu ka', tw: 'å¯ä»¥å…ç¨…å—ï¼Ÿ' },
            ];

            // === Methods ===
            const goHome = () => currentView.value = 'home';
            const getPageTitle = (view) => apps.find(a => a.view === view)?.name || '';
            const getMapLink = (k) => k ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(k)}` : '#';
            const getBorderColor = (c) => ({'Flight':'border-gray-400','Sightseeing':'border-pink-300','Food':'border-orange-300','Shopping':'border-purple-300','Transport':'border-blue-300','Hotel':'border-indigo-300'}[c]||'border-gray-300');
            const getCategoryColor = (c) => ({'Flight':'bg-gray-400','Sightseeing':'bg-pink-300','Food':'bg-orange-300','Shopping':'bg-purple-300','Transport':'bg-blue-300','Hotel':'bg-indigo-300'}[c]||'bg-gray-300');
            const getCategoryName = (c) => ({'Flight':'é£›æ©Ÿ','Sightseeing':'æ™¯é»','Food':'ç¾é£Ÿ','Shopping':'è³¼ç‰©','Transport':'äº¤é€š','Hotel':'ä½å®¿'}[c]||'å…¶ä»–');
            
            const addPrepItem = () => { const t=prompt('æ–°å¢é …ç›®:'); if(t) prepList.value.push({text:t, checked:false}); };
            const addShopItem = () => { const t=prompt('æƒ³è²·ä»€éº¼:'); if(t) shoppingList.value.push({name:t}); };
            const speak = (text) => { const u=new SpeechSynthesisUtterance(text); u.lang='ja-JP'; window.speechSynthesis.speak(u); };

            // Weather Fetcher (Generic)
            const getWeatherData = async (lat, lon, targetRef) => {
                try {
                    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,cloud_cover&timezone=Asia%2FTokyo`);
                    const data = await res.json();
                    const code = data.current.weather_code;
                    let icon = 'â˜ï¸', desc = 'å¤šé›²';
                    if(code <= 3) { icon='ğŸŒ¤ï¸'; desc='æ™´æ™‚å¤šé›²'; }
                    else if(code <= 67) { icon='â˜”'; desc='æœ‰é›¨'; }
                    else if(code > 95) { icon='â›ˆï¸'; desc='é›·é›¨'; }
                    
                    targetRef.value = {
                        temp: data.current.temperature_2m,
                        icon: icon,
                        desc: desc,
                        visibility: Math.max(0, 100 - data.current.cloud_cover)
                    };
                } catch(e) { console.error(e); }
            };

            const fetchAllWeather = () => {
                getWeatherData(35.6895, 139.6917, tokyoWeather);
                getWeatherData(35.3192, 139.5467, kamakuraWeather);
                getWeatherData(35.3606, 138.7274, fujiWeather);
            };

            const saveData = () => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify({
                    itinerary: itineraryData.value,
                    prep: prepList.value,
                    shopping: shoppingList.value
                }));
            };

            const resetData = () => {
                if(confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰è³‡æ–™å›åˆ°é è¨­å€¼å—ï¼Ÿ')) {
                    localStorage.removeItem(STORAGE_KEY);
                    location.reload();
                }
            };

            onMounted(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                if(saved) {
                    try {
                        const d = JSON.parse(saved);
                        itineraryData.value = d.itinerary || itineraryData.value;
                        prepList.value = d.prep || prepList.value;
                        shoppingList.value = d.shopping || shoppingList.value;
                    } catch(e) {}
                }
                
                const img = new Image(); img.src = './banner.jpg'; img.onerror = () => hasBanner.value = false;
                fetchAllWeather();
                isMounted.value = true;
            });

            watch([itineraryData, prepList, shoppingList], saveData, {deep:true});
            const currentDayItinerary = computed(() => itineraryData.value[selectedDayIndex.value] || []);

            return {
                isMounted, currentView, hasBanner, apps, goHome, getPageTitle, resetData,
                // Weather
                tokyoWeather, kamakuraWeather, fujiWeather,
                // Itinerary
                tripDays, selectedDayIndex, currentDayItinerary, getBorderColor, getCategoryColor, getCategoryName, getMapLink,
                // Prep
                prepList, addPrepItem,
                // Photo
                photoArea, photoSpots,
                // Shopping
                shopTab, shoppingList, souvenirs, addShopItem,
                // Japanese
                japanesePhrases, speak
            };
        }
    }).mount('#app');
</script>
</body>
</html>
