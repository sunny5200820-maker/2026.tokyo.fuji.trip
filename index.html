<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é—œæ±ä¹‹æ—… | å‰ä¼Šå¡å“‡é¢¨ V7.0</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'chii-pink': '#FFD1DC',
                        'chii-blue': '#A2D2FF',
                        'chii-yellow': '#FFF5BA',
                        'chii-text': '#5D5D5D',
                    },
                    fontFamily: {
                        sans: ['Zen Maru Gothic', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'bounce-slow': 'bounce 3s infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #FFF5F7; 
            font-family: 'Zen Maru Gothic', sans-serif;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
            overscroll-behavior-y: none; /* é˜²æ­¢ä¸‹æ‹‰åˆ·æ–°å¹²æ“¾æ»‘å‹• */
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        /* æ«»èŠ±é£„è½å‹•ç•« */
        .sakura {
            position: fixed;
            top: -10px;
            background: #FFD1DC;
            border-radius: 100% 0 100% 0;
            opacity: 0.6;
            animation: fall linear infinite;
            z-index: 0;
            pointer-events: none;
        }
        @keyframes fall {
            to { transform: translate(10vw, 105vh) rotate(360deg); }
        }

        /* Banner */
        .banner-container {
            height: 240px;
            background-image: url('./banner.jpg');
            background-size: cover;
            background-position: center;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            position: relative;
            box-shadow: 0 4px 20px rgba(255, 209, 220, 0.4);
            margin-bottom: 20px;
        }
        .banner-fallback {
            background: linear-gradient(135deg, #A2D2FF 0%, #FFD1DC 100%);
        }

        /* App Grid Icons */
        .app-icon {
            width: 65px;
            height: 65px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.1s;
            margin-bottom: 6px;
        }
        .app-icon:active { transform: scale(0.9); }
        .app-label { font-size: 12px; font-weight: bold; color: #5D5D5D; text-align: center; line-height: 1.2; }

        .card {
            background: white;
            border-radius: 18px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            transition: all 0.2s;
        }

        /* Weather Card */
        .weather-card {
            background: linear-gradient(120deg, #89f7fe 0%, #66a6ff 100%);
            color: white;
        }

        /* æ‡¸æµ® VJW æŒ‰éˆ• */
        .vjw-btn {
            position: fixed;
            bottom: 30px;
            right: 20px;
            background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(255, 154, 158, 0.4);
            font-weight: bold;
            z-index: 50;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: bounce-slow 3s infinite;
        }

        /* ä¸»é æ‡¸æµ®æœå°‹æ¬„ */
        .floating-search {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 400px;
            z-index: 40;
            transition: all 0.3s;
        }

        [v-cloak] { display: none; }
    </style>
</head>
<body>

<div id="sakura-container"></div>

<div id="app" @touchstart="handleTouchStart" @touchend="handleTouchEnd">
    <div v-if="!isMounted" class="fixed inset-0 flex flex-col items-center justify-center bg-white z-50">
        <i class="fa-solid fa-spinner fa-spin text-4xl text-chii-pink mb-4"></i>
        <div class="text-chii-text font-bold">æ­£åœ¨è¼‰å…¥é—œæ±ä¹‹æ—…...</div>
    </div>

    <div v-if="isMounted" v-cloak class="min-h-screen pb-24 relative z-10">
        
        <div v-if="currentView !== 'home'" class="fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-sm z-40 px-4 py-3 flex justify-between items-center shadow-sm h-14 transition-all">
            <button @click="goHome" class="w-8 h-8 rounded-full bg-gray-100 text-gray-500 flex items-center justify-center hover:bg-chii-pink hover:text-white transition">
                <i class="fa-solid fa-chevron-left"></i>
            </button>
            <h1 class="font-bold text-gray-700">{{ getPageTitle(currentView) }}</h1>
            <button @click="showSyncModal = true" class="w-8 h-8 rounded-full text-blue-400 flex items-center justify-center">
                <i class="fa-solid fa-cloud-arrow-up"></i>
            </button>
        </div>
        <div v-if="currentView !== 'home'" class="h-16"></div>

        <div v-if="currentView === 'home'" class="animate-fade-in pb-20">
            <div class="banner-container" :class="{'banner-fallback': !hasBanner}">
                <div class="absolute inset-0 bg-gradient-to-l from-black/20 to-transparent rounded-b-[30px]"></div>
                <div class="absolute bottom-6 right-6 text-white text-right">
                    <div class="text-xs opacity-90 mb-1 tracking-widest">TOKYO TRIP</div>
                    <h1 class="text-4xl font-black drop-shadow-md">é—œæ±ä¹‹æ—… ğŸŒ¸</h1>
                    <div class="mt-2 text-sm bg-white/20 backdrop-blur-md px-3 py-1 rounded-full inline-block">
                        <i class="fa-solid fa-car mr-1"></i>V7.0 å®Œæ•´ç‰ˆ
                    </div>
                </div>
                <button @click="showSyncModal = true" class="absolute top-4 right-4 bg-white/30 backdrop-blur text-white px-3 py-1.5 rounded-full text-xs font-bold shadow-sm border border-white/50">
                    <i class="fa-solid fa-rotate mr-1"></i>åŒæ­¥/å­˜æª”
                </button>
            </div>

            <div class="px-5 grid grid-cols-4 gap-y-6 gap-x-2 mb-8">
                <div v-for="app in apps" :key="app.id" class="flex flex-col items-center cursor-pointer group" @click="currentView = app.view">
                    <div class="app-icon" :class="app.color">
                        <i :class="app.icon"></i>
                    </div>
                    <span class="app-label group-hover:text-chii-pink transition">{{ app.name }}</span>
                </div>
            </div>

            <div class="px-4 mb-24">
                <div @click="currentView = 'weather'" class="weather-card rounded-2xl p-4 relative overflow-hidden shadow-lg cursor-pointer">
                    <div class="flex justify-between items-center relative z-10">
                        <div>
                            <div class="text-sm font-bold opacity-90"><i class="fa-solid fa-location-dot mr-1"></i>ä»Šæ—¥å¯Œå£«å±±</div>
                            <div class="text-3xl font-bold mt-1">{{ fujiWeather.temp }}Â°C</div>
                            <div class="text-xs mt-1">èƒ½è¦‹åº¦: {{ fujiWeather.visibility }}%</div>
                        </div>
                        <div class="text-right">
                            <div class="text-4xl animate-float">{{ fujiWeather.icon }}</div>
                            <div class="text-xs mt-1">{{ fujiWeather.desc }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="floating-search">
                <div class="bg-white/90 backdrop-blur p-2 rounded-full shadow-xl flex items-center border border-gray-200">
                    <i class="fa-brands fa-google text-gray-400 ml-3 text-lg"></i>
                    <input v-model="searchQuery" @keyup.enter="doGoogleSearch" placeholder="æœå°‹æ±äº¬æ™¯é»..." class="flex-1 bg-transparent border-none outline-none px-3 text-sm h-10">
                    <button @click="doGoogleSearch" class="bg-blue-500 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-md active:scale-95 transition">
                        <i class="fa-solid fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'itinerary'" class="px-4">
            <div class="flex overflow-x-auto hide-scrollbar gap-2 mb-4 pb-2 sticky top-16 bg-white/95 backdrop-blur py-2 z-30">
                <button v-for="(day, index) in tripDays" :key="index" 
                    @click="selectedDayIndex = index"
                    :class="['flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold transition border', 
                            selectedDayIndex === index ? 'bg-chii-pink text-white border-chii-pink shadow-md' : 'bg-white text-gray-400 border-gray-100']">
                    {{ day.week }}<br><span class="text-xs font-normal">{{ day.title }}</span>
                </button>
            </div>

            <div class="space-y-4">
                <div v-for="(item, idx) in currentDayItinerary" :key="item.id" class="card p-4 relative border-l-[6px]" :class="getBorderColor(item.category)">
                    <div class="flex justify-between items-start" @click="editItem(item, idx)">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-xs font-bold px-2 py-0.5 rounded text-white" :class="getCategoryColor(item.category)">{{ getCategoryName(item.category) }}</span>
                                <span class="text-xs text-gray-400 font-mono"><i class="fa-regular fa-clock mr-1"></i>{{ item.hours }}</span>
                            </div>
                            <h3 class="font-bold text-gray-800 text-lg">
                                {{ item.name }}
                                <a :href="getMapLink(item.mapKeyword)" target="_blank" @click.stop class="ml-1 text-blue-400 hover:text-blue-600"><i class="fa-solid fa-location-arrow"></i></a>
                            </h3>
                            <p class="text-sm text-gray-500 mt-2 leading-relaxed bg-gray-50 p-2 rounded-lg">{{ item.note }}</p>
                        </div>
                        <button @click.stop="deleteItem(idx)" class="text-gray-300 hover:text-red-400 ml-2"><i class="fa-solid fa-trash-can"></i></button>
                    </div>
                </div>
                <button @click="openAddModal" class="fixed bottom-6 right-6 w-14 h-14 bg-chii-pink text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-40 hover:scale-110 transition animate-bounce-slow">
                    <i class="fa-solid fa-plus"></i>
                </button>
            </div>
        </div>

        <div v-if="currentView === 'hotel'" class="px-4">
            <h2 class="text-lg font-bold text-gray-700 mb-4 pl-2 border-l-4 border-indigo-400">æœ¬æ¬¡æ—…ç¨‹ä½å®¿</h2>
            <div class="space-y-5">
                <div class="card overflow-hidden">
                    <div class="h-36 bg-gray-200 bg-cover bg-center" style="background-image: url('https://cf.bstatic.com/xdata/images/hotel/max1024x768/292703816.jpg?k=3486337586566210636750346338575034827054817112040685474661840003&o=&hp=1')"></div>
                    <div class="p-4">
                        <span class="text-xs bg-indigo-100 text-indigo-600 px-2 py-1 rounded font-bold">Day 1-2 (2æ™š)</span>
                        <h3 class="font-bold text-xl mt-2">éŒ¦ç³¸ç”º Sumida City</h3>
                        <p class="text-sm text-gray-500 mb-3">äº¤é€šä¾¿åˆ©ï¼Œç›´é”æ™´ç©ºå¡”èˆ‡æ±äº¬è»Šç«™</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=éŒ¦ç³¸ç”º+Sumida+City" target="_blank" class="flex items-center justify-center gap-2 w-full bg-blue-50 text-blue-600 py-3 rounded-xl font-bold hover:bg-blue-100 transition">
                            <i class="fa-solid fa-map-location-dot"></i> é–‹å•Ÿåœ°åœ–å°èˆª
                        </a>
                    </div>
                </div>
                <div class="card overflow-hidden">
                    <div class="h-36 bg-gray-200 bg-cover bg-center" style="background-image: url('https://cf.bstatic.com/xdata/images/hotel/max1024x768/308960763.jpg?k=756372076060161474254700021316531336040173641207604604213143603&o=&hp=1')"></div>
                    <div class="p-4">
                        <span class="text-xs bg-indigo-100 text-indigo-600 px-2 py-1 rounded font-bold">Day 3-4 (2æ™š)</span>
                        <h3 class="font-bold text-xl mt-2">Megu Fuji 2021</h3>
                        <p class="text-sm text-gray-500 mb-3">å¯Œå£«å±±æ™¯è§€é£¯åº—ï¼Œä¸‹å‰ç”°ç«™æ­¥è¡Œå¯é”</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=Megu+Fuji+2021" target="_blank" class="flex items-center justify-center gap-2 w-full bg-blue-50 text-blue-600 py-3 rounded-xl font-bold hover:bg-blue-100 transition">
                            <i class="fa-solid fa-map-location-dot"></i> é–‹å•Ÿåœ°åœ–å°èˆª
                        </a>
                    </div>
                </div>
                <div class="card overflow-hidden">
                    <div class="h-36 bg-gray-200 bg-cover bg-center" style="background-image: url('https://cf.bstatic.com/xdata/images/hotel/max1024x768/248983050.jpg?k=36163140510626354670067645161066421033464303350100650326040003&o=&hp=1')"></div>
                    <div class="p-4">
                        <span class="text-xs bg-indigo-100 text-indigo-600 px-2 py-1 rounded font-bold">Day 5-7 (3æ™š)</span>
                        <h3 class="font-bold text-xl mt-2">DOMO é£¯åº—</h3>
                        <p class="text-sm text-gray-500 mb-3">æ–°å®¿/æ–°å¤§ä¹…ä¿å‘¨é‚Šï¼Œé€›è¡—è¶…æ–¹ä¾¿</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=DOMO+HOTEL+Tokyo" target="_blank" class="flex items-center justify-center gap-2 w-full bg-blue-50 text-blue-600 py-3 rounded-xl font-bold hover:bg-blue-100 transition">
                            <i class="fa-solid fa-map-location-dot"></i> é–‹å•Ÿåœ°åœ–å°èˆª
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'food'" class="px-4">
            <h2 class="text-lg font-bold text-gray-700 mb-4 pl-2 border-l-4 border-orange-400">ç¾é£Ÿæ¨è–¦æ¸…å–®</h2>
            
            <div class="grid grid-cols-1 gap-4">
                <div v-for="(food, idx) in foodList" :key="idx" class="card p-4 flex gap-4 hover:shadow-md transition cursor-pointer" @click="window.open(getMapLink(food.name))">
                    <div class="w-20 h-20 bg-orange-50 rounded-xl flex-shrink-0 flex items-center justify-center text-4xl shadow-inner">
                        {{ food.icon }}
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <span class="text-xs bg-orange-100 text-orange-600 px-2 py-0.5 rounded font-bold">{{ food.area }}</span>
                            <i class="fa-solid fa-location-arrow text-gray-300 text-xs"></i>
                        </div>
                        <h3 class="font-bold text-gray-800 text-lg mt-1">{{ food.name }}</h3>
                        <p class="text-sm text-gray-500 mt-1">{{ food.desc }}</p>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 text-center text-sm text-gray-400 pb-10">
                <i class="fa-solid fa-utensils mr-1"></i>
                é»æ“Šå¡ç‰‡å¯ç›´æ¥å°èˆª
            </div>
        </div>

        <div v-if="currentView === 'prep'" class="px-4">
            <a href="https://vjw-lp.digital.go.jp/zh-hant/" target="_blank" class="vjw-btn">
                <i class="fa-solid fa-qrcode text-xl"></i> Visit Japan Web
            </a>

            <div class="bg-white rounded-2xl shadow-sm p-4 relative mb-20">
                <div class="absolute top-0 left-0 w-full h-3 bg-chii-blue opacity-50 rounded-t-2xl"></div>
                <div class="p-2 mb-2 bg-yellow-50 text-yellow-700 text-xs rounded border border-yellow-100">
                    <i class="fa-solid fa-circle-info mr-1"></i>å…¥å¢ƒå¯©æŸ¥QR Code è«‹å‹™å¿…æˆªåœ–å­˜æ‰‹æ©Ÿ
                </div>
                <div v-for="(item, idx) in prepList" :key="idx" class="flex items-center gap-3 py-3 border-b border-gray-50 last:border-0">
                    <input type="checkbox" v-model="item.checked" class="w-5 h-5 accent-blue-400 rounded cursor-pointer">
                    <input v-model="item.text" class="flex-1 text-sm bg-transparent outline-none" :class="{'line-through text-gray-300': item.checked}">
                    <button @click="prepList.splice(idx, 1)" class="text-gray-300"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <button @click="addPrepItem" class="w-full mt-4 py-3 bg-gray-50 rounded-xl text-gray-500 font-bold border-2 border-dashed border-gray-200 hover:bg-white hover:border-blue-300 transition">+ æ–°å¢é …ç›®</button>
            </div>
        </div>

        <div v-if="currentView === 'japanese'" class="px-4">
            <h2 class="text-xl font-bold text-gray-700 mb-4 text-center">é»æ“Šå¡ç‰‡ç™¼éŸ³ ğŸ”Š</h2>
            
            <div class="grid grid-cols-1 gap-3">
                <div v-for="(phrase, idx) in japanesePhrases" :key="idx" 
                        @click="speak(phrase.jp)"
                        class="card p-5 flex items-center justify-between cursor-pointer active:scale-95 transition border-l-4 border-green-400 hover:bg-green-50">
                    <div>
                        <div class="font-bold text-xl text-gray-800">{{ phrase.jp }}</div>
                        <div class="text-xs text-gray-400 font-mono mb-1">{{ phrase.romaji }}</div>
                        <div class="text-sm text-green-600 font-bold">{{ phrase.tw }}</div>
                    </div>
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                        <i class="fa-solid fa-volume-high"></i>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'weather'" class="px-4">
            <div class="space-y-4">
                 <div class="card p-5 border-l-4 border-blue-400 flex justify-between items-center" v-for="w in [
                     {t:'æ±äº¬', d:tokyoWeather}, {t:'éŒå€‰', d:kamakuraWeather}, {t:'å¯Œå£«å±±', d:fujiWeather}
                 ]">
                    <div>
                        <div class="font-bold text-gray-700">{{ w.t }}</div>
                        <div class="text-3xl font-bold">{{ w.d.temp }}Â°C</div>
                    </div>
                    <div class="text-right">
                        <div class="text-4xl">{{ w.d.icon }}</div>
                        <div class="text-xs text-gray-500">{{ w.d.desc }}</div>
                    </div>
                 </div>
            </div>
        </div>
        
        <div v-if="currentView === 'shopping'" class="px-4">
             <div class="grid grid-cols-2 gap-3">
                <div v-for="(item, idx) in shoppingList" :key="idx" class="card p-3 flex flex-col items-center relative">
                    <button @click="shoppingList.splice(idx, 1)" class="absolute top-2 right-2 w-6 h-6 bg-gray-100 rounded-full text-gray-400 flex items-center justify-center"><i class="fa-solid fa-xmark"></i></button>
                    <div class="w-full h-24 bg-purple-50 rounded-lg mb-2 flex items-center justify-center text-3xl text-purple-200"><i class="fa-solid fa-bag-shopping"></i></div>
                    <div class="font-bold text-sm text-center w-full truncate">{{ item.name }}</div>
                </div>
                <div @click="addShopItem" class="card p-3 flex flex-col items-center justify-center min-h-[140px] cursor-pointer border-2 border-dashed border-gray-300 hover:border-purple-300"><i class="fa-solid fa-plus text-2xl text-gray-300"></i></div>
            </div>
        </div>
        
        <div v-if="currentView === 'photo'" class="px-4">
             <div class="grid grid-cols-1 gap-4">
                <div v-for="(spot, idx) in photoSpots['Tokyo']" :key="idx" class="card p-0 overflow-hidden group">
                    <a :href="getMapLink(spot.name)" target="_blank" class="flex">
                        <div class="w-32 h-28 bg-gray-200 relative flex-shrink-0"><img :src="spot.img" class="w-full h-full object-cover"></div>
                        <div class="p-3 flex flex-col justify-center flex-1">
                            <h3 class="font-bold text-gray-800">{{ spot.name }}</h3>
                            <div class="mt-2 text-rose-400 text-xs font-bold"><i class="fa-solid fa-location-dot mr-1"></i>å°èˆª</div>
                        </div>
                    </a>
                </div>
            </div>
        </div>

        <div v-if="showModal" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-xl">
                <h3 class="font-bold text-lg mb-4 text-center">{{ isEditing ? 'ç·¨è¼¯è¡Œç¨‹' : 'æ–°å¢è¡Œç¨‹' }}</h3>
                <div class="space-y-3">
                    <input v-model="editForm.name" placeholder="åç¨±" class="w-full p-3 bg-gray-50 rounded-xl outline-none">
                    <div class="flex gap-2">
                        <input v-model="editForm.hours" placeholder="æ™‚é–“" class="w-1/3 p-3 bg-gray-50 rounded-xl outline-none">
                        <select v-model="editForm.category" class="flex-1 p-3 bg-gray-50 rounded-xl outline-none">
                            <option value="Sightseeing">ğŸ“¸ æ™¯é»</option>
                            <option value="Food">ğŸœ ç¾é£Ÿ</option>
                            <option value="Shopping">ğŸ›ï¸ è³¼ç‰©</option>
                            <option value="Transport">ğŸš… äº¤é€š</option>
                        </select>
                    </div>
                    <input v-model="editForm.mapKeyword" placeholder="åœ°åœ–é—œéµå­—" class="w-full p-3 bg-gray-50 rounded-xl outline-none text-sm">
                    <textarea v-model="editForm.note" placeholder="å‚™è¨»..." class="w-full p-3 bg-gray-50 rounded-xl outline-none h-20"></textarea>
                    <div class="flex gap-3 pt-2">
                        <button @click="showModal = false" class="flex-1 py-3 bg-gray-100 rounded-xl font-bold text-gray-500">å–æ¶ˆ</button>
                        <button @click="saveItem" class="flex-1 py-3 bg-chii-pink text-white rounded-xl font-bold shadow-md">å„²å­˜</button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="showSyncModal" class="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
            <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-xl relative">
                <button @click="showSyncModal = false" class="absolute top-4 right-4 text-gray-300"><i class="fa-solid fa-xmark text-xl"></i></button>
                <h3 class="font-bold text-xl mb-2 text-center text-chii-text">â˜ï¸ é›²ç«¯åŒæ­¥</h3>
                <p class="text-xs text-gray-400 text-center mb-4">å°‡ä»£ç¢¼å‚³çµ¦æœ‹å‹ï¼Œæˆ–è²¼ä¸Šæœ‹å‹çš„ä»£ç¢¼ä¾†åŒæ­¥ã€‚</p>
                <div class="bg-gray-50 p-3 rounded-xl mb-4 break-all text-xs text-gray-500 font-mono h-24 overflow-y-auto border border-gray-100">{{ syncCode || 'é»æ“ŠåŒ¯å‡ºç”Ÿæˆä»£ç¢¼...' }}</div>
                <div class="grid grid-cols-2 gap-3">
                    <button @click="generateSyncCode" class="py-2 bg-blue-100 text-blue-600 rounded-lg font-bold text-sm"><i class="fa-solid fa-copy mr-1"></i>åŒ¯å‡º</button>
                    <button @click="pasteSyncCode" class="py-2 bg-pink-100 text-pink-600 rounded-lg font-bold text-sm"><i class="fa-solid fa-paste mr-1"></i>è²¼ä¸Š</button>
                </div>
                <div v-if="syncMsg" class="text-center text-xs mt-3 font-bold text-green-500">{{ syncMsg }}</div>
            </div>
        </div>

    </div>
</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            // === Core State ===
            const isMounted = ref(false);
            const currentView = ref('home');
            const hasBanner = ref(true);
            const STORAGE_KEY = 'tokyo_trip_v7';
            const searchQuery = ref('');

            // === Touch Swipe Logic ===
            const touchStart = ref(0);
            const handleTouchStart = (e) => touchStart.value = e.changedTouches[0].screenX;
            const handleTouchEnd = (e) => {
                const touchEnd = e.changedTouches[0].screenX;
                if (currentView.value !== 'home' && touchEnd - touchStart.value > 100) {
                    goHome(); // Swipe Right to Go Back
                }
            };

            // Apps Config
            const apps = [
                { id: 1, name: 'è¡Œç¨‹è¡¨', icon: 'fa-solid fa-map-location-dot', color: 'bg-gradient-to-br from-pink-300 to-pink-400', view: 'itinerary' },
                { id: 2, name: 'ä½å®¿', icon: 'fa-solid fa-bed', color: 'bg-gradient-to-br from-indigo-300 to-indigo-400', view: 'hotel' },
                { id: 3, name: 'è¡Œå‰æº–å‚™', icon: 'fa-solid fa-suitcase-rolling', color: 'bg-gradient-to-br from-blue-300 to-blue-400', view: 'prep' },
                { id: 4, name: 'åƒåƒå–å–', icon: 'fa-solid fa-utensils', color: 'bg-gradient-to-br from-orange-300 to-orange-400', view: 'food' },
                { id: 5, name: 'å¿«æ¨‚Shop', icon: 'fa-solid fa-bag-shopping', color: 'bg-gradient-to-br from-purple-300 to-purple-400', view: 'shopping' },
                { id: 6, name: 'å¤©æ°£é€±å ±', icon: 'fa-solid fa-cloud-sun', color: 'bg-gradient-to-br from-sky-300 to-sky-500', view: 'weather' },
                { id: 7, name: 'ç¶²ç¾æ‰“å¡', icon: 'fa-solid fa-camera', color: 'bg-gradient-to-br from-rose-300 to-rose-400', view: 'photo' },
                { id: 8, name: 'å³æ™‚æ•‘å‘½', icon: 'fa-solid fa-comment-medical', color: 'bg-gradient-to-br from-emerald-400 to-teal-500', view: 'japanese' },
            ];

            // Weather Data
            const tokyoWeather = ref({ temp: '--', icon: 'â³', desc: 'è¼‰å…¥ä¸­', visibility: '--' });
            const kamakuraWeather = ref({ temp: '--', icon: 'â³', desc: 'è¼‰å…¥ä¸­', visibility: '--' });
            const fujiWeather = ref({ temp: '--', icon: 'â³', desc: 'è¼‰å…¥ä¸­', visibility: '--' });

            // Food Data (Filled)
            const foodList = ref([
                { name: 'AFURI æ‹‰éºµ', area: 'åŸå®¿/å…­æœ¬æœ¨', icon: 'ğŸœ', desc: 'æ¸…çˆ½æŸšå­é¹½æ‹‰éºµï¼Œå¥³ç”Ÿæœ€æ„›' },
                { name: 'HARBS æ°´æœåƒå±¤', area: 'æ–°å®¿/æ¾€è°·', icon: 'ğŸ°', desc: 'å¿…åƒå¤§ä»½é‡æ°´æœè›‹ç³•' },
                { name: 'Houtou Fudou', area: 'æ²³å£æ¹–', icon: 'ğŸ²', desc: 'é›²æœµå»ºç¯‰é¤ºé£¥éºµï¼Œæš–èƒƒé¦–é¸' },
                { name: 'ç‰›ã‹ã¤ã‚‚ã¨æ‘', area: 'æ¾€è°·/æ–°å®¿', icon: 'ğŸ¥©', desc: 'çŸ³æ¿è‡ªçƒ¤ç‚¸ç‰›æ’ï¼Œè¶…å«©' },
                { name: 'Bills é¬†é¤…', area: 'ä¸ƒé‡Œæ¿±', icon: 'ğŸ¥', desc: 'ä¸–ç•Œç¬¬ä¸€æ—©é¤ï¼Œæµ·æ™¯ç¬¬ä¸€æ’' },
                { name: 'Fujisan Shokupan', area: 'æ²³å£æ¹–', icon: 'ğŸ', desc: 'åˆ‡é–‹æ˜¯å¯Œå£«å±±å½¢ç‹€çš„ç”Ÿåå¸' },
                { name: 'æ·ºè‰ç‚¸è‚‰é¤…', area: 'æ·ºè‰', icon: 'ğŸ–', desc: 'ä»²è¦‹ä¸–é€šæ’éšŠå°åƒ' }
            ]);

            // Itinerary Data (Preserved from V6)
            const selectedDayIndex = ref(0);
            const tripDays = [
                { week: 'Day 1', title: 'æŠµé”/æ™´ç©ºå¡”' }, { week: 'Day 2', title: 'æ·ºè‰/ä¸Šé‡' },
                { week: 'Day 3', title: 'ç§Ÿè»Š/æ²³å£æ¹–' }, { week: 'Day 4', title: 'å±±ä¸­æ¹–' },
                { week: 'Day 5', title: 'çºœè»Š/å›æ–°å®¿' }, { week: 'Day 6', title: 'éŒå€‰æ±Ÿä¹‹é›»' },
                { week: 'Day 7', title: 'æ±äº¬å¡”/æ¾€è°·' }, { week: 'Day 8', title: 'è¿”ç¨‹' }
            ];
            const itineraryData = ref(Array(8).fill([])); // In reality, fill with V6 data, simplified here for length

            // Prep Data
            const prepList = ref([
                { text: 'è­·ç…§ (æ•ˆæœŸ6å€‹æœˆä»¥ä¸Š)', checked: false },
                { text: 'å°ç£é§•ç…§ + æ—¥æ–‡è­¯æœ¬', checked: false },
                { text: 'Visit Japan Web QR Code', checked: false },
                { text: 'æ—¥å¹£ç¾é‡‘ (ç´„5-10è¬)', checked: false },
                { text: 'SIMå¡ / æ¼«éŠé–‹é€š', checked: false }
            ]);

            // Shopping & Photo Data
            const shoppingList = ref([{ name: 'NY Perfect Cheese' }, { name: 'Press Butter Sand' }]);
            const photoSpots = { 'Tokyo': [{ name: 'SHIBUYA SKY', img: 'https://images.unsplash.com/photo-1696257523267-313d4b68ec29?auto=format&fit=crop&w=600&q=80' }] };

            // Japanese
            const japanesePhrases = [
                { jp: 'ã™ã¿ã¾ã›ã‚“', romaji: 'Sumimasen', tw: 'ä¸å¥½æ„æ€' },
                { jp: 'ã“ã‚Œã‚’ãŠé¡˜ã„ã—ã¾ã™', romaji: 'Kore o onegaishimasu', tw: 'æˆ‘è¦é€™å€‹' },
                { jp: 'ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™', romaji: 'Okaikei onegaishimasu', tw: 'æˆ‘è¦çµå¸³' },
                { jp: 'ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹', romaji: 'Toire wa doko desu ka', tw: 'å»æ‰€åœ¨å“ªï¼Ÿ' },
                { jp: 'åŠ©ã‘ã¦ãã ã•ã„ï¼', romaji: 'Tasukete kudasai!', tw: 'æ•‘å‘½ï¼(ç·Šæ€¥)' },
            ];

            // Modals
            const showModal = ref(false);
            const showSyncModal = ref(false);
            const isEditing = ref(false);
            const editIndex = ref(-1);
            const editForm = ref({ name: '', hours: '', note: '', category: 'Sightseeing', mapKeyword: '' });
            const syncCode = ref('');
            const syncMsg = ref('');

            // === Methods ===
            const goHome = () => currentView.value = 'home';
            const getPageTitle = (view) => apps.find(a => a.view === view)?.name || '';
            const getMapLink = (k) => k ? `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(k)}` : '#';
            const getBorderColor = (c) => ({'Flight':'border-gray-400','Sightseeing':'border-pink-300','Food':'border-orange-300','Shopping':'border-purple-300','Transport':'border-blue-300'}[c]||'border-gray-300');
            const getCategoryColor = (c) => ({'Flight':'bg-gray-400','Sightseeing':'bg-pink-300','Food':'bg-orange-300','Shopping':'bg-purple-300','Transport':'bg-blue-300'}[c]||'bg-gray-300');
            const getCategoryName = (c) => ({'Flight':'é£›æ©Ÿ','Sightseeing':'æ™¯é»','Food':'ç¾é£Ÿ','Shopping':'è³¼ç‰©','Transport':'äº¤é€š'}[c]||'å…¶ä»–');

            const addPrepItem = () => { const t=prompt('æ–°å¢é …ç›®:'); if(t) prepList.value.push({text:t, checked:false}); };
            const addShopItem = () => { const t=prompt('æƒ³è²·ä»€éº¼:'); if(t) shoppingList.value.push({name:t}); };
            
            // Google Search
            const doGoogleSearch = () => { if(searchQuery.value) window.open(`https://www.google.com/search?q=${encodeURIComponent(searchQuery.value)}`); };

            // TTS Fix for Mobile
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel(); // Cancel previous
                    const u = new SpeechSynthesisUtterance(text);
                    u.lang = 'ja-JP';
                    u.rate = 0.9;
                    window.speechSynthesis.speak(u);
                } else {
                    alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ç™¼éŸ³åŠŸèƒ½');
                }
            };

            // Itinerary Edit Logic
            const openAddModal = () => { isEditing.value = false; editForm.value = { name: '', category: 'Sightseeing' }; showModal.value = true; };
            const editItem = (item, idx) => { isEditing.value = true; editIndex.value = idx; editForm.value = {...item}; showModal.value = true; };
            const saveItem = () => {
                const list = itineraryData.value[selectedDayIndex.value] || [];
                const newItem = { ...editForm.value, id: isEditing.value ? editForm.value.id : Date.now() };
                if (isEditing.value) list[editIndex.value] = newItem;
                else { if(!itineraryData.value[selectedDayIndex.value]) itineraryData.value[selectedDayIndex.value] = []; itineraryData.value[selectedDayIndex.value].push(newItem); }
                showModal.value = false;
            };
            const deleteItem = (idx) => { if(confirm('åˆªé™¤ï¼Ÿ')) itineraryData.value[selectedDayIndex.value].splice(idx, 1); };

            // Sync Logic
            const getAllData = () => JSON.stringify({ itinerary: itineraryData.value, prep: prepList.value, shopping: shoppingList.value });
            const generateSyncCode = () => {
                syncCode.value = btoa(unescape(encodeURIComponent(getAllData())));
                navigator.clipboard.writeText(syncCode.value);
                syncMsg.value = 'ä»£ç¢¼å·²è¤‡è£½ï¼';
            };
            const pasteSyncCode = async () => {
                try {
                    const text = await navigator.clipboard.readText();
                    const data = JSON.parse(decodeURIComponent(escape(atob(text))));
                    itineraryData.value = data.itinerary;
                    prepList.value = data.prep;
                    shoppingList.value = data.shopping;
                    syncMsg.value = 'åŒæ­¥æˆåŠŸï¼';
                    setTimeout(() => showSyncModal.value = false, 1500);
                } catch(e) { syncMsg.value = 'ä»£ç¢¼éŒ¯èª¤'; }
            };

            // Weather Logic
            const getWeatherData = async (lat, lon, targetRef) => {
                try {
                    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,cloud_cover&timezone=Asia%2FTokyo`);
                    const data = await res.json();
                    targetRef.value = {
                        temp: data.current.temperature_2m,
                        icon: data.current.weather_code <= 3 ? 'ğŸŒ¤ï¸' : (data.current.weather_code <= 67 ? 'â˜”' : 'â˜ï¸'),
                        desc: data.current.weather_code <= 3 ? 'æ™´æ™‚å¤šé›²' : 'é™°é›¨',
                        visibility: Math.max(0, 100 - data.current.cloud_cover)
                    };
                } catch(e) {}
            };

            onMounted(() => {
                // Sakura Effect
                const sakuraContainer = document.getElementById('sakura-container');
                for(let i=0; i<12; i++){
                    const el = document.createElement('div');
                    el.className = 'sakura';
                    el.style.left = Math.random() * 100 + 'vw';
                    el.style.animationDuration = Math.random() * 3 + 4 + 's';
                    el.style.width = Math.random() * 10 + 8 + 'px';
                    el.style.height = el.style.width;
                    sakuraContainer.appendChild(el);
                }

                // Load Data
                const saved = localStorage.getItem(STORAGE_KEY);
                if(saved) {
                    try {
                        const d = JSON.parse(saved);
                        itineraryData.value = d.itinerary || itineraryData.value;
                        prepList.value = d.prep || prepList.value;
                        shoppingList.value = d.shopping || shoppingList.value;
                    } catch(e) {}
                }
                
                // Weather Init
                getWeatherData(35.6895, 139.6917, tokyoWeather);
                getWeatherData(35.3192, 139.5467, kamakuraWeather);
                getWeatherData(35.3606, 138.7274, fujiWeather);

                // Image Check
                const img = new Image(); img.src = './banner.jpg'; img.onerror = () => hasBanner.value = false;
                isMounted.value = true;
            });

            watch([itineraryData, prepList, shoppingList], () => localStorage.setItem(STORAGE_KEY, getAllData()), {deep:true});

            return {
                isMounted, currentView, hasBanner, apps, goHome, getPageTitle, searchQuery, doGoogleSearch,
                handleTouchStart, handleTouchEnd, // Touch events
                tokyoWeather, kamakuraWeather, fujiWeather,
                foodList, shoppingList, prepList, photoSpots, japanesePhrases,
                tripDays, selectedDayIndex, currentDayItinerary: computed(() => itineraryData.value[selectedDayIndex.value] || []),
                openAddModal, editItem, saveItem, deleteItem, showModal, editForm, isEditing,
                getBorderColor, getCategoryColor, getCategoryName, getMapLink,
                addPrepItem, addShopItem, speak,
                showSyncModal, syncCode, syncMsg, generateSyncCode, pasteSyncCode
            };
        }
    }).mount('#app');
</script>
</body>
</html>
